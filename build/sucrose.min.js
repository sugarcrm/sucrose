/*
Copyright 2017 SugarCRM, Inc.

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
*/
(function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("d3")):"function"==typeof define&&define.amd?define(["exports","d3"],e):e(t.sucrose=t.sucrose||{},t.d3)})(this,function(t,e){"use strict";function n(t,e,n){return function(){var r=n.apply(e,arguments);return r===e?t:r}}function r(){function t(o){return o.each(function(o){function l(t,e,n){return{point:e,seriesKey:e.key,seriesIndex:e.seriesIndex,e:t}}var f=e.select(this),p=a-r.left-r.right,g=i-r.top-r.bottom,m="linear"===b?e.curveLinear:"cardinal"===b?e.curveCardinal:"monotone"===b?e.curveMonotoneX:"basis"===b?e.curveBasis:e.curveNatural,x=[["zero","wiggle","expand","silhouette"].indexOf(v)],w=[e.stackOffsetNone,e.stackOffsetWiggle,e.stackOffsetExpand,e.stackOffsetSilhouette][x],k=[["default","inside-out"].indexOf(y)],M=[e.stackOrderNone,e.stackOrderInsideOut][k],T=e.stack().offset(w).order(M).value(function(t,e){return t[e]}),E={};o.forEach(function(t,e){t.values.forEach(function(t,e){var n=t.x,r=t.y;E[n]||(E[n]=[],E[n].x=n),E[n].push(r)})});var P=e.keys(E),z=P.map(function(t){return parseInt(t,10)}),N=T.keys(e.range(0,o.length))(e.values(E)),H=e.min(N,function(t){return e.min(t,function(t){return e.min(t,function(t){return t})})}),_=e.max(N,function(t){return e.max(t,function(t){return e.max(t,function(t){return t})})});N.forEach(function(t,e){t.key=o[e].key,t.seriesIndex=o[e].seriesIndex,t.total=o[e].total,t.color=o[e].color,t.class=o[e].classes,t.forEach(function(t,n){t.seriesIndex=o[e].seriesIndex,t.si0=e-1,H&&(t[0]-=H,t[1]-=H)})});var O=e.area().curve(m).x(function(t){return c(t.data.x)}).y0(function(t,e){var r=n?n[t.si0]:null;return L(r&&r[e]?r[e][1]:0)}).y1(function(t,e){var r=n?n[t.si0]:null;return L(r&&r[e]?r[e][1]:0)}),B=e.area().curve(m).x(function(t){return c(t.data.x)}).y0(function(t){return u(t[0])}).y1(function(t){return u(t[1])}),R=e.area().curve(m).x(function(t){return c(t.data.x)}).y0(function(t,e){var n=N[t.si0];return u(n&&n[e]?n[e][1]:0)}).y1(function(t,e){var n=N[t.si0];return u(n&&n[e]?n[e][1]:0)}),V=e.transition("area").duration(h).ease(e.easeLinear);c.domain(e.extent(z)).range([0,p]),u.domain([0,_-H]).range([g,0]),t.resetDimensions=function(t,e){a=t,i=e,p=t-r.left-r.right,g=e-r.top-r.bottom,c.range([0,p]),u.range([g,0])};var G=f.selectAll("g.sc-wrap.sc-area").data([N]),W=G.enter().append("g").attr("class","sc-wrap sc-area"),Y=f.select(".sc-wrap.sc-area").merge(W),q=W.append("defs"),X=Y.select("defs");W.append("g").attr("class","sc-group");var K=Y.select(".sc-group");Y.attr("transform",D.translation(r.left,r.top)),q.append("clipPath").attr("id","sc-edge-clip-"+s).append("rect"),X.select("#sc-edge-clip-"+s+" rect").attr("width",p).attr("height",g),Y.attr("clip-path",d?"url(#sc-edge-clip-"+s+")":""),t.gradientFill=function(t,e,n){var r=s+"-"+e,a=A(t,e);return I(t,r,n,a,X)};var Z=K.selectAll("g.sc-series").data(N,function(t){return t.seriesIndex}),U=Z.enter().append("g").attr("class","sc-series").style("stroke-opacity",1e-6).style("fill-opacity",1e-6),j=K.selectAll(".sc-series").merge(U);j.attr("fill",C).attr("stroke",A).attr("class",S).classed("hover",function(t){return t.hover}),j.transition(V).style("stroke-opacity",1).style("fill-opacity",.5),Z.exit().transition(V).style("stroke-opacity",1e-6).style("fill-opacity",1e-6).remove();var $=j.selectAll("path.sc-area").data(function(t){return[t]}),J=$.enter().append("path").attr("class","sc-area sc-enter"),Q=j.selectAll(".sc-area").merge(J);Q.filter(function(t){return e.select(this).classed("sc-enter")}).attr("d",O),Q.transition(V).attr("d",B).on("end",function(t){e.select(this).classed("sc-enter",!1),n=N.map(function(t){return t.map(function(t){return[t[0],t[1]]})}),L=u.copy()}),Z.exit().transition(V).selectAll(".sc-area").attr("d",R).remove(),Q.on("mouseover",function(t,n){var r=l(e.event,t,n);F.call("elementMouseover",this,r),e.select(this).classed("hover",!0)}).on("mousemove",function(t,n){var r=l(e.event,t,n),a=Y.select("#sc-edge-clip-"+s+" rect").node().getBoundingClientRect(),i=e.event.clientX-a.left,o=Math.round(i*z.length/p)-1;r.data=N.map(function(t,e){var n=[t[o].data.x,t[o][1]];return n.seriesKey=t.key,n.seriesIndex=t.seriesIndex,n}),r.pointIndex=o,r.origin=a,F.call("elementMousemove",this,r)}).on("mouseout",function(t,n){F.call("elementMouseout",this),e.select(this).classed("hover",!1)}).on("click",function(t,n){var r=l(e.event,t,n);e.event.stopPropagation(),e.select(this).classed("hover",!1),F.call("elementClick",this,r)}),L=u.copy()}),t}var n,r={top:0,right:0,bottom:0,left:0},a=960,i=500,o=function(t){return t.x},l=function(t){return t.y},s=Math.floor(1e5*Math.random()),c=e.scaleLinear(),u=e.scaleLinear(),d=!1,f=0,h=0,p=D.buildLocality(),g="ltr",m="stack",v="zero",y="default",b="linear",x=null,w=null,k=[],M=[],A=function(t,e){return D.defaultColor()(t,t.seriesIndex)},I=D.colorLinearGradient,C=A,S=function(t,e){return"sc-area sc-series-"+t.seriesIndex},F=e.dispatch("tooltipShow","tooltipHide","tooltipMove","elementClick","elementMouseover","elementMouseout","elementMousemove"),L=u.copy();return t.dispatch=F,t.id=function(e){return arguments.length?(s=e,t):s},t.color=function(e){return arguments.length?(A=e,t):A},t.fill=function(e){return arguments.length?(C=e,t):C},t.classes=function(e){return arguments.length?(S=e,t):S},t.gradient=function(e){return arguments.length?(I=e,t):I},t.margin=function(e){if(!arguments.length)return r;for(var n in e)e.hasOwnProperty(n)&&(r[n]=e[n]);return t},t.width=function(e){return arguments.length?(a=e,t):a},t.height=function(e){return arguments.length?(i=e,t):i},t.clipEdge=function(e){return arguments.length?(d=e,t):d},t.x=function(e){return arguments.length?(o=e,t):o},t.y=function(e){return arguments.length?(l=e,t):l},t.xScale=function(e){return arguments.length?(c=e,t):c},t.yScale=function(e){return arguments.length?(u=e,t):u},t.xDomain=function(e){return arguments.length?(x=e,t):x},t.yDomain=function(e){return arguments.length?(w=e,t):w},t.forceX=function(e){return arguments.length?(k=e,t):k},t.forceY=function(e){return arguments.length?(M=e,t):M},t.delay=function(e){return arguments.length?(f=e,t):f},t.duration=function(e){return arguments.length?(h=e,t):h},t.locality=function(e){return arguments.length?(p=D.buildLocality(e),t):p},t.direction=function(e){return arguments.length?(g=e,t):g},t.interpolate=function(e){return arguments.length?(b=e,t):b},t.offset=function(e){return arguments.length?(v=e,t):v},t.order=function(e){return arguments.length?(y=e,t):y},t.style=function(e){if(!arguments.length)return m;switch(m=e){case"stack":t.offset("zero"),t.order("default");break;case"stream":t.offset("wiggle"),t.order("inside-out");break;case"stream-center":t.offset("silhouette"),t.order("inside-out");break;case"expand":t.offset("expand"),t.order("default")}return t},t}function a(){function t(n){return n.each(function(n){function r(){return"function"==typeof R.rangeExtent?R.rangeExtent():R.range()}function a(){return b?R.bandwidth():0}function i(){var t,n=0;return b?n=R.range().length>1?Math.abs(R.range()[1]-R.range()[0]):e.max(r())/2:(t=R.ticks(et.size()),n=R(t[t.length-1])-R(t[t.length-2])),n}function o(t){if("rtl"===f){if("start"===t)return"end";if("end"===t)return"start"}return t}function v(){return"left"!==h&&"bottom"!==h}function k(t){t=t||1,F=L.tickPadding()+(Y?M:A)*t}function T(){E(),M=e.max(Z,function(t){return t.width}),A=e.max(Z,function(t){return t.height})}function E(){Z=[],U={},u&&it.style("opacity",1).attr("transform",function(t,e){var n=Y?"0,"+R(t):R(t)+",0";return"translate("+n+")"}),lt.each(function(t,e){var n=this.getBoundingClientRect();n.width>0&&Z.push({key:t,width:parseInt(n.width,10),height:parseInt(n.height,10),left:n.left,right:n.right,top:n.top,bottom:n.bottom})}),Z.sort(function(t,e){return t.key-e.key}).forEach(function(t,e){t.index=e,U["key-"+t.key.toString()]=t}),j=Z[0],$=Z[Z.length-1]}function P(t){E();for(var e=u?2:t||1,n=u?1:0,r=Z.length-e;n<r;n+=1)if(Z[n].right+X>Z[n+t].left)return!0;return!1}function z(t){var e=t?(t+180)%180:0,n=e>90,i=null,o=null;if(Z.forEach(function(t,r){var l=null===i||t.left<=i,s=null===o||t.right>=o,c=0,u=0,d=0;(l||s)&&(d=e?t.width-6:t.width/2,c=R(t.key)+b*a()/2,!l||e&&!n||(i=t.left,u=Math.abs(G[0]-c),V.left=Math.max(d-u,0)),!s||e&&n||(o=t.right,u=Math.abs(G[1]-c),V.right=Math.max(d-u,0)))}),!b){var l=S.right-Math.max(S.right,V.right);l+=S.left-Math.max(S.left,V.left);var s=[G[0],G[1]+l];R.range(s),G=r(),W=Math.abs(G[1]-G[0]),L.scale(R),tt.call(L)}}function N(){V={top:0,right:0,bottom:0,left:0},R=s.copy(),G=r(),W=Math.abs(G[1]-G[0]),L.scale(s),tt.call(L),lt.selectAll("tspan").remove(),lt.attr("dy",Y?".32em":.355+.355*q+"em").attr("x",Y?L.tickPadding()*q:0).attr("y",Y?0:L.tickPadding()*q).attr("transform","translate(0,0)").style("text-anchor","middle").style("opacity",1),ot.text(function(t,e,n){return I(t,e,n,"maxmin")}),T(),k()}function H(){var t=i();lt.each(function(n,r,a){var i=I(n,r,a,"no-ellipsis"),o=e.select(this),l=D.isValidDate(D.parseDatetime(i)),s=1===q?.71:-1,c=0,u=(i&&""!==i?l?i:i.replace("/","/ "):[]).split(" "),d=u.length;this.textContent="";var f,h=o.append("tspan").text(u[c]+" ").attr("dy",s+"em").attr("x",0);for(c+=1,s=1;c<d;)for(h=o.append("tspan").text(u[c]+" ").attr("dy",s+"em").attr("x",0),c+=1;c<d;){if(f=h.text(),h.text(f+" "+u[c]),!(this.getBoundingClientRect().width<=t)){h.text(f);break}c+=1}}),T(),k()}function _(){lt.attr("transform",function(t,e){var n=U["key-"+t.toString()].index%2*A;return"translate(0,"+n+")"}),T(),k(2)}function O(t){var e=(t+180)%180,n=e>90,r=(e-(n?180:0))*q,a=o(n?"end":"start"),i=Math.abs(Math.cos(t*Math.PI/180));lt.attr("transform",function(t,e,n){return"translate(0,"+L.tickPadding()*q+") rotate("+r+")"}).attr("y","0").style("text-anchor",a),T(),k(),F+=11*i}var B=e.select(this),R=L.scale().copy(),V={top:0,right:0,bottom:0,left:0},G=r(),W=Math.abs(G[1]-G[0]);l=l||L.scale();var Y="left"===h||"right"===h,q="left"===h||"top"===h?-1:1,X=6,K=0,Z=[],U={},j={},$={};F=0,null!==w?L.ticks(w):Y?L.ticks(Math.ceil(W/48)):L.ticks(Math.ceil(W/100)),L.tickFormat(function(t,e,n){return I(t,e,n,"axis")}),m&&!isFinite(String(m))&&(m=30),b&&(u=!1);var J=B.selectAll("g.sc-wrap.sc-axis").data([n]),Q=J.enter().append("g").attr("class","sc-wrap sc-axis").append("g").attr("class","sc-axis-inner"),tt=B.select(".sc-axis-inner").merge(Q);tt.call(L);var et=tt.selectAll("g.tick"),nt=u?e.extent(s.domain()):[],rt=tt.selectAll("g.sc-axisMaxMin").data(nt),at=rt.enter().append("g").attr("class","sc-axisMaxMin");rt.exit().remove();var it=tt.selectAll("g.sc-axisMaxMin").merge(at);at.append("text").style("opacity",0),at.append("line").style("opacity",0);var ot=it.select("text"),lt=tt.selectAll("g.tick, g.sc-axisMaxMin").select("text").filter(function(t){return this.getBoundingClientRect().width}),st=c?[c]:[],ct=tt.selectAll("text.sc-axislabel").data(st),ut=ct.enter().append("text").attr("class","sc-axislabel");ct.exit().remove();var dt=tt.selectAll("text.sc-axislabel").merge(ut);dt.text(D.identity);var ft=!1,ht=!1,pt=!1;if(Y?(N(!0),lt.style("text-anchor",o(x||(v()?"start":"end")))):(N(!1),z(),P(1)&&(p&&(N(!1),H(),z(),H(),P(1)||(ft=!0)),!ft&&g&&(N(!1),_(),z(),_(),P(2)||(ht=!0)),ft||ht||(m||(m=30),N(!0),O(m),z(m),O(m),pt=!0))),u?(it.select("line").attr("x1",0).attr("y1",0).attr("y2",Y?0:(L.tickSize()-V.bottom)*q).attr("x2",Y?L.tickSize()*q:0).style("opacity",function(t,e){return v()?e?0:1:e?1:0}),et.each(function(t,n){var r=e.select(this),a=U["key-"+t.toString()],i=!1;Y?(i=a.bottom>j.top||a.top<$.bottom,r.select("line").style("opacity",1-i)):i=!pt&&(ht?(a.left<j.right+X||a.right>$.left+X)&&(a.bottom<j.top||a.top>$.bottom):a.left<j.right+X||a.right>$.left+X),r.select("text").style("opacity",1-i)})):(et.filter(function(t){return R(t)===G[0+v()]}).classed("zero",d),et.select("line").style("opacity",function(t,e){return R(t)===G[0+v()]?0:1})),c){var gt=Y?y?W/-2:(F+C)*q:W/2,mt=Y?y?(F+C)*q:W/2:(F+C)*q;dt.attr("x",gt).attr("y",mt).attr("dy",.355+.355*q+"em").attr("transform",Y&&y?"rotate(-90)":"").style("text-anchor",Y&&!y?o("end"):"middle"),dt.each(function(t,e){K+=Y?parseInt(this.getBoundingClientRect().width/1.3,10):parseInt(this.getBoundingClientRect().height/1.3,10)}),F+=K+C}l=s.copy(),S={top:V.top,right:V.right,bottom:V.bottom,left:V.left},S[h]=F,t.resizeTickLines=function(t){tt.selectAll("g.tick, g.sc-axisMaxMin").select("line").attr(Y?"x2":"y2",t*q)},t.labelThickness=function(){return K}}),t}var n,r,a,i,o,l,s=e.scaleLinear(),c=null,u=!0,d=!0,f="ltr",h="bottom",p=!1,g=!1,m=30,v=!1,y=!0,b=!1,x=null,w=null,k=4,M=0,A=0,I=function(t){return t},C=8,S={top:0,right:0,bottom:0,left:0},F=0,L=e.axisBottom();return t.axis=L,D.rebind(t,s,"domain","range"),t.width=function(e){return arguments.length?t:F},t.height=function(e){return arguments.length?t:F},t.margin=function(e){return arguments.length?(S=e,t):S},t.ticks=function(e){return arguments.length?(w=e,t):w},t.axisLabel=function(e){return arguments.length?(c=e,t):c},t.showMaxMin=function(e){return arguments.length?(u=e,t):u},t.highlightZero=function(e){return arguments.length?(d=e,t):d},t.wrapTicks=function(e){return arguments.length?(p=e,t):p},t.rotateTicks=function(e){return arguments.length?(m=e,t):m},t.staggerTicks=function(e){return arguments.length?(g=e,t):g},t.reduceXTicks=function(e){return arguments.length?(v=e,t):v},t.rotateYLabel=function(e){return arguments.length?(y=e,t):y},t.axisLabelDistance=function(e){return arguments.length?(C=e,t):C},t.maxLabelWidth=function(e){return arguments.length?(M=e,t):M},t.textAnchor=function(e){return arguments.length?(x=e,t):x},t.direction=function(e){return arguments.length?(f=e,t):f},t.orient=function(n){return arguments.length?(h=n,L="bottom"===h?e.axisBottom():"right"===h?e.axisRight():"left"===h?e.axisLeft():"top"===h?e.axisTop():e.axisBottom(),t):h},t.scale=function(e){return arguments.length?(s=e,L.scale(s),b="function"==typeof s.padding,D.rebind(t,s,"domain","range"),t):s},t.valueFormat=function(e){return arguments.length?(I=e,t):I||L.tickFormat()},t.tickFormat=function(e){return arguments.length?(n=e,L.tickFormat(e),t):n||L.tickFormat()},t.tickValues=function(e){return arguments.length?(r=e,L.tickValues(e),t):r},t.tickSize=function(e){return arguments.length?(a=e,L.tickSize(e),t):a},t.tickPadding=function(e){return arguments.length?(k=e,L.tickPadding(e),t):k},t.tickSizeInner=function(e){return arguments.length?(i=e,L.tickSizeInner(e),t):i},t.tickSizeOuter=function(e){return arguments.length?(o=e,L.tickSizeOuter(e),t):o},t}function i(){function t(o){return o.each(function(o){function f(){F=G(ct),L=W(),T=Y(ct)}function h(){var t=V(L,F),n=0,r=4,a=F-2*w*L,i=L;o.forEach(function(e,o){e.values.forEach(function(e){e._height=st>0?R(t*e.value/st,a):0,e._height<r?(n+=e._height-r,e._height=r):n<0&&e._height+n>r&&(e._height+=n,n=0),e._base=a,e._bottom=i,e._top=e._bottom-e._height,a+=2*w*e._height,i-=e._height})});var l=M||e.extent(e.merge(o.map(function(t){return t.values.map(function(t){return t._top})})).concat(A));k.domain(l).range([L,0])}function p(){At.selectAll("polyline").remove(),At.selectAll("rect").remove(),At.selectAll("text").remove(),At.append("rect").attr("class","sc-label-box").attr("x",0).attr("y",0).attr("width",0).attr("height",0).attr("rx",2).attr("ry",2).style("pointer-events","none").style("stroke-width",0).style("fill-opacity",0),At.append("text").text(c).call(Q,"sc-label",.85,"middle",J),At.select(".sc-label").call(H,I?N:_,q,function(t,e){Q(t,"sc-label",e,"middle",J)}),At.append("text").text(u).call(Q,"sc-value",.85,"middle",J),At.select(".sc-value").append("tspan").text(d),At.call(tt).call(Z).call(et),At.classed("sc-label-side",function(t){return t.tooTall||t.tooWide})}function E(){var t,n,r,a,i=0,o=0;for(It=At.filter(".sc-label-side"),It.selectAll(".sc-label").remove(),It.selectAll("rect").remove(),It.selectAll("polyline").remove(),It.append("text").text(c).call(Q,"sc-label",.85,"start","#555"),It.select(".sc-label").call(H,I?N:_,I?X:O,function(t,e){Q(t,"sc-label",e,"start","#555")}),It.call(tt),It.select(".sc-value").style("text-anchor","start").style("fill","#555"),It.call(U),t=It.nodes(),r=t.length-1;r>=0;r-=1)if(o=e.select(t[r]).data()[0]){if(!i){o.labelBottom=o.labelTop+o.labelHeight+ot,i=o.labelBottom;continue}o.labelTop=Math.max(i,o.labelTop),o.labelBottom=o.labelTop+o.labelHeight+ot,i=o.labelBottom}if(i&&i-ot>e.max(k.range())){for(i=0,t=It.nodes(),n=0,a=t.length;n<a;n+=1)if(o=e.select(t[n]).data()[0]){if(!i){o.labelBottom=L-1,o.labelTop=o.labelBottom-o.labelHeight,i=o.labelTop;continue}o.labelBottom=Math.min(i,o.labelBottom),o.labelTop=o.labelBottom-o.labelHeight-ot,i=o.labelTop}i<0&&It.each(function(t){t.labelTop-=i,t.labelBottom-=i})}i=0,It.call($)}function P(){p(),E()}function z(t,e,n){return{id:i,key:c(e),value:l(e),count:s(e),data:e,series:e.series,seriesIndex:e.series.seriesIndex,e:t}}function N(t,n,r,a){var i,o=n.text(),l=parseFloat(n.attr("dy")),s=o.split(/\s+/).reverse(),c=[],u=0,d=r(t,0),f=e.select(n.node().parentNode);for(n.text(null);i=s.pop();)c.push(i),n.text(c.join(" ")),n.node().getBoundingClientRect().width>d&&c.length>1&&(c.pop(),n.text(c.join(" ")),c=[i],n=f.append("text"),n.text(i).call(a,1.1*++u+l))}function H(t,n,r,a){t.each(function(t){var i=e.select(this);n(t,i,r,a)})}function _(t,e,n,r){var a=e.text(),i=parseFloat(e.attr("dy")),o=n(t);e.text(D.stringEllipsify(a,at,o)).call(r,i)}function O(t){var e=Math.max(nt-rt/1.1,C),n=t._bottom,r=n*w,a=e+r,i=Math.abs(t.labelBottom-n),o=i*w,l=it+o+it+it,s=a-l;return Math.max(s,C)}function B(t,e,n){var r=t._bottom,a=t._top,i=n/2-w*r,o=n/2-w*a,l=T;return l-i+","+r*e+" "+(l-o)+","+a*e+" "+(l+o)+","+a*e+" "+(l+i)+","+r*e}function R(t,e){var n=e/w/2;return Math.abs(Math.sqrt(t/w+n*n))-n}function V(t,e){return t*(e-t*w)}function G(t){return Math.round(Math.max(Math.min(rt/1.1,nt-t),40))}function W(){return Math.min(1.1*F,(F-F*w)/(2*w))}function Y(t){return F/2+t}function q(t){var e=F,n=t._bottom-t._height/2;return e-n*w*2}function X(t,e){var n=Math.max((nt-F)/2,e),r=t._top;return n+r*w}function K(t){return e.select(t).node().getBoundingClientRect()}function Z(t){t.each(function(t){var e=K(this);t.labelHeight=e.height,t.labelWidth=e.width,t.labelTop=t._bottom-t._height/2-t.labelHeight/2,t.labelBottom=t.labelTop+t.labelHeight+ot,t.tooWide=t.labelWidth>q(t),t.tooTall=t.labelHeight>t._height-4})}function U(t){t.each(function(t){var e=K(this);t.labelHeight=e.height,t.labelWidth=e.width,t.labelTop=t._top,t.labelBottom=t.labelTop+t.labelHeight+ot})}function j(t){for(var n=t.size(),r=t.nodes(),a=r.length-1;a>=0;--a){var i=e.select(r[a]),o=i.data()[0],l=a<n-1?e.select(r[a+1]).data()[0]:null,s=a?e.select(r[a-1]).data()[0]:null,c=Math.round(o.labelHeight)+.5,u=Math.round(o._bottom-o.labelTop)-.5,d=l?l.labelWidth-(o.labelBottom-l.labelBottom)*w:0,f=o.labelWidth,h=s&&c<u?s.labelWidth:0,p=Math.round(Math.max(d,f,h))+it,g=Math.round(X(o,ct))-lt-it,m="0,"+c+" "+p+","+c+" "+(p+Math.abs(c-u)*w)+","+u+" "+g+","+u;o.labelWidth=p,i.attr("points",m)}}function $(t){var e=(nt-F)/2,n=0;t.each(function(t){var e=t._bottom,r=Math.abs(t.labelBottom+it-e)*w,a=e*w,i=t.labelWidth+r+3*it-a;i>=n&&(n=i)}),n=Math.round(10*n)/10,n<=0?(lt=e,ct=e):n>0&&n<e?(lt=e-n,ct=e):(lt=0,ct=n)}function J(t,n,r){var a=e.select(this.parentNode).style("fill");return D.getTextContrast(a,n)}function Q(t,e,n,r,a){t.attr("x",0).attr("y",0).attr("dy",n+"em").attr("class",e).attr("direction",function(){return"ltr"}).style("pointer-events","none").style("text-anchor",r).style("fill",a)}function tt(t){t.each(function(t){var n=e.select(this),r=n.selectAll(".sc-label").size()+1,a=.85+r-1+"em";n.select(".sc-value").attr("dy",a)})}function et(t){t.each(function(t,n){var r=e.select(this);r.select(".sc-label-box").attr("x",(t.labelWidth+6)/-2).attr("y",-2).attr("width",t.labelWidth+6).attr("height",t.labelHeight+4).attr("rx",2).attr("ry",2).style("fill-opacity",1)})}var nt=r-n.left-n.right,rt=a-n.top-n.bottom,at=e.select(this),it=5,ot=5,lt=0,st=0,ct=0;st=e.sum(o,function(t){return t.value}),f(),h();var ut=at.selectAll("g.sc-wrap").data([o]),dt=ut.enter().append("g").attr("class","sc-wrap sc-funnel"),ft=at.select(".sc-wrap.sc-funnel").merge(dt),ht=dt.append("defs"),pt=ft.select("defs");if(ft.attr("transform",D.translation(n.left,n.top)),b)var gt=D.createTexture(ht,i);t.gradientFill=function(t,e,n){var r=i+"-"+e,a=m(t,e);return v(t,r,n,a,pt)};var mt=ft.selectAll(".sc-series").data(o,function(t){return t.seriesIndex}),vt=mt.enter().append("g").attr("class","sc-series");mt.exit().remove();var yt=ft.selectAll(".sc-series").merge(vt);vt.style("stroke","#FFF").style("stroke-width",2).style("stroke-opacity",1).on("mouseover",function(t,n,r){e.select(this).classed("hover",!0)}).on("mouseout",function(t,n,r){e.select(this).classed("hover",!1)}),yt.attr("class",function(t){return x(t,t.seriesIndex)}).attr("fill",function(t){return y(t,t.seriesIndex)}).classed("sc-active",function(t){return"active"===t.active}).classed("sc-inactive",function(t){return"inactive"===t.active}),yt.transition().duration(g).style("stroke-opacity",1).style("fill-opacity",1);var bt=yt.selectAll("g.sc-slice").data(function(t){return t.values},function(t){return t.seriesIndex});bt.exit().remove();var xt=bt.enter().append("g").attr("class","sc-slice"),wt=yt.selectAll("g.sc-slice").merge(xt);xt.append("polygon").attr("class","sc-base"),wt.select("polygon.sc-base").attr("points",function(t){return B(t,0,F)}),b&&(xt.append("polygon").attr("class","sc-texture").style("mask","url("+gt+")"),wt.select("polygon.sc-texture").attr("points",function(t){return B(t,0,F)})),xt.on("mouseover",function(t,n){e.select(this).classed("hover",!0);var r=z(e.event,t,n);S.call("elementMouseover",this,r)}).on("mousemove",function(t,n){var r=e.event;S.call("elementMousemove",this,r)}).on("mouseout",function(t,n){e.select(this).classed("hover",!1),S.call("elementMouseout",this)}).on("click",function(t,n){e.event.stopPropagation();var r=z(e.event,t,n);S.call("elementClick",this,r)}).on("dblclick",function(t,n){e.event.stopPropagation();var r=z(e.event,t,n);S.call("elementDblClick",this,r)});var kt=yt.selectAll(".sc-label-value").data(function(t){return t.values},function(t){return t.seriesIndex});kt.exit().remove();var Mt=kt.enter().append("g").attr("class","sc-label-value"),At=yt.selectAll("g.sc-label-value").merge(Mt);At.attr("transform","translate("+T+",0)");var It=At.filter(".sc-label-side");P(),f(),h(),P(),f(),h(),P(),f(),h(),wt.select(".sc-base").attr("points",function(t){return B(t,1,F)}),b&&wt.selectAll(".sc-texture").attr("points",function(t){return B(t,1,F)}).style("fill",J),At.attr("transform",function(t){var e=t.tooTall?0:T,n=t.tooTall?0:t.labelTop;return"translate("+e+","+n+")"}),It.attr("transform",function(t){return"translate("+lt+","+t.labelTop+")"}),It.append("polyline").attr("class","sc-label-leader").style("fill-opacity",0).style("stroke","#999").style("stroke-width",1).style("stroke-opacity",.5),It.selectAll("polyline").call(j)}),t}var n={top:0,right:0,bottom:0,left:0},r=960,a=500,i=Math.floor(1e4*Math.random()),o=function(t){return(t.series||t).key},l=function(t,e){return(t.series||t).value},s=function(t,e){return(t.series||t).count},c=function(t){return o(t)},u=function(t){return l(t)},d=function(t){return isNaN(s(t))?"":" ("+s(t)+")"},f=D.buildLocality(),h="ltr",p=0,g=0,m=function(t,e){return D.defaultColor()(t.series,t.seriesIndex)},v=D.colorLinearGradient,y=m,b=!1,x=function(t,e){return"sc-series sc-series-"+t.seriesIndex},w=.3,k=e.scaleLinear(),M=null,A=[0],I=!0,C=75,S=e.dispatch("chartClick","elementClick","elementDblClick","elementMouseover","elementMouseout","elementMousemove"),F=0,L=0,T=0;return t.dispatch=S,t.id=function(e){return arguments.length?(i=e,t):i},t.color=function(e){return arguments.length?(m=e,t):m},t.fill=function(e){return arguments.length?(y=e,t):y},t.classes=function(e){return arguments.length?(x=e,t):x},t.gradient=function(e){return arguments.length?(v=e,t):v},t.margin=function(e){return arguments.length?(n.top="undefined"!=typeof e.top?e.top:n.top,n.right="undefined"!=typeof e.right?e.right:n.right,n.bottom="undefined"!=typeof e.bottom?e.bottom:n.bottom,n.left="undefined"!=typeof e.left?e.left:n.left,t):n},t.width=function(e){return arguments.length?(r=e,t):r},t.height=function(e){return arguments.length?(a=e,t):a},t.getKey=function(e){return arguments.length?(o=e,t):o},t.getValue=function(e){return arguments.length?(l=e,t):l},t.getCount=function(e){return arguments.length?(s=e,t):s},t.fmtKey=function(e){return arguments.length?(c=e,t):c},t.fmtValue=function(e){return arguments.length?(u=e,t):u},t.fmtCount=function(e){return arguments.length?(d=e,t):d},t.direction=function(e){return arguments.length?(h=e,t):h},t.delay=function(e){return arguments.length?(p=e,t):p},t.duration=function(e){return arguments.length?(g=e,t):g},t.locality=function(e){return arguments.length?(f=D.buildLocality(e),t):f},t.textureFill=function(e){return arguments.length?(b=e,t):b},t.yScale=function(e){return arguments.length?(k=e,t):k},t.yDomain=function(e){return arguments.length?(M=e,t):M},t.forceY=function(e){return arguments.length?(A=e,t):A},t.wrapLabels=function(e){return arguments.length?(I=e,t):I},t.minLabelWidth=function(e){return arguments.length?(C=e,t):C},t}function o(){function t(o){return o.each(function(o){function s(t,n,r){return{point:n,index:r,e:e.event,id:i}}function c(t){T=t,ft.transition().duration(v).ease(e.easeElastic).attr("transform","rotate("+d(t)+")"),$.select(".sc-odomText").text(T),$.call(u)}function u(t){var e=t.select(".sc-odomText").node().getBoundingClientRect();t.select(".sc-odomBox").attr("d",D.roundedRectangle(-e.width/2,-e.height+G(1.5),e.width+G(4),e.height+G(2),G(2))),t.attr("transform","translate("+_+","+(n.top+G(70)+e.height)+")")}function d(t){return z+B(t)*O}function f(t){return D.angleToRadians(d(t.y0))}function h(t){return D.angleToRadians(d(t.y1))}function p(){return"translate("+_+","+_+")"}function g(t){var e=(h(t)-f(t))/(2*Math.PI);return e>C?1:0}var m=r-n.left-n.right,A=a-n.top-n.bottom,F=e.select(this),_=Math.min(m/2,A)/((100+H)/100),O=N-z,B=e.scaleLinear().range([0,1]).domain([E,P]),R=0,V=o.map(function(t,e){var n={key:t.key,seriesIndex:t.seriesIndex,y0:R,y1:t.y,color:t.color,classes:t.classes,values:t.values};return R=t.y,n}),G=function(t){return t*_/100},W=F.selectAll("g.sc-wrap").data([o]),Y=W.enter().append("g").attr("class","sc-wrap sc-gauge"),q=F.select(".sc-wrap.sc-gauge").merge(Y),X=(Y.append("defs"),q.select("defs"));Y.append("g").attr("class","sc-group");var K=q.select(".sc-group");Y.append("g").attr("class","sc-labels");var Z=q.select(".sc-labels");Y.append("g").attr("class","sc-pointer");var U=q.select(".sc-pointer"),j=Y.append("g").attr("class","sc-odometer"),$=q.select(".sc-odometer");q.attr("transform","translate("+(n.left/2+n.right/2+G(H))+","+(n.top+G(H))+")"),t.gradientFill=function(t,e){var n=i+"-"+e,r={x:0,y:0,r:_,s:M/100,u:"userSpaceOnUse"},a=y(t,e);return b(t,n,r,a,X)},K.attr("transform",p);var J=K.selectAll(".sc-series").data(V),Q=J.enter().append("g").attr("class","sc-series");J.exit().remove();var tt=K.selectAll(".sc-series").merge(Q);Q.style("stroke","#FFF").style("stroke-width",2).style("stroke-opacity",0).on("mouseover",function(t,n,r){e.select(this).classed("hover",!0)}).on("mouseout",function(t,n,r){e.select(this).classed("hover",!1)}),tt.attr("class",function(t){return w(t,t.seriesIndex)}).attr("fill",function(t){return x(t,t.seriesIndex)}).classed("sc-active",function(t){return"active"===t.active}).classed("sc-inactive",function(t){return"inactive"===t.active});var et=e.arc().innerRadius(G(M)).outerRadius(_).startAngle(f).endAngle(h),nt=tt.selectAll("g.sc-slice").data(function(t,e){return t.values.map(function(e,n){return e.y0=t.y0,e.y1=t.y1,e})},function(t){return t.seriesIndex});nt.exit().remove();var rt=nt.enter().append("g").attr("class","sc-slice"),at=tt.selectAll("g.sc-slice").merge(rt);rt.append("path").attr("class","sc-base").attr("d",et).on("mouseover",function(t,n){e.select(this).classed("hover",!0);var r=s(e.event,t,n);k.call("elementMouseover",this,r)}).on("mousemove",function(t,n){var r=e.event;k.call("elementMousemove",this,r)}).on("mouseout",function(t,n){e.select(this).classed("hover",!1),k.call("elementMouseout",this)}).on("click",function(t,n){e.event.stopPropagation();var r=s(e.event,t,n);k.call("elementClick",this,r)}).on("dblclick",function(t,n){e.event.stopPropagation();var r=s(e.event,t,n);k.call("elementDblClick",this,r)}),at.select(".sc-base").attr("d",et).style("stroke-opacity",1);var it=o.map(function(t){return t.values[0]});Z.attr("transform",p);var ot=Z.selectAll("text").data(it),lt=ot.enter().append("text");ot.exit().remove();var st=Z.selectAll("text").merge(lt);if(st.attr("transform",function(t){return"rotate("+d(t.y)+") translate(0,"+(G(-1.5)-_)+")"}).text(l).style("fill-opacity",g).style("text-anchor","middle").style("font-size",G(.6)+"em"),I){var ct=[[Math.round(G(S)/2),0],[0,-Math.round(G(L))],[-Math.round(G(S)/2),0],[0,Math.round(G(S))],[Math.round(G(S)/2),0]];U.attr("transform",p);var ut=U.selectAll("path").data([ct]),dt=ut.enter().append("path").attr("transform","rotate("+z+")");ut.exit().remove();var ft=U.selectAll("path").merge(dt);ft.attr("d",e.line()),j.append("text").attr("class","sc-odom sc-odomText").attr("x",0).attr("y",0).style("text-anchor","middle").style("stroke","none").style("fill","black"),$.select(".sc-odomText").style("font-size",G(.7)+"em").text(T),j.insert("path",".sc-odomText").attr("class","sc-odom sc-odomBox").attr("fill","#EFF").attr("stroke","black").attr("stroke-width","2px").attr("opacity",.8),$.call(u)}else U.selectAll("path").remove(),$.select(".sc-odomText").remove(),$.select(".sc-odomBox").remove();t.setGaugePointer=c}),t}var n={top:0,right:0,bottom:0,left:0},r=null,a=null,i=Math.floor(1e4*Math.random()),o=function(t){return t.key},l=function(t){return t.y},s=function(t){return"undefined"==typeof t.key?t:t.key},c=function(t,e){return isNaN(t.value)?t:t.value},u=function(t,e){return isNaN(t.count)?t:t.count},d=function(t){return s(t)},f=function(t){return c(t)},h=function(t){return(" ("+u(t)+")").replace(" ()","")},p=D.buildLocality(),g="ltr",m=0,v=0,y=function(t,e){return D.defaultColor()(t,t.seriesIndex)},b=D.colorRadialGradient,x=y,w=function(t,e){return"sc-slice sc-series-"+t.seriesIndex},k=e.dispatch("chartClick","elementClick","elementDblClick","elementMouseover","elementMouseout","elementMousemove"),M=50,A=!0,I=!0,C=.01,S=5,F=5,L=90,T=0,E=0,P=10,z=-90,N=90,H=10;return t.dispatch=k,t.id=function(e){return arguments.length?(i=e,t):i},t.color=function(e){return arguments.length?(y=e,t):y},t.fill=function(e){return arguments.length?(x=e,t):x},t.classes=function(e){return arguments.length?(w=e,t):w},t.gradient=function(e){return arguments.length?(b=e,t):b},t.margin=function(e){return arguments.length?(n.top="undefined"!=typeof e.top?e.top:n.top,n.right="undefined"!=typeof e.right?e.right:n.right,n.bottom="undefined"!=typeof e.bottom?e.bottom:n.bottom,n.left="undefined"!=typeof e.left?e.left:n.left,t):n},t.width=function(e){return arguments.length?(r=e,t):r},t.height=function(e){return arguments.length?(a=e,t):a},t.x=function(e){return arguments.length?(o=e,t):o},t.y=function(e){return arguments.length?(l=D.functor(e),t):l},t.getKey=function(e){return arguments.length?(s=e,t):s},t.getValue=function(e){return arguments.length?(c=e,t):c},t.getCount=function(e){return arguments.length?(u=e,t):u},t.fmtKey=function(e){return arguments.length?(d=e,t):d},t.fmtValue=function(e){return arguments.length?(f=e,t):f},t.fmtCount=function(e){return arguments.length?(h=e,t):h},t.direction=function(e){return arguments.length?(g=e,t):g},t.delay=function(e){return arguments.length?(m=e,t):m},t.duration=function(e){return arguments.length?(v=e,t):v},t.locality=function(e){return arguments.length?(p=D.buildLocality(e),t):p},t.showLabels=function(e){return arguments.length?(A=e,t):A},t.labelThreshold=function(e){return arguments.length?(C=e,t):C},t.ringWidth=function(e){return arguments.length?(M=e,t):M},t.pointerWidth=function(e){return arguments.length?(S=e,
t):S},t.pointerTailLength=function(e){return arguments.length?(F=e,t):F},t.pointerHeadLength=function(e){return arguments.length?(L=e,t):L},t.setPointer=function(e){return arguments.length?(t.setGaugePointer(e),t):t.setGaugePointer},t.showPointer=function(e){return arguments.length?(I=e,t):I},t.minValue=function(e){return arguments.length?(E=e,t):E},t.maxValue=function(e){return arguments.length?(P=e,t):P},t.minAngle=function(e){return arguments.length?(z=e,t):z},t.maxAngle=function(e){return arguments.length?(N=e,t):N},t.labelInset=function(e){return arguments.length?(H=e,t):H},t}function l(){function t(r){return r.each(function(r){function b(){K.style("opacity",.9*I).style("display",I?"inline":"none"),J.style("opacity",I).style("display",I?"inline":"none"),U.text(1===I?t.strings().close:t.strings().open)}var T=e.select(this),E=[],P=0,z=0,N="",H="start"===l,_="rtl"===o,O=d*(H?1:.6),B=u+(H?c+f:0);if(!r||!r.length||!r.filter(function(t){return!t.values||t.values.length}).length)return t;var R=r.filter(function(t){return t.hasOwnProperty("seriesIndex")}).length;r.filter(function(t){return!t.hasOwnProperty("seriesIndex")}).map(function(t,e){t.seriesIndex=R,R+=1}),y=!0,N=r[0].type&&"bar"!==r[0].type?"line":"bar",i=_&&"center"!==i?"left"===i?"right":"left":i;var V=T.selectAll("g.sc-wrap").data([r]),G=V.enter().append("g").attr("class","sc-wrap sc-menu"),W=T.select("g.sc-wrap").merge(G);W.attr("transform","translate(0,0)");var Y=G.append("defs"),q=W.select("defs");Y.append("clipPath").attr("id","sc-edge-clip-"+x).append("rect");var X=W.select("#sc-edge-clip-"+x+" rect");G.append("rect").attr("class","sc-menu-background");var K=W.select(".sc-menu-background"),Z=D.dropShadow("menu_back_"+x,q,{blur:2});G.append("text").attr("class","sc-menu-link");var U=W.select(".sc-menu-link"),j=G.append("g").attr("class","sc-menu-mask"),$=W.select(".sc-menu-mask");j.append("g").attr("class","sc-group");var J=W.select(".sc-group"),Q=J.selectAll(".sc-series").data(D.identity,function(t){return t.seriesIndex});Q.exit().remove();var tt=Q.enter().append("g").attr("class","sc-series").on("mouseover",function(t,e){A.call("legendMouseover",this,t)}).on("mouseout",function(t,e){A.call("legendMouseout",this,t)}).on("click",function(t,n){e.event.preventDefault(),e.event.stopPropagation(),A.call("legendClick",this,t)}),et=J.selectAll(".sc-series").merge(tt);et.attr("class",M).attr("fill",k).attr("stroke",k);var nt=tt.append("rect").attr("x",(c+f)/-2).attr("y",(c+O)/-2).attr("width",c+f).attr("height",c+O).style("fill","#FFE").style("stroke-width",0).style("opacity",.1),rt=et.selectAll("rects").merge(nt),at=tt.selectAll("circle").data(function(t){return"line"===N?[t,t]:[t]});at.exit().remove();var it=at.enter().append("circle").attr("r",s).style("stroke-width","2px"),ot=et.selectAll("circle").merge(it),lt=tt.selectAll("line").data("line"===N?function(t){return[t]}:[]);lt.exit().remove();var st=lt.enter().append("line").attr("x0",0).attr("y0",0).attr("y1",0).style("stroke-width","4px"),ct=et.selectAll("line").merge(st),ut=tt.append("text").attr("dx",0),dt=et.selectAll("text").merge(ut);dt.attr("dy",H?".36em":".71em").text(w),X.attr("x",.5).attr("y",.5).attr("width",0).attr("height",0),K.attr("x",.5).attr("y",.5).attr("width",0).attr("height",0).style("opacity",0).style("pointer-events","all").on("click",function(t,n){e.event.stopPropagation()}),U.text(1===I?t.strings().close:t.strings().open).attr("text-anchor","left"===i?_?"end":"start":_?"start":"end").attr("dy",".36em").attr("dx",0).style("opacity",0).on("click",function(t,n){e.event.preventDefault(),e.event.stopPropagation(),A.call("toggleMenu",this,t,n)}),et.classed("disabled",function(t){return t.disabled}),t.calcMaxWidth=function(){return E=[],J.style("display","inline"),dt.each(function(t,n){var r=e.select(this).node().getBoundingClientRect().width;E.push(Math.max(Math.floor(r),"line"===N?50:20))}),t.width(e.sum(E)+E.length*B-u),t.width()},t.getLineHeight=function(){J.style("display","inline");var t=Math.floor(dt.node().getBoundingClientRect().height);return t},t.arrange=function(r){function o(t){return E[t]+B}function y(t){return E[t]+B-u}function b(t){return t?1:-1}0===E.length&&this.calcMaxWidth();var w,k,M,A=E.length,D=1,T=A,R=[],V=[],G=r-n.left-n.right,W=a,Y=0,q=this.getLineHeight(),j=c+(H?0:q)+O,Q={top:7,right:7,bottom:7,left:7},tt=0,nt=0;if(h){for(;T>0;){for(R=[],w=0;w<A;w+=1)o(w)>(R[w%T]||0)&&(R[w%T]=o(w));if(e.sum(R)-u<G)break;T-=1}for(T=T||1,D=Math.ceil(A/T),Y=e.sum(R)-u,w=0;w<A;w+=1)k=w%T,H?0===k?tt=_?Y:0:tt+=R[k-1]*b(!_):0===k?tt=(_?Y:0)+(R[k]-u)/2*b(!_):tt+=(R[k-1]+R[k])/2*b(!_),nt=Math.floor(w/T)*j,V[w]={x:tt,y:nt}}else if(_)for(tt=G,w=0;w<A;w+=1)tt-y(w)<0&&(Y=Math.max(Y,y(w)),tt=G,w&&(D+=1)),tt-y(w)>Y&&(Y=tt-y(w)),V[w]={x:tt,y:(D-1)*(O+c)},tt-=o(w);else for(tt=0,w=0;w<A;w+=1)w&&tt+y(w)>G&&(tt=0,D+=1),tt+y(w)>Y&&(Y=tt+y(w)),V[w]={x:tt,y:(D-1)*(O+c)},tt+=o(w);if(!g&&(p||D<=v)){switch(I=0,m=!1,C=!1,t.width(n.left+Y+n.right).height(n.top+D*j-O+n.bottom),i){case"left":M=0;break;case"center":M=(r-t.width())/2;break;case"right":M=0}X.attr("y",0).attr("width",t.width()).attr("height",t.height()),K.attr("x",M).attr("width",t.width()).attr("height",t.height()).attr("rx",0).attr("ry",0).attr("filter","none").style("display","inline").style("opacity",0),$.attr("clip-path","none").attr("transform",function(t,e){var r=M+n.left+(H?s*b(!_):0),a=n.top+Q.top;return"translate("+r+","+a+")"}),J.style("opacity",1).style("display","inline"),et.attr("transform",function(t){var e=V[t.seriesIndex];return"translate("+e.x+","+e.y+")"}),rt.attr("x",function(t){var e=0;return H?(e=(c+u)/2*b(_),e-=_?o(t.seriesIndex):0):e=o(t.seriesIndex)/-2,e}).attr("width",function(t){return o(t.seriesIndex)}).attr("height",j),ot.attr("r",function(t){return"dash"===t.type?0:s}).attr("transform",function(t,e){var n=H||"bar"===N?0:3*s*b(e);return"translate("+n+",0)"}),ct.attr("x1",function(t){return"dash"===t.type?8*s:4*s}).attr("transform",function(t){var e=s*("dash"===t.type?-4:-2);return"translate("+e+",0)"}).style("stroke-dasharray",function(t){return"dash"===t.type?"8, 8":"none"}).style("stroke-dashoffset",-4),dt.attr("dy",H?".36em":".71em").attr("text-anchor",l).attr("transform",function(t){var e=H?(s+f)*b(!_):0,n=H?0:(c+O)/2;return"translate("+e+","+n+")"})}else m=!0,C=!0,t.width(Q.left+e.max(E)+c+f+Q.right).height(n.top+c+n.top),P=Q.top+c*A+d*(A-1)+Q.bottom,z=Math.min(W-t.height(),P),X.attr("x",.5-Q.top-s).attr("y",.5-Q.top-s).attr("width",t.width()).attr("height",z),K.attr("x",.5).attr("y",.5+t.height()).attr("width",t.width()).attr("height",z).attr("rx",2).attr("ry",2).attr("filter",Z).style("opacity",.9*I).style("display",I?"inline":"none"),U.attr("transform",function(e,r){var a="left"===i?.5:.5+t.width(),o=n.top+s;return"translate("+a+","+o+")"}).style("opacity",1),$.attr("clip-path","url(#sc-edge-clip-"+x+")").attr("transform",function(e,n){var r=Q.left+s,a=t.height()+Q.top+s;return"translate("+r+","+a+")"}),J.style("opacity",I).style("display",I?"inline":"none").attr("transform",function(t,n){var r=_?e.max(E)+s:0;return"translate("+r+",0)"}),et.attr("transform",function(t,e){var n=e*(c+d);return"translate(0,"+n+")"}),rt.attr("x",function(t){var e=(c+u)/2*b(_);return e-=_?o(t.seriesIndex):0}).attr("width",function(t){return o(t.seriesIndex)}).attr("height",c+O),ot.attr("r",function(t){return"dash"===t.type?0:"line"===t.type?s-2:s}).attr("transform",""),ct.attr("x1",16).attr("transform","translate(-8,0)").style("stroke-dasharray",function(t){return"dash"===t.type?"6, 4, 6":"none"}).style("stroke-dashoffset",0),dt.attr("text-anchor","start").attr("dy",".36em").attr("transform",function(t){var e=(s+f)*b(!_);return"translate("+e+",0)"});if(S){var at=z-P,it=function(t){if(t){var n=e.zoom().on("zoom",lt);K.call(n),J.call(n)}else K.on(".zoom",null),J.on(".zoom",null)},lt=function(){var t=0,n=0,r="",a=0,i=0,o=e.event;!o||"click"!==o.type&&"zoom"!==o.type||("zoom"===o.type&&o.sourceEvent&&(a=-o.sourceEvent.deltaX||o.sourceEvent.movementX||0,i=-o.sourceEvent.deltaY||o.sourceEvent.movementY||0,t=Math.abs(a)>Math.abs(i)?a:i),n=Math.abs(i)>Math.abs(a)?i:0,F=Math.min(Math.max(F+t,at),0),r="translate("+(_?e.max(E)+s:0)+","+F+")",(F+t>0||F+t<at)&&L(n),J.attr("transform",r))};it(C)}},A.on("toggleMenu",function(t){e.event.stopPropagation(),I=1-I,b()}),A.on("closeMenu",function(t){1===I&&(I=0,b())})}),t}var n={top:10,right:10,bottom:15,left:10},r=0,a=0,i="right",o="ltr",l="start",s=6,c=2*s,u=10,d=12,f=5,h=!0,p=!1,g=!1,m=!1,v=3,y=!1,b={close:"Hide legend",type:"Show legend",noLabel:"undefined"},x=Math.floor(1e4*Math.random()),w=function(e){return e.key.length>0||!isNaN(parseFloat(e.key))&&isFinite(e.key)?e.key:t.strings().noLabel},k=function(t){return D.defaultColor()(t,t.seriesIndex)},M=function(t){return"sc-series sc-series-"+t.seriesIndex},A=e.dispatch("legendClick","legendMouseover","legendMouseout","toggleMenu","closeMenu"),I=0,C=!1,S=!0,F=0,L=function(t){};return t.dispatch=A,t.margin=function(e){return arguments.length?(n.top="undefined"!=typeof e.top?e.top:n.top,n.right="undefined"!=typeof e.right?e.right:n.right,n.bottom="undefined"!=typeof e.bottom?e.bottom:n.bottom,n.left="undefined"!=typeof e.left?e.left:n.left,t):n},t.width=function(e){return arguments.length?(r=Math.round(e),t):r},t.height=function(e){return arguments.length?(a=Math.round(e),t):a},t.id=function(e){return arguments.length?(x=e,t):x},t.key=function(e){return arguments.length?(w=e,t):w},t.color=function(e){return arguments.length?(k=D.getColor(e),t):k},t.classes=function(e){return arguments.length?(M=e,t):M},t.align=function(e){return arguments.length?(i=e,t):i},t.position=function(e){return arguments.length?(l=e,t):l},t.showAll=function(e){return arguments.length?(p=e,t):p},t.showMenu=function(e){return arguments.length?(g=e,t):g},t.collapsed=function(t){return m},t.rowsCount=function(e){return arguments.length?(v=e,t):v},t.spacing=function(e){return arguments.length?(d=e,t):d},t.gutter=function(e){return arguments.length?(u=e,t):u},t.radius=function(e){return arguments.length?(s=e,t):s},t.strings=function(e){return arguments.length?(b=e,t):b},t.equalColumns=function(e){return arguments.length?(h=e,t):h},t.enabled=function(e){return arguments.length?(y=e,t):y},t.direction=function(e){return arguments.length?(o=e,t):o},t}function s(){function t(l){return l.each(function(l){var y=e.select(this),b=y.select(".sc-chart-wrap"),x=b.select(".sc-title-wrap"),w=b.select(".sc-controls-wrap"),k=b.select(".sc-legend-wrap"),M=a.margin(),A=0,I=0,C=0,S=0,F=0,L={width:0,height:0,top:0,left:0},T=0,E=0,P=0;if(d=d&&s&&s.length>0,x.select(".sc-title").remove(),d&&(x.append("text").attr("class","sc-title").attr("x","rtl"===m?n:0).attr("y",0).attr("dy",".75em").attr("text-anchor","start").attr("stroke","none").attr("fill","black").text(s),L=D.getTextBBox(x.select(".sc-title"),!0),L.top-=y.node().getBoundingClientRect().top,T=L.height),f&&(i.id("controls_"+a.id()).strings(v.controls).color(["#444"]).align(p).height(r-T),w.datum(c).call(i),C=i.calcMaxWidth()),h&&(o.id("legend_"+a.id()).strings(v.legend).align(g).height(r-T),k.datum(u).call(o),S=o.calcMaxWidth()),F=n/(C+S),C=Math.floor(C*F),S=Math.floor(S*F),f&&(i.arrange(C),S=n-i.width()),h&&(o.arrange(S),C=n-o.width()),f&&(A="rtl"===m?n-i.width():0,I=d?L.height-M.top+L.top:0-i.margin().top,w.attr("transform",D.translation(A,I)),E=i.height()-(d?0:i.margin().top)),h){var z=D.getTextBBox(k.select(".sc-menu-link")),N=n-L.width-6,H=!!(d&&!f&&o.collapsed()&&N>z.width);A="rtl"===m||!o.collapsed()&&"center"===g?0:n-o.width(),H?(I=L.height-o.height()/2-z.height/2,I-=M.top-L.top):I=d?L.height-M.top+L.top:0-o.margin().top,k.attr("transform",D.translation(A,I)),P=H?o.margin().bottom:o.height()-(d?0:o.margin().top)}t.getHeight=function(){var t=T+Math.max(E,P,10);return t}}),t}var n=960,r=500,a=null,i=l(),o=l(),s="",c=[],u=[],d=!1,f=!1,h=!1,p="left",g="right",m="ltr",v={legend:{close:"Hide legend",open:"Show legend"},controls:{close:"Hide controls",open:"Show controls"},noData:"No Data Available.",noLabel:"undefined"};return t.controls=i,t.legend=o,t.chart=function(e){return arguments.length?(a=e,t):a},t.width=function(e){return arguments.length?(n=e,t):n},t.height=function(e){return arguments.length?(r=e,t):r},t.title=function(e){return arguments.length?(s=e,t):s},t.controlsData=function(e){return arguments.length?(c=e,t):c},t.legendData=function(e){return arguments.length?(u=e,t):u},t.showTitle=function(e){return arguments.length?(d=e,t):d},t.showControls=function(e){return arguments.length?(f=e,t):f},t.showLegend=function(e){return arguments.length?(h=e,t):h},t.alignControls=function(e){return arguments.length?(p=e,t):p},t.alignLegend=function(e){return arguments.length?(g=e,t):g},t.direction=function(e){return arguments.length?(m=e,o.direction(e),i.direction(e),t):m},t.strings=function(e){if(!arguments.length)return v;for(var n in e)e.hasOwnProperty(n)&&(v[n]=e[n]);return o.strings(v.legend),i.strings(v.controls),t},t}function c(){function t(T){return T.each(function(T){function _(){if(p.domain(M||e.extent(J.map(v).concat(x))),g.domain(A||e.extent(J.map(y).concat(w))),N&&T[0])if(H===-1){var t=Math.sqrt(C[1]/Math.PI);p.range([0+t,Z-t]),g.range([U-t,0+t])}else H<1?(p.range([(Z*H+Z)/(2*T[0].values.length),Z-Z*(1+H)/(2*T[0].values.length)]),g.range([U,0])):(p.range([H,Z-H]),g.range([U-H,H]));else p.range([0,Z]),g.range([U,0]);q&&g.nice(),W=p.domain()[0]===p.domain()[1]||g.domain()[0]===g.domain()[1],p.domain()[0]===p.domain()[1]&&(p.domain()[0]?p.domain([p.domain()[0]-.1*p.domain()[0],p.domain()[1]+.1*p.domain()[1]]):p.domain([-1,1])),g.domain()[0]===g.domain()[1]&&(g.domain()[0]?g.domain([g.domain()[0]-.1*g.domain()[0],g.domain()[1]+.1*g.domain()[1]]):g.domain([-1,1])),m.domain(I||e.extent(J.map(function(t){return t.size}).concat(k))).range(C),m.domain().length<2&&m.domain([0,m.domain()]),n=n||p,r=r||g,a=a||m}function B(t,e,n,r){var a={pointIndex:n,point:e,seriesIndex:r.seriesIndex,series:r,groupIndex:e.group,id:o,e:t};return a}function K(){if(!P)return!1;if(V===!0){var t=e.merge(T.map(function(t,e){return t.values.map(function(t,n){var r=v(t,n),a=y(t,n),i=t.group;return[p(r)+1e-4*Math.random(),g(a)+1e-4*Math.random(),t,e,i,n]}).filter(function(t,e){return z(t[4],e)})}));if(G){var n=et.select("#sc-points-clip-"+o).selectAll("circle").data(t),r=n.enter().append("circle"),a=et.select("#sc-points-clip-"+o).selectAll("circle").merge(r);a.attr("cx",function(t){return t[0]}).attr("cy",function(t){return t[1]}).attr("r",function(t,e){return S(t[2],e)}),n.exit().remove(),it.attr("clip-path","url(#sc-points-clip-"+o+")")}t.length<=3&&(t.push([p.range()[0]-20,g.range()[0]-20,null,null,null,null]),t.push([p.range()[1]+20,g.range()[1]+20,null,null,null,null]),t.push([p.range()[0]-20,g.range()[0]+20,null,null,null,null]),t.push([p.range()[1]+20,g.range()[1]-20,null,null,null,null]));var i=e.voronoi().extent([[-10,-10],[l+10,s+10]]).polygons(t).map(function(e,n){return{data:e,seriesIndex:t[n][3],groupIndex:t[n][4],pointIndex:t[n][5]}}).filter(function(t){return null!==t.seriesIndex}),c=it.selectAll("path").data(i),u=c.enter().append("path").attr("class",function(t,e){return"sc-path-"+e}),d=it.selectAll("path").merge(u);d.attr("d",function(t){return t?"M"+t.data.join("L")+"Z":null}),c.exit().remove(),d.on("mouseover",function(t){var n=T[t.seriesIndex],r=t.pointIndex,a=n.values[r];if(X||!n)return 0;var i=B(e.event,a,r,n);Y.call("elementMouseover",this,i)}).on("mousemove",function(t){var n=e.event;Y.call("elementMousemove",this,n)}).on("mouseout",function(t){var n=T[t.seriesIndex],r=t.pointIndex,a=n.values[r];if(X||!n)return 0;var i=B(e.event,a,r,n);Y.call("elementMouseout",this,i)}).on("click",function(t){var n=T[t.seriesIndex],r=t.pointIndex,a=n.values[r];if(X||!n)return 0;var i=B(e.event,a,r,n);Y.call("elementClick",this,i)})}else st.selectAll(".sc-point").style("pointer-events","auto").on("mouseover",function(t,n){var r=e.select(this.parentNode).datum(),a=r.values[n];if(X||!r)return 0;var i=B(e.event,a,n,r);Y.call("elementMouseover",this,i)}).on("mousemove",function(t,n){var r=e.event;Y.call("elementMousemove",this,r)}).on("mouseout",function(t,n){var r=e.select(this.parentNode).datum(),a=r.values[n];if(X||!r)return 0;var i=B(e.event,a,n,r);Y.call("elementMouseout",this,i)}).on("click",function(t,n){var r=e.select(this.parentNode).datum(),a=r.values[n];if(X||!r)return 0;var i=B(e.event,a,n,r);Y.call("elementClick",this,i)});X=!1}var Z=l-c.left-c.right,U=s-c.top-c.bottom,j=e.select(this),$=e.transition("scatter").duration(R).ease(e.easeLinear);X=!0;var J=M&&A&&I?[]:e.merge(T.map(function(t){return t.values.map(function(t,e){return{x:v(t,e),y:y(t,e),size:b(t,e)}})}));t.resetDimensions=function(t,e){l=t,s=e,Z=t-c.left-c.right,U=e-c.top-c.bottom,_()},_();var Q=j.selectAll("g.sc-wrap.sc-scatter").data([T]),tt=Q.enter().append("g").attr("class","sc-wrap sc-scatter"),et=j.select(".sc-wrap.sc-scatter").merge(tt),nt=tt.append("defs"),rt=et.select("defs");tt.append("g").attr("class","sc-group");var at=et.select(".sc-group");tt.append("g").attr("class","sc-point-paths");var it=et.select(".sc-point-paths");et.classed("sc-single-point",W).attr("transform",D.translation(c.left,c.top)),nt.append("clipPath").attr("id","sc-edge-clip-"+o).append("rect"),nt.append("clipPath").attr("id","sc-points-clip-"+o).attr("class","sc-point-clips"),rt.select("#sc-edge-clip-"+o+" rect").attr("width",Z).attr("height",U),et.attr("clip-path",O?"url(#sc-edge-clip-"+o+")":""),t.gradientFill=function(t,e){var n=o+"-"+e,r={x:.5,y:.5,r:.5,s:0,u:"objectBoundingBox"},a=u(t,e);return d(t,n,r,a,rt)};var ot=at.selectAll(".sc-series").data(D.identity,function(t){return t.seriesIndex}),lt=ot.enter().append("g").attr("class","sc-series").style("stroke-opacity",1e-6).style("fill-opacity",1e-6),st=at.selectAll(".sc-series").merge(lt);st.attr("class",function(t,e){return h(t,t.seriesIndex)}).attr("fill",function(t,e){return f(t,t.seriesIndex)}).attr("stroke",function(t,e){return f(t,t.seriesIndex)}).classed("hover",function(t){return t.hover}),st.transition($).style("stroke-opacity",1).style("fill-opacity",1),ot.exit().transition($).style("stroke-opacity",1e-6).style("fill-opacity",1e-6).remove();var ct,ut,dt;E?(ct=st.selectAll("circle.sc-point").data(function(t){return t.values}),ut=ct.enter().append("circle").attr("class",function(t,e){return"sc-point sc-enter sc-point-"+e}).attr("r",S),dt=st.selectAll(".sc-point").merge(ut),dt.filter(function(t){return e.select(this).classed("sc-enter")}).attr("cx",function(t,e){return p(v(t,e))}).attr("cy",function(t,e){return g(0)}),dt.transition($).attr("cx",function(t,e){return p(v(t,e))}).attr("cy",function(t,e){return g(y(t,e))}).on("end",function(t){e.select(this).classed("sc-enter",!1).classed("sc-active",function(t){return"active"===t.active})}),ot.exit().transition($).selectAll(".sc-point").attr("cx",function(t,e){return p(v(t,e))}).attr("cy",function(t,e){return g(0)}).remove()):(ct=st.selectAll("path.sc-point").data(function(t){return t.values}),ut=ct.enter().append("path").attr("class",function(t,e){return"sc-point sc-enter sc-point-"+e}).attr("d",e.symbol().type(L).size(F)),dt=st.selectAll(".sc-point").merge(ut),dt.filter(function(t){return e.select(this).classed("sc-enter")}).attr("transform",function(t,e){return"translate("+n(v(t,e))+","+g(0)+")"}),dt.transition($).attr("transform",function(t,e){return"translate("+p(v(t,e))+","+g(y(t,e))+")"}).attr("d",e.symbol().type(L).size(F)).on("end",function(t){e.select(this).classed("sc-enter",!1).classed("active",function(t){return"active"===t.active})}),ot.exit().transition($).selectAll(".sc-point").attr("transform",function(t,e){return"translate("+p(v(t,e))+","+g(0)+")"}).remove()),clearTimeout(i),i=setTimeout(K,300),n=p.copy(),r=g.copy(),a=m.copy(),Y.on("elementMouseover.point",function(t){P&&j.select(".sc-series-"+t.seriesIndex+" .sc-point-"+t.pointIndex).classed("hover",!0)}),Y.on("elementMouseout.point",function(t){P&&j.select(".sc-series-"+t.seriesIndex+" .sc-point-"+t.pointIndex).classed("hover",!1)})}),t}var n,r,a,i,o=Math.floor(1e5*Math.random()),l=960,s=500,c={top:0,right:0,bottom:0,left:0},u=function(t,e){return D.defaultColor()(t,t.seriesIndex)},d=D.colorRadialGradient,f=u,h=function(t,e){return"sc-series sc-series-"+t.seriesIndex},p=e.scaleLinear(),g=e.scaleLinear(),m=e.scaleLinear(),v=function(t){return t.x},y=function(t){return t.y},b=function(t){return t.size||1},x=[],w=[],k=[],M=null,A=null,I=null,C=[1*Math.PI,25*Math.PI],S=function(t,e){return Math.sqrt(m(b(t,e))/Math.PI)},F=function(t,e){return m(b(t,e))},L=function(t){return t.shape||"circle"},T=D.buildLocality(),E=!0,P=!0,z=function(t){return!t.notActive},N=!1,H=.1,_="ltr",O=!1,B=0,R=0,V=!0,G=!0,W=!1,Y=e.dispatch("elementClick","elementMouseover","elementMouseout","elementMousemove"),q=!1,X=!1;return t.dispatch=Y,t.id=function(e){return arguments.length?(o=e,t):o},t.color=function(e){return arguments.length?(u=e,t):u},t.fill=function(e){return arguments.length?(f=e,t):f},t.classes=function(e){return arguments.length?(h=e,t):h},t.gradient=function(e){return arguments.length?(d=e,t):d},t.x=function(e){return arguments.length?(v=D.functor(e),t):v},t.y=function(e){return arguments.length?(y=D.functor(e),t):y},t.z=function(e){return arguments.length?(b=D.functor(e),t):b},t.xScale=function(e){return arguments.length?(p=e,t):p},t.yScale=function(e){return arguments.length?(g=e,t):g},t.zScale=function(e){return arguments.length?(m=e,t):m},t.xDomain=function(e){return arguments.length?(M=e,t):M},t.yDomain=function(e){return arguments.length?(A=e,t):A},t.zDomain=function(e){return arguments.length?(I=e,t):I},t.forceX=function(e){return arguments.length?(x=e,t):x},t.forceY=function(e){return arguments.length?(w=e,t):w},t.forceZ=function(e){return arguments.length?(k=e,t):k},t.size=function(e){return arguments.length?(b=D.functor(e),t):b},t.sizeRange=function(e){return arguments.length?(C=e,t):C},t.sizeDomain=function(e){return arguments.length?(I=e,t):I},t.forceSize=function(e){return arguments.length?(k=e,t):k},t.margin=function(e){if(!arguments.length)return c;for(var n in e)e.hasOwnProperty(n)&&(c[n]=e[n]);return t},t.width=function(e){return arguments.length?(l=e,t):l},t.height=function(e){return arguments.length?(s=e,t):s},t.interactive=function(e){return arguments.length?(P=e,t):P},t.pointActive=function(e){return arguments.length?(z=e,t):z},t.padData=function(e){return arguments.length?(N=e,t):N},t.padDataOuter=function(e){return arguments.length?(H=e,t):H},t.clipEdge=function(e){return arguments.length?(O=e,t):O},t.clipVoronoi=function(e){return arguments.length?(G=e,t):G},t.useVoronoi=function(e){return arguments.length?(V=e,V===!1&&(G=!1),t):V},t.circleRadius=function(e){return arguments.length?(S=e,t):S},t.clipRadius=function(e){return arguments.length?(S=e,t):S},t.shape=function(e){return arguments.length?(L=e,t):L},t.onlyCircles=function(e){return arguments.length?(E=e,t):E},t.singlePoint=function(e){return arguments.length?(W=e,t):W},t.delay=function(e){return arguments.length?(B=e,t):B},t.duration=function(e){return arguments.length?(R=e,t):R},t.direction=function(e){return arguments.length?(_=e,t):_},t.nice=function(e){return arguments.length?(q=e,t):q},t.locality=function(e){return arguments.length?(T=D.buildLocality(e),t):T},t}function u(){function t(c){return c.each(function(c){function g(t){if(!t.values||!t.values.length)return[null];if(t.values.length>1)return[t.values];var e=n.domain().map(function(e,n){if(Array.isArray(t.values[0]))return[e,t.values[0][1]];var r=JSON.parse(JSON.stringify(t.values[0]));return r.x=e,r});return[e]}var b=e.select(this),w=o-i.left-i.right,k=l-i.top-i.bottom,M="linear"===h?e.curveLinear:"cardinal"===h?e.curveCardinal:"monotone"===h?e.curveMonotoneX:"basis"===h?e.curveBasis:e.curveNatural,A=e.area().curve(M).defined(d).x(function(t,e){return n(s(t,e))}).y0(function(t,e){return r(u(t,e))}).y1(function(t,e){return r(r.domain()[0]<=0?r.domain()[1]>=0?0:r.domain()[1]:r.domain()[0])}),I=e.area().curve(M).defined(d).x(function(t,e){return n(s(t,e))}).y0(function(t,e){return r(0)}).y1(function(t,e){return r(r.domain()[0]<=0?r.domain()[1]>=0?0:r.domain()[1]:r.domain()[0])}),C=e.transition("points").duration(m).ease(e.easeLinear),S=a.id();y=function(t,e,n){return D.colorLinearGradient(t,a.id()+"-"+e,n,v(t,e),T.select("defs"))},n=a.xScale(),r=a.yScale(),t.resetDimensions=function(t,e){o=t,l=e,w=t-i.left-i.right,k=e-i.top-i.bottom,a.resetDimensions(t,e)};var F=b.selectAll("g.sc-wrap.sc-line").data([c]),L=F.enter().append("g").attr("class","sc-wrap sc-line"),T=b.select(".sc-wrap.sc-line").merge(L),E=L.append("defs");L.append("g").attr("class","sc-group");var P=T.select(".sc-group");L.append("g").attr("class","sc-scatter-wrap");var z=T.select(".sc-scatter-wrap");T.attr("transform",D.translation(i.left,i.top)),E.append("clipPath").attr("id","sc-edge-clip-"+S).append("rect"),T.select("#sc-edge-clip-"+S+" rect").attr("width",w).attr("height",k),T.attr("clip-path",p?"url(#sc-edge-clip-"+S+")":""),z.attr("clip-path",p?"url(#sc-edge-clip-"+S+")":"");var N=P.selectAll("g.sc-series").data(c,function(t){return t.seriesIndex}),H=N.enter().append("g").attr("class","sc-series").style("stroke-opacity",1e-6).style("fill-opacity",1e-6),_=P.selectAll(".sc-series").merge(H);_.classed("hover",function(t){return t.hover}).attr("class",x).attr("fill",v).attr("stroke",v),_.transition(C).style("stroke-opacity",1).style("fill-opacity",.5),N.exit().transition(C).style("stroke-opacity",1e-6).style("fill-opacity",1e-6).remove(),a.clipEdge(p).width(w).height(k),z.call(a);var O=_.selectAll("path.sc-area").data(function(t){return f(t)?[t]:[]}),B=O.enter().append("path").attr("class","sc-area sc-enter"),R=_.selectAll(".sc-area").merge(B);R.filter(function(t){return e.select(this).classed("sc-enter")}).attr("d",function(t){return I.apply(this,[t.values])}),R.transition(C).attr("d",function(t){return A.apply(this,[t.values])}).on("end",function(t){e.select(this).classed("sc-enter",!1)}),O.exit().remove(),N.exit().transition(C).selectAll(".sc-area").attr("d",function(t){return I.apply(this,[t.values])}).remove();var V=_.selectAll("path.sc-line").data(g,function(t){return t.seriesIndex}),G=V.enter().append("path").attr("class","sc-line sc-enter"),W=_.selectAll(".sc-line").merge(G);W.filter(function(t){return e.select(this).classed("sc-enter")}).attr("d",e.line().curve(M).defined(d).x(function(t,e){return n(s(t,e))}).y(function(t,e){return r(0)})),W.transition(C).attr("d",e.line().curve(M).defined(d).x(function(t,e){return n(s(t,e))}).y(function(t,e){return r(u(t,e))})).on("end",function(t){e.select(this).classed("sc-enter",!1)}),N.exit().transition(C).selectAll(".sc-line").attr("d",e.line().curve(M).defined(d).x(function(t,e){return n(s(t,e))}).y(function(t,e){return r(0)})).remove()}),t}var n,r,a=c(),i={top:0,right:0,bottom:0,left:0},o=960,l=500,s=function(t){return t.x},u=function(t){return t.y},d=function(t,e){return!isNaN(u(t,e))&&null!==u(t,e)},f=function(t){return t&&t.area||!1},h="linear",p=!1,g=0,m=0,v=function(t,e){return D.defaultColor()(t,t.seriesIndex)},y=null,b=v,x=function(t,e){return"sc-series sc-series-"+t.seriesIndex};return t.dispatch=a.dispatch,t.scatter=a,D.rebind(t,a,"id","interactive","size","xScale","yScale","zScale","xDomain","yDomain","sizeDomain","sizeRange","forceX","forceY","forceSize","useVoronoi","clipVoronoi","clipRadius","padData","padDataOuter","singlePoint","direction","nice","locality"),t.color=function(e){return arguments.length?(v=e,a.color(v),t):v},t.fill=function(e){return arguments.length?(b=e,a.fill(b),t):b},t.classes=function(e){return arguments.length?(x=e,a.classes(x),t):x},t.gradient=function(e){return arguments.length?(y=e,t):y},t.margin=function(e){if(!arguments.length)return i;for(var n in e)e.hasOwnProperty(n)&&(i[n]=e[n]);return t},t.width=function(e){return arguments.length?(o=e,t):o},t.height=function(e){return arguments.length?(l=e,t):l},t.x=function(e){return arguments.length?(s=e,a.x(e),t):s},t.y=function(e){return arguments.length?(u=e,a.y(e),t):u},t.delay=function(e){return arguments.length?(g=e,t):g},t.duration=function(e){return arguments.length?(m=e,a.duration(e),t):m},t.clipEdge=function(e){return arguments.length?(p=e,t):p},t.interpolate=function(e){return arguments.length?(h=e,t):h},t.defined=function(e){return arguments.length?(d=e,t):d},t.isArea=function(e){return arguments.length?(f=D.functor(e),t):f},t}function d(){function t(n){return n.each(function(n){function h(t,e){return Math.max(Math.round(Math.abs(c(f(t,e))-c(0))),0)}function A(){return s.bandwidth()/(m?1:n.length)}function I(t){return t.reverse().filter(function(t,e,n){return n.indexOf(t,e+1)===-1}).reverse()}function C(){var t=t||I(tt.map(d).concat(p)),n=x?O:B,i=x?B:O,o=m?w:w*q+w,l=w*(m?.25:1),u=Math.max(.25,(n-X*o-l)/(2*o));s.domain(t).range([0,n]).paddingInner(b?.3:.25).paddingOuter(u);var f=f||e.extent(tt.map(function(t){var e=x?0:t.y,n=x?t.y:0;return m?t.y>0?t.y0+e:t.y0+n:t.y}).concat(g)),h=x?[B,0]:[0,O];if(c.domain(f).range(h),v&&(x&&m&&e.max($)+8>A()&&(U=!0),G=x&&!U?"labelHeight":"labelWidth"),"top"===j||"total"===j){var y=i,k=0,M=0,C=0;l=x?U?2:-2:2,Q.forEach(function(t,e){var n="total"===j&&m&&x&&!U?J:$[e];x&&t>0||!x&&t<0?c(t)-n<k&&(k=c(t)-n,C=n):c(t)+n>y&&(y=c(t)+n,M=n)}),x?c.range([i-(c.domain()[0]<0?M+l+2:0),c.domain()[1]>0?C+l:0]):c.range([c.domain()[0]<0?C+l+4:0,i-(c.domain()[1]>0?M+l:0)])}F&&c.nice(),r=r||s,a=a||c}function S(t,e,r){return{pointIndex:r,point:e,seriesIndex:e.seriesIndex,series:n[e.seri],groupIndex:e.groupIndex,id:u,e:t}}function z(t,e,n,r){var a=0,i=f(t,e)<0?-1:1,o=n===i<0?1:0,l=t.barLength-t[G];if(n?x:!x)a=(t.barThickness-(U===n?t.labelHeight:t.labelWidth))/2;else switch(j){case"start":a=l*(0+o)+r*i;break;case"middle":a=l/2;break;case"end":a=l*(1-o)-r*i;break;case"top":a=t.barLength*(1-o)-t.labelWidth*(0+o);break;case"total":a=t.barLength*(1-o)-(U===n?t.labelHeight:t.labelWidth)*(0+o)}return a}var _=e.select(this),O=o-i.left-i.right,B=l-i.top-i.bottom,R=x?"width":"height",V=x?"height":"width",G=x?"width":"height",W=x?"x":"y",Y=x?"y":"x",q=0,X=0,K=0,Z=n.length-1,U=!1,j=v,$=[],J=0,Q=[],tt=[];if(m?"top"!==j&&j!==!0||(j="end"):j&&("total"===j?j="top":j===!0&&(j="end"),U=x),m){var et=[];n[0].values.map(function(t,e){var r=0,a=0;n.map(function(t){var n=t.values[e];n.size=Math.abs(n.y),n.y<0?(n.y0=a-(x?0:n.size),a-=n.size):(n.y0=r+(x?n.size:0),r+=n.size)}),et[e]={neg:a,pos:r}})}if(tt=e.merge(n.map(function(t){return t.values.map(function(t,e){return{x:d(t,e),y:f(t,e),y0:t.y0}})})),q=n.length,X=n[0].values.length,v){Q="total"===j&&m?et.map(function(t){return t.neg}).concat(et.map(function(t){return t.pos})):tt.map(f);var nt=e.extent(n.map(function(t,e){return t.seriesIndex}));K=nt[0],Z=nt[1],$=D.stringSetLengths(Q,_,y,"sc-label-value"),J=D.stringSetThickness(["Xy"],_,y,"sc-label-value")[0]}t.resetDimensions=function(t,e){o=t,l=e,O=t-i.left-i.right,B=e-i.top-i.bottom,C()},C();var rt=_.selectAll("g.sc-wrap.sc-multibar").data([n]),at=rt.enter().append("g").attr("class","sc-wrap sc-multibar"),it=_.select(".sc-wrap.sc-multibar").merge(at),ot=at.append("defs"),lt=it.select("defs");if(it.attr("transform",D.translation(i.left,i.top)),M&&(ot.append("clipPath").attr("id","sc-edge-clip-"+u).append("rect"),lt.select("#sc-edge-clip-"+u+" rect").attr("width",O).attr("height",B)),it.attr("clip-path",M?"url(#sc-edge-clip-"+u+")":""),P)var st=D.createTexture(ot,u);t.gradientFill=function(t,e,n){var r=u+"-"+e,a=L(t,e);return T(t,r,n,a,lt)};var ct=it.selectAll(".sc-series").data(D.identity),ut=ct.enter().append("g").attr("class",N).style("stroke-opacity",1e-6).style("fill-opacity",1e-6);ct.exit().remove();var dt=it.selectAll(".sc-series").merge(ut);dt.attr("fill",E).attr("class",N).classed("hover",function(t){return t.hover}).classed("sc-active",function(t){return"active"===t.active}).classed("sc-inactive",function(t){return"inactive"===t.active}).style("stroke-opacity",1).style("fill-opacity",1),dt.on("mouseover",function(t,n,r){e.select(this).classed("hover",!0)}).on("mouseout",function(t,n,r){
e.select(this).classed("hover",!1)});var ft=dt.selectAll(".sc-bar").data(function(t){return t.values}),ht=ft.enter().append("g").attr("class","sc-bar");ft.exit().remove();var pt=dt.selectAll(".sc-bar").merge(ht);ht.append("rect").attr("class","sc-base").style("fill","inherit").attr("x",0).attr("y",0),P&&ht.append("rect").attr("class","sc-texture").attr("x",0).attr("y",0).style("mask","url("+st+")"),ht.append("rect").attr("class","sc-label-box").attr("x",0).attr("y",0).attr("width",0).attr("height",0).attr("rx",2).attr("ry",2).style("fill","transparent").style("stroke-width",0).style("fill-opacity",0);var gt=ht.append("text").attr("class","sc-label-value"),mt=pt.select(".sc-label-value").merge(gt);pt.attr("class",function(t,e){return"sc-bar "+(f(t,e)<0?"negative":"positive")}).classed("sc-active",function(t){return"active"===t.active}).attr("transform",function(t,e){var n;return n=m?{x:Math.round(s(d(t,e))),y:Math.round(c(t.y0))}:{x:Math.round(t.seri*A()+s(d(t,e))),y:Math.round(c(f(t,e)<0?x?0:f(t,e):x?f(t,e):0))},"translate("+n[W]+","+n[Y]+")"}).style("display",function(t,e){return 0!==h(t,e)?"inline":"none"}),pt.select("rect.sc-base").attr(W,0).attr(V,h).attr(R,A),P&&pt.select("rect.sc-texture").attr(W,0).attr(V,h).attr(R,A).style("fill",function(t,e){var n=E(t),r=D.getTextContrast(n,e);return r}),pt.on("mouseover",function(t,n){var r=S(e.event,t,n);H.call("elementMouseover",this,r)}).on("mousemove",function(t,n){var r=e.event;H.call("elementMousemove",this,r)}).on("mouseout",function(t,n){var r=S(e.event,t,n);H.call("elementMouseout",this,r)}).on("click",function(t,n){e.event.stopPropagation();var r=S(e.event,t,n);H.call("elementClick",this,r)}).on("dblclick",function(t,n){e.event.stopPropagation();var r=S(e.event,t,n);H.call("elementDblClick",this,r)}),v?(mt.text(function(t,e){var n="total"===j&&m?f(t,e)<0?et[e].neg:et[e].pos:f(t,e);return y(n)}).each(function(t,e){var n=this.getBoundingClientRect();t.labelWidth=Math.floor(n.width)+4,t.labelHeight=Math.floor(n.height),t.barLength=h(t,e),t.barThickness=A()}),mt.attr("dy","0.35em").attr("text-anchor",function(t,e){var n="middle",r=f(t,e)<0;if(x&&!U)n="middle";else{switch(j){case"start":n=r?"end":"start";break;case"middle":n="middle";break;case"end":n=r?"start":"end";break;case"top":case"total":n=r?"end":"start"}n="rtl"===k&&"middle"!==n?"start"===n?"end":"start":n}return n}).attr("transform","rotate("+(U?-90:0)+" 0,0)").attr("x",function(t,e){var n=0,r=f(t,e)<0?-1:1,a=r<0,i=(4+2*(U||!x))*r;if(x&&!U)n=t.barThickness/2;else switch(j){case"start":n=t.barLength*(a-U)+i;break;case"middle":n=t.barLength*(U?-1:1)/2;break;case"end":n=t.barLength*(!U-a)-i;break;case"top":case"total":n=t.barLength*(!U-a)+2*r}return n}).attr("y",function(t,e){var n=0,r=f(t,e)<0?-1:1,a=r<0,i=(t.labelHeight/2+(4+2*U)*("total"===j?0:1))*r;if(x&&!U)switch(j){case"start":n=t.barLength*(1-a)-i;break;case"middle":n=t.barLength/2;break;case"end":n=t.barLength*(0+a)+i;break;case"total":n=t.barLength*(0+a)+i*-1}else n=t.barThickness/2;return n}).style("fill",function(t,e,n){if("top"===j||"total"===j)return"#000";var r=E(t),a=D.getTextContrast(r,e);return a}).style("fill-opacity",function(t,e){if("total"===j){if(t.seriesIndex!==K&&t.seriesIndex!==Z)return 0;var n=f(t,e);return n<0&&et[e].neg===t.y0+(x?n:0)||n>=0&&et[e].pos===t.y0+(x?0:n)?1:0}var r=t.barLength<(!x||U?t.labelWidth:t.labelHeight)+8,a=t.barThickness<(!x||U?t.labelHeight:t.labelWidth)+4;return"top"!==j&&(r||a)?0:1}),"total"===j&&m&&pt.select("rect.sc-label-box").style("fill-opacity",0),pt.filter(function(t,e){return"total"!==j||!m||(t.seriesIndex===K||t.seriesIndex===Z)}).select("rect.sc-label-box").attr("x",function(t,e){return z(t,e,!0,4)}).attr("y",function(t,e){return z(t,e,!1,-4)}).attr("width",function(t,e){return U?t.labelHeight:t.labelWidth}).attr("height",function(t,e){return U?t.labelWidth:t.labelHeight}).style("fill",function(t,e){return"top"===j||"total"===j?"#fff":E(t,e)}).style("fill-opacity",function(t,e){var n=t.barLength<(!x||U?t.labelWidth:t.labelHeight)+8,r=t.barThickness<(!x||U?t.labelHeight:t.labelWidth)+4;return"top"!==j&&(n||r)?0:1})):(mt.text("").style("fill-opacity",0),pt.select("rect.label-box").style("fill-opacity",0)),r=s.copy(),a=c.copy()}),t}var n,r,a,i={top:0,right:0,bottom:0,left:0},o=960,l=500,s=e.scaleBand(),c=e.scaleLinear(),u=Math.floor(1e4*Math.random()),d=function(t){return t.x},f=function(t){return t.y},h=D.buildLocality(),p=[],g=[0],m=!0,v=!1,y=function(t){return t},b=!1,x=!0,w=60,k="ltr",M=!1,A=0,I=0,C=null,S=null,F=!1,L=function(t,e){return D.defaultColor()(t,t.seriesIndex)},T=D.colorLinearGradient,E=L,P=!1,z=null,N=function(t,e){return"sc-series sc-series-"+t.seriesIndex},H=e.dispatch("chartClick","elementClick","elementDblClick","elementMouseover","elementMouseout","elementMousemove");return t.dispatch=H,t.color=function(e){return arguments.length?(L=e,t):L},t.fill=function(e){return arguments.length?(E=e,t):E},t.classes=function(e){return arguments.length?(N=e,t):N},t.gradient=function(e){return arguments.length?(T=e,t):T},t.x=function(e){return arguments.length?(d=e,t):d},t.y=function(e){return arguments.length?(f=e,t):f},t.margin=function(e){if(!arguments.length)return i;for(var n in e)e.hasOwnProperty(n)&&(i[n]=e[n]);return t},t.width=function(e){return arguments.length?(o=e,t):o},t.height=function(e){return arguments.length?(l=e,t):l},t.xScale=function(e){return arguments.length?(s=e,t):s},t.yScale=function(e){return arguments.length?(c=e,t):c},t.xDomain=function(e){return arguments.length?(C=e,t):C},t.yDomain=function(e){return arguments.length?(S=e,t):S},t.forceX=function(e){return arguments.length?(p=e,t):p},t.forceY=function(e){return arguments.length?(g=e,t):g},t.stacked=function(e){return arguments.length?(m=e,t):m},t.barColor=function(e){return arguments.length?(z=D.getColor(e),t):z},t.disabled=function(e){return arguments.length?(n=e,t):n},t.id=function(e){return arguments.length?(u=e,t):u},t.delay=function(e){return arguments.length?(A=e,t):A},t.duration=function(e){return arguments.length?(I=e,t):I},t.clipEdge=function(e){return arguments.length?(M=e,t):M},t.showValues=function(e){return arguments.length?(v=isNaN(parseInt(e,10))?e:parseInt(e,10)&&!0||!1,t):v},t.valueFormat=function(e){return arguments.length?(y=e,t):y},t.withLine=function(e){return arguments.length?(b=e,t):b},t.vertical=function(e){return arguments.length?(x=e,t):x},t.baseDimension=function(e){return arguments.length?(w=e,t):w},t.direction=function(e){return arguments.length?(k=e,t):k},t.textureFill=function(e){return arguments.length?(P=e,t):P},t.nice=function(e){return arguments.length?(F=e,t):F},t.locality=function(e){return arguments.length?(h=D.buildLocality(e),t):h},t}function f(){function t(o){return o.each(function(o){function u(t,e,n){return{id:i,key:c(e),value:l(e),count:s(e),data:e,series:e.series,seriesIndex:e.series.seriesIndex,e:t}}function d(t,n,r){function a(t){return(t+f)%l}var i=[],o=[],l=2*Math.PI,s=0,c=Math.PI/2,u=Math.PI,d=3*Math.PI/2,f=0;t.each(function(t,e){var h=0===B(t)?0:(B(t)+l)%l,p=0===R(t)?0:(R(t)+l)%l,g=Math.round(1e4*Math.sin(h))/1e4,m=Math.round(1e4*Math.sin(p))/1e4,v=Math.round(1e4*Math.cos(h))/1e4,y=Math.round(1e4*Math.cos(p))/1e4;f=p<h?l-h:0,p===h?(h=0,p=l):(h=a(h),p=a(p)),s=a(s),c=a(c),u=a(u),d=a(d),h%l!==0&&p%l!==0||(o.push(r),C&&o.push(r*z)),h<=c&&p>=c&&(i.push(n),C&&i.push(n*z)),h<=u&&p>=u&&(o.push(-r),C&&o.push(-r*z)),h<=d&&p>=d&&(i.push(-n),C&&i.push(-n*z)),i.push(n*g),i.push(n*m),C?(i.push(n*z*g),i.push(n*z*m)):i.push(0),o.push(r*v),o.push(r*y),C?(o.push(r*z*v),o.push(r*z*y)):o.push(0)}),ct=e.extent(i),ut=e.extent(o),lt*=P/(e.max(ct)-e.min(ct)),st*=W/(e.max(ut)-e.min(ut))}function f(){var t=[lt],n=[st+L];rt.select(".sc-base").each(function(e,r){if(g(e)){var a=(B(e)+R(e))/2,i=Math.sin(a),o=Math.cos(a),l=lt-ht-q[r],s=st-ft,c=i?l/i:l,u=o?s/o:s;t.push(c),n.push(u)}});var r=e.min(t.concat(n).concat([]),function(t){return Math.abs(t)});return r}function p(){var t=.3*Q.node().getBoundingClientRect().height,n=Math.abs(st*e.min(ut)),r=Math.round(t-n);return r}function g(t){var e=(R(t)-B(t))/(2*Math.PI);return e>I?1:0}function E(t,e){var n=2*Math.PI,r=((B(t)+R(t))/2+n)%n;return r>0&&r<Math.PI?1:-1}var P=r-n.left-n.right,W=a-n.top-n.bottom,Y=e.select(this),q=[],X=!(!w||!M);X&&(q=D.stringSetLengths(o,Y,c,"sc-label"));var K=Y.selectAll("g.sc-wrap").data([o]),Z=K.enter().append("g").attr("class","sc-wrap sc-pie"),U=Y.select(".sc-wrap.sc-pie").merge(Z),j=Z.append("defs"),$=U.select("defs");Z.append("g").attr("class","sc-group");var J=U.select(".sc-group");Z.append("g").attr("class","sc-hole-wrap");var Q=U.select(".sc-hole-wrap");if(U.attr("transform",D.translation(n.left,n.top)),b)var tt=D.createTexture(j,i,-P/2,-W/2);t.gradientFill=function(t,e){var n=i+"-"+e,r={x:0,y:0,r:yt,s:C?100*z+"%":"0%",u:"userSpaceOnUse"},a=m(t,e);return v(t,n,r,a,$)};var et=J.selectAll(".sc-series").data(G),nt=et.enter().append("g").attr("class","sc-series");et.exit().remove();var rt=J.selectAll(".sc-series").merge(nt);nt.style("stroke","#FFF").style("stroke-width",2).style("stroke-opacity",0).on("mouseover",function(t,n,r){e.select(this).classed("hover",!0)}).on("mouseout",function(t,n,r){e.select(this).classed("hover",!1)}),rt.attr("class",function(t){return x(t.data,t.data.seriesIndex)}).attr("fill",function(t){return y(t.data,t.data.seriesIndex)}).classed("sc-active",function(t){return"active"===t.data.active}).classed("sc-inactive",function(t){return"inactive"===t.data.active});var at=rt.selectAll("g.sc-slice").data(function(t,e){return t.data.values.map(function(n,r){return n.endAngle=t.endAngle,n.padAngle=t.padAngle,n.startAngle=t.startAngle,n.index=e,n})},function(t){return t.seriesIndex});at.exit().remove();var it=at.enter().append("g").attr("class","sc-slice"),ot=rt.selectAll("g.sc-slice").merge(it);it.append("path").attr("class","sc-base").each(function(t,e){this._current=t}),b&&it.append("path").attr("class","sc-texture").each(function(t,e){this._current=t}).style("mask","url("+tt+")"),it.on("mouseover",function(t,n){e.select(this).classed("hover",!0);var r=u(e.event,t,n);_.call("elementMouseover",this,r)}).on("mousemove",function(t,n){var r=e.event;_.call("elementMousemove",this,r)}).on("mouseout",function(t,n){e.select(this).classed("hover",!1),_.call("elementMouseout",this)}).on("click",function(t,n){e.event.stopPropagation();var r=u(e.event,t,n);_.call("elementClick",this,r)}).on("dblclick",function(t,n){e.event.stopPropagation();var r=u(e.event,t,n);_.call("elementDblClick",this,r)}),it.append("g").attr("class","sc-label").attr("transform","translate(0,0)"),it.select(".sc-label").append("rect").style("fill-opacity",0).style("stroke-opacity",0),it.select(".sc-label").append("text").style("fill-opacity",0),it.append("polyline").attr("class","sc-label-leader").style("stroke-opacity",0);var lt=P/2,st=W/2,ct=[],ut=[],dt=0,ft=X?5:0,ht=L+T,pt=0;ot.select(".sc-base").call(d,lt,st),Q.call(O,S?[S]:[]),S&&(pt=p(),pt>0&&(ft+=pt,dt-=pt/2));var gt=P/2,mt=W/2;X&&(L=Math.max(Math.min(Math.min(f())/12,20),10)),V(t)&&(N=V(t),H=V(t));var vt=Math.min(Math.max(f(),N),H),yt=vt-(X?L:0),bt=(e.max(ut)-e.min(ut))/2+e.min(ut),xt=(vt+dt)/mt;mt+=bt*xt+dt/2;var wt=(e.max(ct)-e.min(ct))/2-e.max(ct),kt=vt/gt;gt+=wt*kt,J.attr("transform","translate("+gt+","+mt+")"),Q.attr("transform","translate("+gt+","+mt+")"),J.select(tt).attr("x",-yt/2).attr("y",-yt/2);var Mt=e.arc().innerRadius(C?yt*z:0).outerRadius(yt).startAngle(B).endAngle(R),At=e.arc().innerRadius(0).outerRadius(yt).startAngle(B).endAngle(R);M&&(!C||A?At.innerRadius(vt).outerRadius(vt):At.outerRadius(yt*z)),ot.select(".sc-base").attr("d",Mt).style("stroke-opacity",function(t){return B(t)===R(t)?0:1}),b&&ot.select(".sc-texture").attr("d",Mt).style("stroke-opacity",function(t){return B(t)===R(t)?0:1}).style("fill",function(t,n){var r=e.select(this.parentNode).style("fill");return D.getTextContrast(r,n)}),w?(ot.select(".sc-label").attr("transform",function(t){if(F){t.outerRadius=yt+10,t.innerRadius=yt+15;var e=(B(t)+R(t))/2*(180/Math.PI);return e+=90*E(t,At),"translate("+At.centroid(t)+") rotate("+e+")"}var n=At.centroid(t),r=k?(L+T)*E(t,At):0;return"translate("+[n[0]+r,n[1]]+")"}),ot.select(".sc-label text").text(c).attr("dy",".35em").style("fill","#555").style("fill-opacity",g).style("text-anchor",function(t){if(!M)return"middle";var e=1===E(t,At)?"start":"end";return"rtl"===h&&(e="start"===e?"end":"start"),e}),ot.each(function(t,n){var r,a,i,o,l,s;(q[n]>N||vt===N)&&(r=(B(t)+R(t))/2,a=Math.abs(Math.sin(r)),i=q[t.index],o=vt*a+L+T+i,l=P/2-gt+P/2-o,l<0&&(s=D.stringEllipsify(c(t),Y,i+l),e.select(this).select("text").text(s)))}),M?k&&ot.select(".sc-label-leader").attr("points",function(t){if(!g(t))return"0,0 0,0";var n=e.arc().innerRadius(yt).outerRadius(yt).startAngle(B).endAngle(R),r=k?L*E(t,n):0,a=n.centroid(t),i=At.centroid(t),o=[i[0]+r,i[1]];return a+" "+i+" "+o}).style("stroke","#AAA").style("fill","none").style("stroke-opacity",g):ot.select(".sc-label").each(function(t){if(g(t)){var n=e.select(this),r=n.select("text").node().getBoundingClientRect();n.select("rect").attr("rx",3).attr("ry",3).attr("width",r.width+10).attr("height",r.height+10).attr("transform",function(){return"translate("+[r.x-5,r.y-5]+")"}).style("fill","#FFF").style("fill-opacity",g)}})):(ot.select(".sc-label-leader").style("stroke-opacity",0),ot.select(".sc-label rect").style("fill-opacity",0),ot.select(".sc-label text").style("fill-opacity",0))}),t}var n={top:0,right:0,bottom:0,left:0},r=500,a=500,i=Math.floor(1e4*Math.random()),o=function(t){return(t.series||t).key},l=function(t,e){return(t.series||t).value},s=function(t,e){return(t.series||t).count},c=function(t){return o(t)},u=function(t){return l(t)},d=function(t){return isNaN(s(t))?"":" ("+s(t)+")"},f=D.buildLocality(),h="ltr",p=0,g=0,m=function(t,e){return D.defaultColor()(t.series,t.seriesIndex)},v=D.colorRadialGradient,y=m,b=!1,x=function(t,e){return"sc-series sc-series-"+t.seriesIndex},w=!0,k=!0,M=!0,A=!0,I=.01,C=!1,S=!1,F=!1,L=20,T=5,E=360,P=0,z=.447,N=75,H=250,_=e.dispatch("chartClick","elementClick","elementDblClick","elementMouseover","elementMouseout","elementMousemove"),O=function(t,e){var n=t.selectAll(".sc-hole-container").data(e),r=n.enter().append("g").attr("class","sc-hole-container");r.append("text").text(e).attr("class","sc-pie-hole-value").attr("dy",".35em").attr("text-anchor","middle").style("font-size","50px"),n.exit().remove()},B=function(t){return t.startAngle*E/360+D.angleToRadians(P)},R=function(t){return t.endAngle*(E/360)+D.angleToRadians(P)},V=function(t){return null},G=e.pie().sort(null).value(l);return t.dispatch=_,t.id=function(e){return arguments.length?(i=e,t):i},t.color=function(e){return arguments.length?(m=e,t):m},t.fill=function(e){return arguments.length?(y=e,t):y},t.classes=function(e){return arguments.length?(x=e,t):x},t.gradient=function(e){return arguments.length?(v=e,t):v},t.margin=function(e){return arguments.length?(n.top="undefined"!=typeof e.top?e.top:n.top,n.right="undefined"!=typeof e.right?e.right:n.right,n.bottom="undefined"!=typeof e.bottom?e.bottom:n.bottom,n.left="undefined"!=typeof e.left?e.left:n.left,t):n},t.width=function(e){return arguments.length?(r=e,t):r},t.height=function(e){return arguments.length?(a=e,t):a},t.getKey=function(e){return arguments.length?(o=e,t):o},t.getValue=function(e){return arguments.length?(l=e,t):l},t.getCount=function(e){return arguments.length?(s=e,t):s},t.fmtKey=function(e){return arguments.length?(c=e,t):c},t.fmtValue=function(e){return arguments.length?(u=e,t):u},t.fmtCount=function(e){return arguments.length?(d=e,t):d},t.direction=function(e){return arguments.length?(h=e,t):h},t.delay=function(e){return arguments.length?(p=e,t):p},t.duration=function(e){return arguments.length?(g=e,t):g},t.locality=function(e){return arguments.length?(f=D.buildLocality(e),t):f},t.textureFill=function(e){return arguments.length?(b=e,t):b},t.showLabels=function(e){return arguments.length?(w=e,t):w},t.labelSunbeamLayout=function(e){return arguments.length?(F=e,t):F},t.donutLabelsOutside=function(e){return arguments.length?(A=e,t):A},t.pieLabelsOutside=function(e){return arguments.length?(M=e,t):M},t.showLeaders=function(e){return arguments.length?(k=e,t):k},t.donut=function(e){return arguments.length?(C=e,t):C},t.hole=function(e){return arguments.length?(S=e,t):S},t.holeFormat=function(e){return arguments.length?(O=D.functor(e),t):O},t.donutRatio=function(e){return arguments.length?(z=e,t):z},t.startAngle=function(e){return arguments.length?(B=e,t):B},t.endAngle=function(e){return arguments.length?(R=e,t):R},t.labelThreshold=function(e){return arguments.length?(I=e,t):I},t.arcDegrees=function(e){return arguments.length?(E=Math.max(Math.min(e,360),1),t):E},t.rotateDegrees=function(e){return arguments.length?(P=e%360,t):P},t.minRadius=function(e){return arguments.length?(N=e,t):N},t.maxRadius=function(e){return arguments.length?(H=e,t):H},t.fixedRadius=function(e){return arguments.length?(V=D.functor(e),t):V},t}function h(){function t(d,f,h,p){function g(){if(c){var t=e.zoom().on("zoom",l);h.call(t),L.call(t)}else h.on(".zoom",null),L.on(".zoom",null)}function m(){z.append("linearGradient").attr("class","sc-scroll-gradient").attr("id","sc-back-gradient-prev-"+n);var t=z.select("#sc-back-gradient-prev-"+n);z.append("linearGradient").attr("class","sc-scroll-gradient").attr("id","sc-back-gradient-more-"+n);var e=z.select("#sc-back-gradient-more-"+n);t.append("stop").attr("stop-color","#000").attr("stop-opacity","0.3").attr("offset",0),t.append("stop").attr("stop-color","#FFF").attr("stop-opacity","0").attr("offset",1),e.append("stop").attr("stop-color","#FFF").attr("stop-opacity","0").attr("offset",0),e.append("stop").attr("stop-color","#000").attr("stop-opacity","0.3").attr("offset",1),z.append("linearGradient").attr("class","sc-scroll-gradient").attr("id","sc-fore-gradient-prev-"+n);var r=z.select("#sc-fore-gradient-prev-"+n);z.append("linearGradient").attr("class","sc-scroll-gradient").attr("gradientUnits","objectBoundingBox").attr("x1",0).attr("y1",0).attr("id","sc-fore-gradient-more-"+n);var a=z.select("#sc-fore-gradient-more-"+n);r.append("stop").attr("stop-color","#FFF").attr("stop-opacity","1").attr("offset",0),r.append("stop").attr("stop-color","#FFF").attr("stop-opacity","0").attr("offset",1),a.append("stop").attr("stop-color","#FFF").attr("stop-opacity","0").attr("offset",0),a.append("stop").attr("stop-color","#FFF").attr("stop-opacity","1").attr("offset",1),P.selectAll(".sc-scroll-gradient").attr("gradientUnits","objectBoundingBox").attr("x1",0).attr("y1",0)}function v(){P.selectAll(".sc-scroll-gradient").attr("x2",r?1:0).attr("y2",r?0:1)}function y(){z.append("clipPath").attr("class","sc-scroll-mask").attr("id","sc-edge-clip-"+n).append("rect"),F=P.select(".sc-scroll-mask rect")}function b(){h.attr("clip-path",c?"url(#sc-edge-clip-"+n+")":"")}function x(t,e){F.attr("x",r?2:-u.left).attr("y",r?0:2).attr("width",t+(r?-2:u.left)).attr("height",e+(r?u.bottom:-2))}function w(){f.select(".sc-background-wrap").append("rect").attr("class","sc-scroll-target").attr("fill","transparent"),L=d.select(".sc-scroll-target")}function k(t,e,n,r){L.attr("x",t).attr("y",e).attr("width",n).attr("height",r)}function M(){var t=f.select(".sc-background-wrap").append("g").attr("class","sc-back-shadow-wrap");t.append("rect").attr("class","sc-back-shadow-prev"),t.append("rect").attr("class","sc-back-shadow-more"),T=d.select(".sc-back-shadow-wrap")}function A(){var t=r?"width":"height";T.select("rect.sc-back-shadow-prev").attr("fill",c?"url(#sc-back-gradient-prev-"+n+")":"transparent").attr(t,7),T.select("rect.sc-back-shadow-more").attr("fill",c?"url(#sc-back-gradient-more-"+n+")":"transparent").attr(t,7)}function I(t,e,n,a,i,o){T.select(".sc-back-shadow-prev").attr("x",t).attr("y",e).attr(i,o),T.select(".sc-back-shadow-more").attr("x",t+(r?n-5:1)).attr("y",e+(r?0:a-6)).attr(i,o)}function C(){var t=f.select(".sc-background-wrap").insert("g").attr("class","sc-fore-shadow-wrap");t.append("rect").attr("class","sc-fore-shadow-prev"),t.append("rect").attr("class","sc-fore-shadow-more"),E=d.select(".sc-fore-shadow-wrap")}function S(){var t=r?"width":"height";E.select(".sc-fore-shadow-prev").attr("fill",c?"url(#sc-fore-gradient-prev-"+n+")":"transparent").attr(t,20),E.select(".sc-fore-shadow-more").attr("fill",c?"url(#sc-fore-gradient-more-"+n+")":"transparent").attr(t,20)}function D(t,e,n,a){E.select(".sc-fore-shadow-prev").attr("x",t+(r?1:0)).attr("y",e+(r?0:1)).attr(n,a),E.select(".sc-fore-shadow-more").attr("x",t+(r?o-17:0)).attr("y",e+(r?0:o-19)).attr(n,a)}var F,L,T,E,P=d.select("defs"),z=f.select("defs"),N=h.select(".sc-axis-wrap.sc-axis-x"),H=h.select(".sc-bars-wrap"),_=0;return m(),y(),w(),M(),C(),t.render=function(){g(),v(),b(),A(),S()},t.resize=function(e,n){var o,l,d,f,h,g,m;_=e,s=n,t.render(),c&&(o=p.labelThickness()+p.tickPadding()/2,l=r?u.left:o,d=u.top,f=a+(r?0:u[p.orient()]-o),h=i+(r?u[p.orient()]-o:0),g=r?"height":"width",m=r?h:f,x(a,i),k(l,d,f,h),I(l,d,a,i,g,m),D(l,d,g,m))},t.pan=function(t){var n=0,a=0,i="",o=0,l=0,c=e.event;return!c||"click"!==c.type&&"zoom"!==c.type?0:("zoom"===c.type&&c.sourceEvent&&(o=-c.sourceEvent.deltaX||c.sourceEvent.movementX||0,l=-c.sourceEvent.deltaY||c.sourceEvent.movementY||0,n=Math.abs(o)>Math.abs(l)?o:l),a=Math.abs(l)>Math.abs(o)?l:0,_=Math.min(Math.max(_+n,t),-1),i="translate("+(r?_+",0":"0,"+_)+")",(_+n>0||_+n<t)&&s(a),E.attr("transform",i),H.attr("transform",i),N.select(".sc-wrap.sc-axis").attr("transform",i),_)},t}var n,r,a,i,o,l,s,c,u={};return t.id=function(e){return arguments.length?(n=e,t):n},t.margin=function(e){return arguments.length?(u.top="undefined"!=typeof e.top?e.top:u.top,u.right="undefined"!=typeof e.right?e.right:u.right,u.bottom="undefined"!=typeof e.bottom?e.bottom:u.bottom,u.left="undefined"!=typeof e.left?e.left:u.left,t):u},t.width=function(e){return arguments.length?(a=e,t):a},t.height=function(e){return arguments.length?(i=e,t):i},t.vertical=function(e){return arguments.length?(r=e,t):r},t.minDimension=function(e){return arguments.length?(o=e,t):o},t.panHandler=function(e){return arguments.length?(l=D.functor(e),t):l},t.enable=function(e){return arguments.length?(c=e,t):c},t}function p(){function t(r){return r.each(function(r){function a(e){var r=e&&e.length&&e.filter(function(t){return t.values.length}).length,a=(c-n.left-n.right)/2+n.left,o=(u-n.top-n.bottom)/2+n.top;return D.displayNoData(r,i,t.strings().noData,a,o)}var i=e.select(this),l=r?r.properties:{},s=r&&r.data?r.data.map(function(t,e){return{key:t.key||"Undefined",type:t.type||null,disabled:t.disabled||!1,series:t.seriesIndex||e,values:t._values||t.values}}):null,c=parseInt(i.style("width"),10),u=parseInt(i.style("height"),10),d=l.groups||e.range(1,e.max(s.map(function(t){return t.values.length}))+1).map(function(t){return{group:t,l:"Group "+t}}),f=1===e.max(s.map(function(t){return t.values.length}));if(a(s))return t;var h=i.selectAll("table").data([s]),p=h.enter().append("table");h.exit().remove();var g=i.selectAll("table").merge(p),m=p.attr("class","sucrose"),v=m.append("thead").attr("class","sc-thead").append("tr").attr("class","sc-groups"),y=g.select(".sc-groups").merge(v);v.append("th").attr("class","sc-th sc-series-state").text("Enabled"),v.append("th").attr("class","sc-th sc-series-keys").text(l.key||"Series Key");var b=y.selectAll(".sc-group").data(d),x=b.enter().append("th").attr("class","sc-th sc-group");b.exit().remove(),y.selectAll(".sc-group").merge(x).text(function(t){return f?"Series Total":t.l}),f||v.append("th").attr("class","sc-th sc-series-totals").text("Series Total");var w=m.append("tfoot").attr("class","sc-tfoot").append("tr").attr("class","sc-sums"),k=g.select(".sc-sums").merge(w);w.append("th").attr("class","sc-th sc-group-sums").text(""),w.append("th").attr("class","sc-th sc-group-sums").text(f?"Sum":"Group Sums");var M=k.selectAll(".sc-sum").data(function(t){return t.filter(function(t){return!t.disabled}).map(function(t){return t.values.map(function(t){return o(t)})}).reduce(function(t,e){return t.map(function(t,n){return t+e[n]})})}),A=M.enter().append("th").attr("class","sc-sum");M.exit().remove(),k.selectAll(".sc-sum").merge(A).text(function(t){return t}),f||(w.append("th").attr("class","sc-th sc-sum-total"),k.select(".sc-sum-total").text(function(t){return t.filter(function(t){return!t.disabled}).map(function(t){return t.values.map(function(t){return o(t)}).reduce(function(t,e){return t+e})}).reduce(function(t,e){return t+e})})),m.append("tbody").attr("class","sc-tbody");var I=g.select(".sc-tbody"),C=I.selectAll(".sc-series").data(function(t){return t});C.exit().remove();var S=C.enter().append("tr").attr("class","sc-series");S.append("td").attr("class","sc-td sc-state").attr("tabindex",-1).attr("data-editable",!1).append("input").attr("type","checkbox"),S.append("td").attr("class","sc-td sc-key");var F=I.selectAll(".sc-series").merge(S).style("color",function(t){return t.disabled?"#ddd":"#000"}).style("text-decoration",function(t){return t.disabled?"line-through":"inherit"});F.select(".sc-state input").property("checked",function(t){return!t.disabled}),F.select(".sc-key").text(function(t){return t.key});var L=F.selectAll(".sc-val").data(function(t,e){return t.values.map(function(t,n){var r=Array.isArray(t)?{0:t[0],1:t[1]}:{x:t.x,y:t.y};return r.series=e,r.index=n,r})}),T=L.enter().append("td").attr("class","sc-td sc-val");L.exit().remove(),I.selectAll(".sc-val").merge(T).text(function(t){return o(t)}),f||(S.append("td").attr("class","sc-td sc-total").attr("tabindex",-1).attr("data-editable",!1),F.select(".sc-total").text(function(t){return t.values.map(function(t){return o(t)}).reduce(function(t,e){return t+e})}))}),t}var n={top:2,right:0,bottom:2,left:0},r=0,a=0,i=function(t){return t.x},o=function(t){return t.y},l={legend:{close:"Hide legend",open:"Show legend"},controls:{close:"Hide controls",open:"Show controls"},noData:"No Data Available.",noLabel:"undefined"},s=D.getColor(["#000"]);return t.margin=function(e){return arguments.length?(n.top="undefined"!=typeof e.top?e.top:n.top,n.right="undefined"!=typeof e.right?e.right:n.right,n.bottom="undefined"!=typeof e.bottom?e.bottom:n.bottom,n.left="undefined"!=typeof e.left?e.left:n.left,t):n},t.width=function(e){return arguments.length?(r=e,t):r},t.height=function(e){return arguments.length?(a=e,t):a},t.x=function(e){return arguments.length?(i=D.functor(e),t):i},t.y=function(e){return arguments.length?(o=D.functor(e),t):o},t.strings=function(e){if(!arguments.length)return l;for(var n in e)e.hasOwnProperty(n)&&(l[n]=e[n]);return t},t.color=function(e){return arguments.length?(s=D.getColor(e),t):s},t}function g(){function t(e){var n,r,a=e.data?e.data:e,i=h(a);if(i&&I.indexOf(i)===-1&&(I.push(i),a.children))for(r=a.children.length,n=0;n<r;n+=1)t(a.children[n]);return I}function n(m){return m.each(function(m){function v(){var t=O.selectAll(".sc-grandparent.sc-trans").data([r]),n=t.enter().append("g").attr("class","sc-grandparent sc-trans"),a=O.selectAll(".sc-grandparent.sc-trans").merge(n);a.attr("transform",D.translation(i.left,i.top)).lower();var o=a.selectAll("g.sc-parent").data(r.children),l=o.enter().append("g").classed("sc-parent",!0),s=a.selectAll(".sc-parent").merge(l);o.exit().remove(),s.classed("sc-active",function(t){return"active"===t.active}).style("stroke-opacity",1).style("fill-opacity",1);var c=s.selectAll("rect.sc-child").data(function(t){return t.children||[t]}),u=c.enter().append("rect").attr("class","sc-child"),d=s.selectAll(".sc-child").merge(u);c.exit().remove(),w&&l.append("rect").attr("class","sc-texture").attr("x",0).attr("y",0).style("mask","url("+V+")"),d.attr("class",k).attr("fill",function(t,e){var n=t.parent.data.colorIndex||I.indexOf(f(t.parent.data))||e;return this.getAttribute("fill")||x(t,n,I.length)}).call(L),w&&s.select("rect.sc-texture").style("fill",function(t,e){var n=t.parent.data.colorIndex||I.indexOf(f(t.parent.data))||e,r=this.getAttribute("fill")||x(t,n,I.length),a=D.getTextContrast(r,e);return a}).call(L);var h=s.selectAll("text.sc-label").data(function(t){return[t]}),p=h.enter().append("text").attr("class","sc-label").attr("dy",".75em"),g=s.selectAll(".sc-label").merge(p);h.exit().remove(),g.text(function(t){return f(t.data)}).call(F);var m=s.selectAll("rect.sc-target").data(function(t){return[t]}),v=m.enter().append("rect").attr("class","sc-target"),y=s.selectAll(".sc-target").merge(v);return m.exit().remove(),y.call(L),Y.selectAll("text").datum(r).text(T),Y.selectAll("rect").datum(r),y.filter(function(t){return t.children}).on("click",function(t){t.parent&&A.call("chartClick",this,t.parent),S.call(this,t)}),y.filter(function(t){return!t.children}).on("click",function(t,n){e.event.stopPropagation();var r={d:t,i:n};A.call("elementClick",this,r)}),y.on("mouseover",function(t,n){e.select(this).classed("hover",!0);var r=C(e.event,t,n);A.call("elementMouseover",this,r)}).on("mousemove",function(t,n){var r=e.event;A.call("elementMousemove",this,r)}).on("mouseout",function(t,n){e.select(this).classed("hover",!1),A.call("elementMouseout",this)}),d.on("mouseover",function(t,n){e.select(this).classed("hover",!0);var r=C(e.event,t,n);A.call("elementMouseover",this,r)}).on("mouseout",function(t,n){e.select(this).classed("hover",!1),A.call("elementMouseout",this)}),a}function C(t,n,r){return{label:f(n),value:d(n),point:n,pointIndex:r,e:e.event,id:u}}function S(t){var n,a,i,o;A.call("elementMouseout",this),!E&&t&&(r=t,E=!0,q.classed("sc-trans",!1),n=e.select(this).classed("sc-target")?"out":"in",a=e.transition("treemap-out").duration(g).ease(e.easeCubicIn),i=e.transition("treemap-in").duration(g).ease(e.easeCubicIn),o=v(),s.domain([t.x0,t.x1]),c.domain([t.y0,t.y1]),N.style("shape-rendering",null),o.selectAll("text").style("fill-opacity",0),o.selectAll("text").transition(i).style("fill-opacity",1).call(F),o.selectAll("rect").transition(i).style("fill-opacity",1).call(L),q.selectAll("text").transition(a).style("fill-opacity",0).call(F).remove(),q.selectAll("rect").transition(a).style("fill-opacity",0).call(L).on("end",function(t,e){E=!1,N.style("shape-rendering","crispEdges"),q.selectAll("*").interrupt("treemap-out"),q.remove(),q=o}))}function F(t){t.attr("x",function(t){var e="rtl"===M?-1:1;return s(t.x0)+6*e}).attr("y",function(t){return c(t.y0)+6})}function L(t){t.attr("x",function(t){return s(t.x0)}).attr("y",function(t){return c(t.y0)}).attr("width",function(t){return s(t.x1)-s(t.x0)}).attr("height",function(t){return c(t.y1)-c(t.y0)})}function T(t){return t.parent?T(t.parent)+" / "+f(t.data):f(t.data)}var E,P=o-i.left-i.right,z=l-i.top-i.bottom,N=e.select(this);a=a||e.hierarchy(m[0]).sum(function(t){return d(t)}).sort(function(t,e){return e.height-t.height||e.value-t.value}),I=I.length?I:t(a),e.treemap().size([P,z]).round(!1)(a),r=r||a,s.domain([r.x0,r.x1]).range([0,P]),c.domain([r.y0,r.y1]).range([0,z]);var H=N.selectAll("g.sc-wrap.sc-treemap").data([a]),_=H.enter().append("g").attr("class","sc-wrap sc-treemap"),O=N.select(".sc-wrap.sc-treemap").merge(_),B=_.append("defs"),R=O.select("defs");if(B.append("clipPath").attr("id","sc-edge-clip-"+u).append("rect"),R.select("#sc-edge-clip-"+u+" rect").attr("width",o).attr("height",l),O.attr("clip-path",p?"url(#sc-edge-clip-"+u+")":""),w)var V=D.createTexture(B,u);n.gradientFill=function(t,e,n){var r=u+"-"+e,a=t.parent.data.colorIndex||I.indexOf(h(t.parent.data))||e,i=y(t,a,I.length);return b(t,r,n,i,R)};var G=_.selectAll(".sc-treepath").data([a]),W=G.enter().append("g").attr("class","sc-treepath"),Y=O.selectAll(".sc-treepath").merge(W);W.append("rect").attr("class","sc-target").on("click",function(t){A.call("chartClick",this,t),S.call(this,t.parent)}),W.append("text").attr("x","rtl"===M?o-6:6).attr("y",6).attr("dy",".75em"),Y.select(".sc-target").attr("width",o).attr("height",i.top);var q=v()}),n}var r,a,i={top:20,right:0,bottom:0,left:0},o=0,l=0,s=e.scaleLinear(),c=e.scaleLinear(),u=Math.floor(1e4*Math.random()),d=function(t){return t.size},f=function(t){return t.name},h=function(t){
return f(t)},p=!0,g=0,m=0,v=function(t,e){return!1},y=e.scaleOrdinal().range(e.schemeCategory20.map(function(t){return t=e.rgb(t),t.opacity=.6,t})),b=D.colorLinearGradient,x=y,w=!1,k=function(t,e){return"sc-child"},M="ltr",A=e.dispatch("chartClick","elementClick","elementDblClick","elementMouseover","elementMouseout","elementMousemove"),I=[];return n.dispatch=A,n.color=function(t){return arguments.length?(y=t,n):y},n.fill=function(t){return arguments.length?(x=t,n):x},n.classes=function(t){return arguments.length?(k=t,n):k},n.gradient=function(t){return arguments.length?(b=t,n):b},n.margin=function(t){return arguments.length?(i.top="undefined"!=typeof t.top?t.top:i.top,i.right="undefined"!=typeof t.right?t.right:i.right,i.bottom="undefined"!=typeof t.bottom?t.bottom:i.bottom,i.left="undefined"!=typeof t.left?t.left:i.left,n):i},n.width=function(t){return arguments.length?(o=t,n):o},n.height=function(t){return arguments.length?(l=t,n):l},n.xScale=function(t){return arguments.length?(s=t,n):s},n.yScale=function(t){return arguments.length?(c=t,n):c},n.leafClick=function(t){return arguments.length?(v=t,n):v},n.getValue=function(t){return arguments.length?(d=t,n):d},n.getKey=function(t){return arguments.length?(f=t,n):f},n.groupBy=function(t){return arguments.length?(h=t,n):h},n.groups=function(t){return arguments.length?(I=t,n):I},n.duration=function(t){return arguments.length?(g=t,n):g},n.delay=function(t){return arguments.length?(m=t,n):m},n.id=function(t){return arguments.length?(u=t,n):u},n.direction=function(t){return arguments.length?(M=t,n):M},n.textureFill=function(t){return arguments.length?(w=t,n):w},n}function m(){function t(r){return r.each(function(r){function a(t){var e=t&&t.length&&t.filter(function(t){return!t.disabled&&Array.isArray(t.values)&&t.values.length}).length,r=(P-n.left-n.right)/2+n.left,a=(z-n.top-n.bottom)/2+n.top;return D.displayNoData(e,S,p.noData,r,a)}function l(t){V=t.map(function(t){return t.label}),G=V.length,W=G>0}function s(t,n){var r=n.map(function(t){return e.select(t).datum()}),a=e.max(e.extent(r),function(t){return D.siDecimal(Math.abs(t))}),i=e.max(r,function(t){return D.countSigFigsAfter(e.formatPrefix(".2s",a)(t))});return"maxmin"===t&&Q.axis&&(i=Math.max(Q.axis.precision,i)),Q[t]={decimal:a,precision:i},Q[t]}var c,u,m=this,S=e.select(this),L="area",T=r?r.properties||{}:{},E=r?r.data||null:null,P=parseInt(S.style("width"),10),z=parseInt(S.style("height"),10),N=i,H=o,_="datetime"===T.xDataType||!1,O="currency"===T.yDataType||!1,B=T.groups,R=Array.isArray(B)&&B.length>0,V=[],G=0,W=!1,Y=[],q=0,X=0,K=0,Z=[{key:"Stacked",disabled:"zero"!==x.offset()},{key:"Stream",disabled:"wiggle"!==x.offset()},{key:"Expanded",disabled:"expand"!==x.offset()}];if(t.update=function(){S.transition().duration(d).call(t)},t.container=this,a(E))return t;if(E.forEach(function(t,n){t.seriesIndex=n,t.key=t.key||p.noLabel,t.total=e.sum(t.values,function(t,e){return x.y()(t,e)}),t.disabled=t.disabled||0===t.total}),Y=E.filter(function(t){return!t.disabled}).map(function(t,e){return t.seri=e,t}),q=Y.length,a(Y))return t;R?(B.forEach(function(t,e){var n="undefined"==typeof t.label||""===t.label?p.noLabel:_?D.isNumeric(t.label)||t.label.indexOf("GMT")!==-1?new Date(t.label):new Date(t.label+" GMT"):t.label;t.group=e,t.label=n,t.total=0,Y.forEach(function(n,r){n.values.filter(function(t,n){return t.group===e}).forEach(function(e,n){t.total+=e.y})})}),l(B),X=e.sum(B,function(t){return t.total})):(V=e.merge(Y.map(function(t){return t.values})).reduce(function(t,e){return t.indexOf(e.x)===-1&&t.push(e.x),t},[]).map(function(t,e){return _?new Date(t):t}),G=Math.min(Math.ceil(innerWidth/100),V.length),X=e.sum(Y,function(t){return t.total}));var U=75,j=null,$=null,J=null,Q={axis:null,maxmin:null};_&&(j=D.getDateFormatUTC(V)),$=function(t,e,n,r){var a=W?V[e]:t,i=v(t,e,a,_,j);return"no-ellipsis"===r?i:D.stringEllipsify(i,S,U)},J=function(t,e,n,r){var a=Q[r]||s(r,n);return y(t,e,null,O,a.precision,a.decimal)},h.disabled=Y.map(function(t){return!!t.disabled}),h.style=x.style(),w.chart(t).title(T.title).controlsData(Z).legendData(E),x.xDomain(null).yDomain(null).xScale(_?e.scaleTime():e.scaleLinear()),c=x.xScale(),u=x.yScale(),k.orient("bottom").ticks(null).tickValues(null).scale(c).tickPadding(6).valueFormat($).highlightZero(!1).showMaxMin(_),M.orient("left").ticks(null).scale(u).tickPadding(6).valueFormat(J).highlightZero(!0).showMaxMin(!0),A.id(x.id()).useVoronoi(!1).clipEdge(!1).xScale(c).yScale(u);var tt=S.selectAll("g.sc-chart-wrap").data([Y]),et=tt.enter().append("g").attr("class","sc-chart-wrap sc-chart-"+L),nt=S.select(".sc-chart-wrap").merge(et);et.append("defs");nt.select("defs");et.append("g").attr("class","sc-background-wrap");var rt=nt.select(".sc-background-wrap");et.append("g").attr("class","sc-title-wrap"),et.append("g").attr("class","sc-axis-wrap sc-axis-x");var at=nt.select(".sc-axis-wrap.sc-axis-x");et.append("g").attr("class","sc-axis-wrap sc-axis-y");var it=nt.select(".sc-axis-wrap.sc-axis-y");et.append("g").attr("class","sc-"+L+"-wrap");var ot=nt.select(".sc-"+L+"-wrap");et.append("g").attr("class","sc-controls-wrap"),et.append("g").attr("class","sc-legend-wrap"),et.append("g").attr("class","sc-guide-wrap");var lt=nt.select(".sc-guide-wrap");nt.attr("transform",D.translation(n.left,n.top)),et.select(".sc-background-wrap").append("rect").attr("class","sc-background").attr("x",-n.left).attr("y",-n.top).attr("fill","#FFF"),t.render=function(){function r(t){return"width"===t?y:"height"===t?I:0}function a(){R=k.margin(),B=M.margin(),g.left=Math.max(R.left,B.left),g.right=Math.max(R.right,B.right),g.top=Math.max(R.top,B.top),g.bottom=Math.max(R.bottom,B.bottom),l()}function l(){y=N-g.left-g.right,I=H-L-g.top-g.bottom,x.resetDimensions(r("width"),r("height"))}function s(){M.ticks("wiggle"===x.offset()?0:null).tickSize(K-y,0).margin(g),it.call(M),a()}function f(){k.tickSize(K-I,0).margin(g),at.call(k),a()}var h,p,g,y,I,L,E=0,O=0;P=parseInt(S.style("width"),10),z=parseInt(S.style("height"),10),h=i||P||960,p=o||z||400,N=h-n.left-n.right,H=p-n.top-n.bottom,g={top:0,right:0,bottom:0,left:0},y=N-g.left-g.right,I=H-g.top-g.bottom,rt.select(".sc-background").attr("width",h).attr("height",p),U=Math.max(.2*N,75),w.width(N).height(H),S.call(w),L=w.getHeight(),g.top+=L,I=H-g.top-g.bottom,x.width(r("width")).height(r("height")),ot.datum(Y).call(x);var B={top:0,right:0,bottom:0,left:0},R={top:0,right:0,bottom:0,left:0};s(),f(),s(),f(),s(),ot.transition().duration(d).call(x);var V=Math.pow(3,2)*Math.PI;A.width(y).height(I).size(V).sizeRange([V,V]).xDomain(c.domain()).yDomain(u.domain()),lt.datum([{key:"guide",values:[{x:0,y:0},{x:0,y:u.domain()[1]}]}]).call(A),t.showTooltip=function(t,e,n){var r=b(t,n);return F.show(t.e,r,null,null,e)},t.moveGuide=function(n,r,a){var i=a.data[0][0],o=[{x:i,y:0}].concat(a.data.map(function(t,e){return{x:i,y:t[1]}})).concat([{x:i,y:u.domain()[1]}]),l={clientX:a.origin.left+c(i)},s=[i,0];s.e=a.e,s.seriesIndex=0,s.seriesKey="x",lt.datum([{key:"guide",values:o,seriesIndex:0}]).call(A),C||(C={},a.data.forEach(function(e,n){e.e=a.e,C[n]=t.showTooltip(e,m.parentNode,T)}),C.x=t.showTooltip(s,m.parentNode,T)),a.data.forEach(function(t,n){var r=b(t,T);l.clientY=a.origin.top+u(t[1]),e.select(C[n]).select(".tooltip-inner").html(r),F.position(m.parentNode,C[n],l,"e")}),s.forEach(function(t,n){var r=v(t,n,i,_);l.clientY=a.origin.top,e.select(C.x).select(".tooltip-inner").html(r),F.position(m.parentNode,C.x,l,"s")})},g.top+=L,E=g.left,O=g.top+("bottom"===k.orient()?I:0),at.attr("transform",D.translation(E,O)),E=g.left+("left"===M.orient()?0:y),O=g.top,it.attr("transform",D.translation(E,O)),ot.attr("transform",D.translation(g.left,g.top)),lt.attr("transform",D.translation(g.left,g.top))},t.render(),w.legend.dispatch.on("legendClick",function(e,n){e.disabled=!e.disabled,E.filter(function(t){return!t.disabled}).length||E.forEach(function(t){t.disabled=!1}),h.disabled=E.map(function(t){return!!t.disabled}),e.active="inactive",t.update(),g.call("stateChange",this,h)}),w.controls.dispatch.on("legendClick",function(e,n){if(e.disabled){switch(Z.forEach(function(t){t.disabled=!0}),e.disabled=!1,e.key){case"Stacked":x.style("stack");break;case"Stream":x.style("stream");break;case"Expanded":x.style("expand")}h.style=x.style(),t.render(),g.call("stateChange",this,h)}}),g.on("tooltipShow",function(t){f&&(I=!0,lt.classed("hover",!0))}),g.on("tooltipMove",function(e){I&&t.moveGuide(m.parentNode,S,e)}),g.on("tooltipHide",function(){f&&(I=!1,F.cleanup(),C=null,lt.classed("hover",!1))}),x.dispatch.on("elementClick.toggle",function(e){E=1===E.filter(function(t){return!t.disabled}).length?E.map(function(t){return t.disabled=!1,t}):E.map(function(t,n){return t.disabled=n!==e.seriesIndex,t}),h.disabled=E.map(function(t){return!!t.disabled}),t.update(),g.call("stateChange",this,h),g.call("tooltipHide",this)}),g.on("changeState",function(e){"undefined"!=typeof e.disabled&&(E.forEach(function(t,n){t.disabled=e.disabled[n]}),h.disabled=e.disabled),"undefined"!=typeof e.style&&(x.style(e.style),h.style=e.style),t.update()}),g.on("chartClick",function(){w.controls.enabled()&&w.controls.dispatch.call("closeMenu",this),w.legend.enabled()&&w.legend.dispatch.call("closeMenu",this)}),S.on("click",function(){e.event.stopPropagation(),g.call("chartClick",this)})}),t}var n={top:10,right:10,bottom:10,left:10},i=null,o=null,l="ltr",c=0,d=0,f=!0,h={},p={legend:{close:"Hide legend",open:"Show legend"},controls:{close:"Hide controls",open:"Show controls"},noData:"No Data Available.",noLabel:"undefined"},g=e.dispatch("chartClick","tooltipShow","tooltipHide","tooltipMove","stateChange","changeState"),m=3,v=function(e,n,r,a,i){var o=r||e;return a?(i=i&&0===i.indexOf("%")?i:"%x",D.dateFormat(o,i,t.locality())):o},y=function(e,n,r,a,i){return i=isNaN(i)?2:i,D.numberFormatSI(e,i,a,t.locality())},b=function(t,e){var n=t.seriesKey,r="currency"===e.yDataType,a=y(t[1],t.pointIndex,null,r,2);return"<p>"+n+": "+a+"</p>"},x=r(),w=s(),k=a(),M=a(),A=u(),I=null,C=null;return x.clipEdge(!0),w.showTitle(!0).showControls(!1).showLegend(!0),A.duration(0),x.dispatch.on("elementMouseover.tooltip",function(t){g.call("tooltipShow",this,t)}),x.dispatch.on("elementMousemove.tooltip",function(t){g.call("tooltipMove",this,t)}),x.dispatch.on("elementMouseout.tooltip",function(t){g.call("tooltipHide",this,t)}),t.dispatch=g,t.area=x,t.legend=w.legend,t.controls=w.controls,t.xAxis=k,t.xAxisLabel=k.axisLabel,t.yAxis=M,t.yAxisLabel=M.axisLabel,t.options=D.optionsFunc.bind(t),D.rebind(t,x,"id","x","y","xScale","yScale","xDomain","yDomain","forceX","forceY","clipEdge","color","fill","classes","gradient","locality"),D.rebind(t,x,"offset","order","style"),D.rebind(t,w,"showTitle","showControls","showLegend"),D.rebind(t,k,"rotateTicks","reduceXTicks","staggerTicks","wrapTicks"),t.colorData=function(n){var r=arguments[0],a=arguments[1]||{},i=function(t){return D.defaultColor()(t,t.seriesIndex)},o=function(t){return"sc-series sc-series-"+t.seriesIndex};switch(r){case"graduated":i=function(t){return e.interpolateHsl(e.rgb(a.c1),e.rgb(a.c2))(t.seriesIndex/a.l)};break;case"class":i=function(){return"inherit"},o=function(t){var e=t.seriesIndex,n=e*(a.step||1)%14;return n=(n>9?"":"0")+n,"sc-series sc-series-"+e+" sc-fill"+n+" sc-stroke"+n};break;case"data":i=function(t){return D.defaultColor()(t,t.seriesIndex)},o=function(t){var e=t.seriesIndex;return"sc-series sc-series-"+e+(t.classes?" "+t.classes:"")}}var l=a.gradient?function(t,e){var n={orientation:a.orientation||"horizontal",position:a.position||"base"};return x.gradientFill(t,t.seriesIndex,n)}:i;return x.color(i),x.fill(l),x.classes(o),w.legend.color(i),w.legend.classes(o),t},t.margin=function(e){if(!arguments.length)return n;for(var r in e)e.hasOwnProperty(r)&&(n[r]=e[r]);return t},t.width=function(e){return arguments.length?(i=e,t):i},t.height=function(e){return arguments.length?(o=e,t):o},t.tooltips=function(e){return arguments.length?(f=e,t):f},t.tooltipContent=function(e){return arguments.length?(b=e,t):b},t.state=function(e){return arguments.length?(h=e,g.call("stateChange",this,h),t):h},t.strings=function(e){if(!arguments.length)return p;for(var n in e)e.hasOwnProperty(n)&&(p[n]=e[n]);return w.strings(p),t},t.direction=function(e){return arguments.length?(l=e,x.direction(e),k.direction(e),M.direction(e),w.direction(e),t):l},t.duration=function(e){return arguments.length?(d=e,x.duration(e),t):d},t.delay=function(e){return arguments.length?(c=e,x.delay(e),t):c},t.xValueFormat=function(e){return arguments.length?(v=e,t):v},t.yValueFormat=function(e){return arguments.length?(y=e,t):y},t.pointRadius=function(e){return arguments.length?(m=e,t):m},t}function v(){function t(a){return a.each(function(a){function o(t){var e=t&&t.length,r=(R-n.left-n.right)/2+n.left,a=(V-n.top-n.bottom)/2+n.top;return D.displayNoData(e,H,h.noData,r,a)}function l(t){var n=e.extent(e.merge(t.map(function(t){return t.values.map(function(t,n){return e.timeParse("%Y-%m-%d")(g(t))})}))),r=[e.timeMonth.floor(n[0]),e.timeDay.offset(e.timeMonth.ceil(n[1]),-1)];return r}function s(t){function n(t){return 32-new Date(t.getFullYear(),t.getMonth(),32).getDate()}var r=e.timeMonth.range(t[0],t[1]),a=r.map(function(t){return e.timeDay.offset(e.timeMonth.floor(t),n(t)/2-1)});return a}function c(t){var n=e.nest().key(y).entries(t),r=1e3/n.length,a=.25*r,i=[0,1],o=[0,1],l=e.scaleLinear().domain(i).range(o),s=[],c=0;return n.map(function(t,e){return t.total=0,t.values=t.values.sort(function(t,e){return e.y<t.y?-1:e.y>t.y?1:0}).map(function(e){return t.total+=e.y,e}),t.group=e,t}).sort(function(t,e){return t.total<e.total?-1:t.total>e.total?1:0}).map(function(t,n){return c+=t.total,i=e.extent(t.values.map(function(t){return t.y})),o=[r*n+a,r*(n+1)-a],l.domain(i).range(o),t.values=t.values.map(function(e){return e.group=t.group,e.opportunity=e.y,e.y=l(e.opportunity),e}),s.push({key:t.key,y:e.min(t.values.map(function(t){return t.y}))}),t}),s}var k,E,P,z,N=this,H=e.select(this),_="bubble",O=a?a.properties||{}:{},B=a?a.data||[]:[],R=parseInt(H.style("width"),10),V=parseInt(H.style("height"),10),G=r,W=i,Y="datetime"===O.xDataType||!1,q="currency"===O.yDataType||!1,X=function(t,e,n,r){return x(t,e,t,Y,"%B")},K=function(t,e,n,r){var a=z&&Array.isArray(z)?z[e].key||t:t,i=Math.max(.2*G,75);return isNaN(a)?D.stringEllipsify(a,H,i):w(t,e,a,q)},Z=[];if(t.update=function(){H.transition().duration(u).call(t)},t.container=this,o(B))return t;f.disabled=B.map(function(t){return!!t.disabled});var U=e.nest().key(b).entries(B);k=U.sort(function(t,e){return parseInt(t.key,10)<parseInt(e.key,10)?-1:parseInt(t.key,10)>parseInt(e.key,10)?1:0}).map(function(t,e){return t.seriesIndex=e,t.classes=t.values[0].classes,t.color=t.values[0].color,t}),I.chart(t).title(O.title).controlsData(Z).legendData(k),I.legend.key(function(t){return t.key+"%"}),E=l(k),z=c(B),P=e.extent(e.merge(k.map(function(t){return t.values.map(function(t,e){return m(t,e)})})).concat(v)),C.orient("bottom").scale(A.xScale()).valueFormat(X).ticks(e.timeMonths,1).tickValues(s(E)).tickSize(0).tickPadding(4).highlightZero(!1).showMaxMin(!1),S.orient("left").scale(A.yScale()).valueFormat(K).ticks(z.length).tickValues(z.map(function(t,e){return z[e].y})).tickPadding(7).highlightZero(!1).showMaxMin(!1);var j=H.selectAll("g.sc-chart-wrap").data([k]),$=j.enter().append("g").attr("class","sc-chart-wrap sc-chart-"+_),J=H.select(".sc-chart-wrap").merge($);$.append("defs"),$.append("g").attr("class","sc-background-wrap");var Q=J.select(".sc-background-wrap");$.append("g").attr("class","sc-title-wrap"),$.append("g").attr("class","sc-axis-wrap sc-axis-x");var tt=J.select(".sc-axis-wrap.sc-axis-x");$.append("g").attr("class","sc-axis-wrap sc-axis-y");var et=J.select(".sc-axis-wrap.sc-axis-y");$.append("g").attr("class","sc-"+_+"-wrap");var nt=J.select(".sc-"+_+"-wrap");$.append("g").attr("class","sc-controls-wrap"),$.append("g").attr("class","sc-legend-wrap"),J.attr("transform",D.translation(n.left,n.top)),$.select(".sc-background-wrap").append("rect").attr("class","sc-background").attr("x",-n.left).attr("y",-n.top).attr("fill","#FFF"),t.render=function(){function e(){s.left=Math.max(v.left,m.left),s.right=Math.max(v.right,m.right),s.top=Math.max(v.top,m.top)+f,s.bottom=Math.max(v.bottom,m.bottom)}function a(){c=G-s.left-s.right,d=W-s.top-s.bottom,A.resetDimensions(c,d)}var o,l,s,c,d,f,h=0,p=0;R=parseInt(H.style("width"),10),V=parseInt(H.style("height"),10),o=r||R||960,l=i||V||400,G=o-n.left-n.right,W=l-n.top-n.bottom,s={top:0,right:0,bottom:0,left:0},c=G-s.left-s.right,d=W-s.top-s.bottom,Q.select(".sc-background").attr("width",o).attr("height",l);var g=Math.sqrt(A.sizeRange()[1]/Math.PI);I.width(G).height(W),H.call(I),f=I.getHeight(),s.top+=f,s.top+=g,d=W-s.top-s.bottom,A.width(c).height(d).id(t.id()).xDomain(E).yDomain(P),nt.datum(k.filter(function(t){return!t.disabled})).transition().duration(u).call(A);var m={top:0,right:0,bottom:0,left:0},v={top:0,right:0,bottom:0,left:0};S.margin(s),et.call(S),m=S.margin(),e(),a(),C.tickSize(0).margin(s),tt.call(C),v=C.margin(),e(),a(),S.tickSize(-c,0).margin(s),et.call(S),et.select("path.domain").attr("d","M0,0V0.5H0V"+d),nt.transition().duration(t.delay()).call(A),h=s.left,p=s.top+("bottom"===C.orient()?d:0),tt.attr("transform",D.translation(h,p)),h=s.left+("left"===S.orient()?0:c),p=s.top,et.attr("transform",D.translation(h,p)),nt.attr("transform",D.translation(s.left,s.top))},t.render(),I.legend.dispatch.on("legendClick",function(e,n){e.disabled=!e.disabled,k.filter(function(t){return!t.disabled}).length||k.forEach(function(t){t.disabled=!1,H.selectAll(".sc-series").classed("disabled",!1)}),f.disabled=k.map(function(t){return!!t.disabled}),p.call("stateChange",this,f),t.update()}),p.on("tooltipShow",function(t){d&&(L=T(t,N.parentNode,O))}),p.on("tooltipMove",function(t){L&&F.position(N.parentNode,L,t,"s")}),p.on("tooltipHide",function(){d&&F.cleanup()}),p.on("changeState",function(e){"undefined"!=typeof e.disabled&&(B.forEach(function(t,n){t.disabled=e.disabled[n]}),f.disabled=e.disabled),t.update()}),p.on("chartClick",function(){p.call("tooltipHide",this),I.controls.enabled()&&I.controls.dispatch.call("closeMenu",this),I.legend.enabled()&&I.legend.dispatch.call("closeMenu",this)}),A.dispatch.on("elementClick",function(e){p.call("chartClick",this),M(B,e,t)}),H.on("click",function(){e.event.stopPropagation(),p.call("chartClick",this)})}),t}var n={top:10,right:10,bottom:10,left:10},r=null,i=null,o="ltr",l=0,u=0,d=!0,f={},h={legend:{close:"Hide legend",open:"Show legend"},controls:{close:"Hide controls",open:"Show controls"},noData:"No Data Available.",noLabel:"undefined"},p=e.dispatch("chartClick","elementClick","tooltipShow","tooltipHide","tooltipMove","stateChange","changeState"),g=function(t){return t.x},m=function(t){return t.y},v=[0],y=function(t){return t.y},b=function(t){return t.y},x=function(e,n,r,a,i){var o=r||e;return a?(i=i&&0===i.indexOf("%")?i:"MM",D.dateFormat(o,i,t.locality())):o},w=function(e,n,r,a,i){return i=isNaN(i)?2:i,D.numberFormatSI(r,i,a,t.locality())},k=function(t,e){var n=t.series.key,r=t.point.x,a=t.point.y;return"<h3>"+n+"</h3><p>"+a+" on "+r+"</p>"},M=function(t,e,n,r){},A=c(),I=s(),C=a(),S=a(),L=null,T=function(t,e,n){var r=k(t,n),a=t.value<0?"n":"s";return F.show(t.e,r,a,null,e)};return A.padData(!0).padDataOuter(-1).size(function(t){return t.y}).sizeRange([256,1024]).singlePoint(!0),I.showTitle(!0).showControls(!1).showLegend(!0).alignLegend("center"),A.dispatch.on("elementMouseover.tooltip",function(t){p.call("tooltipShow",this,t)}),A.dispatch.on("elementMousemove.tooltip",function(t){p.call("tooltipMove",this,t)}),A.dispatch.on("elementMouseout.tooltip",function(){p.call("tooltipHide",this)}),t.dispatch=p,t.scatter=A,t.legend=I.legend,t.controls=I.controls,t.xAxis=C,t.xAxisLabel=C.axisLabel,t.yAxis=S,t.yAxisLabel=S.axisLabel,t.options=D.optionsFunc.bind(t),D.rebind(t,A,"id","x","y","xScale","yScale","xDomain","yDomain","forceX","forceY","clipEdge","color","fill","classes","gradient","locality"),D.rebind(t,A,"size","zScale","sizeDomain","forceSize","interactive","clipVoronoi","clipRadius"),D.rebind(t,I,"showTitle","showControls","showLegend"),D.rebind(t,C,"rotateTicks","reduceXTicks","staggerTicks","wrapTicks"),t.colorData=function(n){var r=arguments[0],a=arguments[1]||{},i=function(t){return D.defaultColor()(t,t.seriesIndex)},o=function(t){return"sc-series sc-series-"+t.seriesIndex};switch(r){case"graduated":i=function(t){return e.interpolateHsl(e.rgb(a.c1),e.rgb(a.c2))(t.seriesIndex/a.l)};break;case"class":i=function(){return"inherit"},o=function(t){var e=t.seriesIndex,n=e*(a.step||1)%14;return n=(n>9?"":"0")+n,"sc-series sc-series-"+e+" sc-fill"+n+" sc-stroke"+n};break;case"data":i=function(t){return t.classes?"inherit":t.color||D.defaultColor()(t,t.seriesIndex)},o=function(t){var e=t.seriesIndex;return"sc-series sc-series-"+e+(t.classes?" "+t.classes:"")}}var l=a.gradient?function(t,e){return A.gradientFill(t,t.seriesIndex)}:i;return A.color(i),A.fill(l),A.classes(o),I.legend.color(i),I.legend.classes(o),t},t.margin=function(e){if(!arguments.length)return n;for(var r in e)e.hasOwnProperty(r)&&(n[r]=e[r]);return t},t.width=function(e){return arguments.length?(r=e,t):r},t.height=function(e){return arguments.length?(i=e,t):i},t.tooltips=function(e){return arguments.length?(d=e,t):d},t.tooltipContent=function(e){return arguments.length?(k=e,t):k},t.state=function(e){return arguments.length?(f=e,p.call("stateChange",this,f),t):f},t.strings=function(e){if(!arguments.length)return h;for(var n in e)e.hasOwnProperty(n)&&(h[n]=e[n]);return I.strings(h),t},t.direction=function(e){return arguments.length?(o=e,A.direction(e),C.direction(e),S.direction(e),I.direction(e),t):o},t.duration=function(e){return arguments.length?(u=e,A.duration(e),t):u},t.delay=function(e){return arguments.length?(l=e,A.delay(e),t):l},t.xValueFormat=function(e){return arguments.length?(x=e,t):x},t.yValueFormat=function(e){return arguments.length?(w=e,t):w},t.seriesClick=function(e){return arguments.length?(M=e,t):M},t.groupBy=function(e){return arguments.length?(y=e,t):y},t.filterBy=function(e){return arguments.length?(b=e,t):b},t}function y(){function t(i){return i.each(function(i){function o(t){var e=t&&t.length,r=(A-n.left-n.right)/2+n.left,a=(I-n.top-n.bottom)/2+n.top;return D.displayNoData(e,s,h.noData,r,a)}var l=this,s=e.select(this),b="funnel",k=i?i.properties||{}:{},M=i?i.data||null:null,A=parseInt(s.style("width"),10),I=parseInt(s.style("height"),10);"datetime"===k.xDataType||!1,"currency"===k.yDataType||!1;if(t.update=function(){s.transition().duration(c).call(t)},t.container=this,o(M))return t;t.setActiveState=function(t,e){t.active=e},t.clearActive=function(e){M.forEach(function(n){t.setActiveState(n,e||"")}),delete d.active},t.seriesActivate=function(e){var n,r=e.series||M[e.seriesIndex];r&&(f?(n="undefined"==typeof r.active||"inactive"===r.active||""===r.active?"active":"",t.clearActive("active"===n?"inactive":""),t.setActiveState(r,n),d.active=M.map(function(t){return"active"===t.active})):t.dataSeriesActivate({series:r}))},t.dataSeriesActivate=function(e){var n=e.series;n.active=n.active&&"inactive"!==n.active?"inactive":"active","active"===n.active&&M.filter(function(t){return"active"!==t.active}).forEach(function(t){return t.active="inactive",t}),M.filter(function(t){return"active"===t.active}).length||t.clearActive()},M.forEach(function(t,n){t.seriesIndex=n,t.values||(t.value?isNaN(t.value)||(t.values=[{x:0,y:parseInt(t.value,10)}]):t.values=[]),t.values.forEach(function(e,n){e.index=n,e.series=t,"undefined"==typeof e.value&&(e.value=e.y)}),t.key=t.key||h.noLabel,t.value=t.value||e.sum(t.values,function(t){return t.value}),t.count=t.count||t.values.length,t.disabled=t.disabled||0===t.value});var C=M.filter(function(t){return!t.disabled});if(C.length||(C=[{values:[]}]),k.count=e.sum(C,function(t){return t.count}),k.total=e.sum(C,function(t){return t.value}),d.disabled=M.map(function(t){return!!t.disabled}),!k.total)return o(),t;m.chart(t).title(k.title).controlsData(v).legendData(M);var S=s.selectAll("g.sc-chart-wrap").data([C]),L=S.enter().append("g").attr("class","sc-chart-wrap sc-chart-"+b),T=s.select(".sc-chart-wrap").merge(L);L.append("defs");T.select("defs");L.append("g").attr("class","sc-background-wrap");var E=T.select(".sc-background-wrap");L.append("g").attr("class","sc-title-wrap"),L.append("g").attr("class","sc-"+b+"-wrap");var P=T.select(".sc-"+b+"-wrap");L.append("g").attr("class","sc-controls-wrap"),L.append("g").attr("class","sc-legend-wrap"),T.attr("transform",D.translation(n.left,n.top)),L.select(".sc-background-wrap").append("rect").attr("class","sc-background").attr("x",-n.left).attr("y",-n.top).attr("fill","#FFF"),t.render=function(){var t,e,i,o,l,u,d,f;A=parseInt(s.style("width"),10),I=parseInt(s.style("height"),10),t=r||A||960,e=a||I||400,i=t-n.left-n.right,o=e-n.top-n.bottom,l={top:0,right:0,bottom:0,left:0},u=i-l.left-l.right,d=o-l.top-l.bottom,E.select(".sc-background").attr("width",t).attr("height",e),m.width(i).height(o),s.call(m),f=m.getHeight(),l.top+=f,d=o-l.top-l.bottom,g.width(u).height(d),P.datum(C).attr("transform",D.translation(l.left,l.top)).transition().duration(c).call(g)},t.render(),m.legend.dispatch.on("legendClick",function(e,n){e.disabled=!e.disabled,e.active=!1,M.filter(function(t){return!t.disabled}).length||M.forEach(function(t){t.disabled=!1}),M.filter(function(t){return"active"===t.active}).length||M.forEach(function(t){t.active=""}),d.disabled=M.map(function(t){return!!t.disabled}),p.call("stateChange",this,d),t.update()}),p.on("tooltipShow",function(t){u&&(y=x(t,l.parentNode,k))}),p.on("tooltipMove",function(t){y&&F.position(l.parentNode,y,t)}),p.on("tooltipHide",function(){u&&F.cleanup()}),p.on("changeState",function(e){"undefined"!=typeof e.disabled&&(C.forEach(function(t,n){t.disabled=e.disabled[n]}),d.disabled=e.disabled),t.update()}),p.on("chartClick",function(){m.controls.enabled()&&m.controls.dispatch.call("closeMenu",this),m.legend.enabled()&&m.legend.dispatch.call("closeMenu",this)}),g.dispatch.on("elementClick",function(e){p.call("chartClick",this),w(M,e,t)})}),t}var n={top:10,right:10,bottom:10,left:10},r=null,a=null,o="ltr",l=0,c=0,u=!0,d={},f=!0,h={legend:{close:"Hide legend",open:"Show legend"},controls:{close:"Hide controls",open:"Show controls"},noData:"No Data Available.",noLabel:"undefined"},p=e.dispatch("chartClick","elementClick","tooltipShow","tooltipHide","tooltipMove","stateChange","changeState"),g=i(),m=s(),v=[],y=null,b=function(e,n){var r=g.fmtKey()(e),a=n.seriesLabel||"Key",i=g.getValue()(e),o=n.total?(100*i/n.total).toFixed(1):100,l="currency"===n.yDataType,s=D.numberFormat(i,2,l,t.locality()),c=D.numberFormat(o,2,!1,t.locality());return"<p>"+a+": <b>"+r+"</b></p><p>"+(l?"Amount":"Count")+": <b>"+s+"</b></p><p>Percent: <b>"+c+"%</b></p>"},x=function(t,e,n){var r=b(t,n);return F.show(t.e,r,null,null,e)},w=function(t,e,n){};return m.showTitle(!0).showControls(!1).showLegend(!0).alignLegend("center"),g.dispatch.on("elementMouseover.tooltip",function(t){p.call("tooltipShow",this,t)}),g.dispatch.on("elementMousemove.tooltip",function(t){p.call("tooltipMove",this,t)}),g.dispatch.on("elementMouseout.tooltip",function(){p.call("tooltipHide",this)}),t.dispatch=p,t.funnel=g,t.legend=m.legend,t.controls=m.controls,t.options=D.optionsFunc.bind(t),D.rebind(t,g,"id","color","fill","classes","gradient","locality","textureFill"),D.rebind(t,g,"getKey","getValue","getCount","fmtKey","fmtValue","fmtCount"),D.rebind(t,g,"yScale","yDomain","forceY","wrapLabels","minLabelWidth"),D.rebind(t,m,"showTitle","showControls","showLegend"),t.colorData=function(n){var r=arguments[0],a=arguments[1]||{},i=function(t,e){return D.defaultColor()(t,t.seriesIndex)},o=function(t,e){return"sc-series sc-series-"+t.seriesIndex};switch(r){case"graduated":i=function(t,n){return e.interpolateHsl(e.rgb(a.c1),e.rgb(a.c2))(t.seriesIndex/a.l)};break;case"class":i=function(){return"inherit"},o=function(t,e){var n=t.seriesIndex*(a.step||1)%14;return n=(n>9?"":"0")+n,"sc-series sc-series-"+t.seriesIndex+" sc-fill"+n+" sc-stroke"+n};break;case"data":i=function(t,e){return D.defaultColor()(t,t.seriesIndex)},o=function(t,e){return"sc-series sc-series-"+t.seriesIndex+(t.classes?" "+t.classes:"")}}var l=a.gradient?function(t,e){var n={orientation:a.orientation||"vertical",position:a.position||"middle"};return g.gradientFill(t,t.seriesIndex,n)}:i;return g.color(i),g.fill(l),g.classes(o),m.legend.color(i),m.legend.classes(o),t},t.margin=function(e){if(!arguments.length)return n;for(var r in e)e.hasOwnProperty(r)&&(n[r]=e[r]);return t},t.width=function(e){return arguments.length?(r=e,t):r},t.height=function(e){return arguments.length?(a=e,t):a},t.tooltips=function(e){return arguments.length?(u=e,t):u},t.tooltipContent=function(e){return arguments.length?(b=e,t):b},t.state=function(e){return arguments.length?(d=e,p.call("stateChange",this,d),t):d},t.strings=function(e){if(!arguments.length)return h;for(var n in e)e.hasOwnProperty(n)&&(h[n]=e[n]);return m.strings(h),t},t.direction=function(e){return arguments.length?(o=e,g.direction(e),m.direction(e),t):o},t.duration=function(e){return arguments.length?(c=e,g.duration(e),t):c},t.delay=function(e){return arguments.length?(l=e,g.delay(e),t):l},t.seriesClick=function(e){return arguments.length?(w=e,t):w},t}function b(){function t(i){return i.each(function(i){function o(t){var e=t&&t.length,r=(k-n.left-n.right)/2+n.left,a=(M-n.top-n.bottom)/2+n.top;return D.displayNoData(e,s,f.noData,r,a)}var l=this,s=e.select(this),y="gauge",x=i?i.properties||{}:{},w=i?i.data||null:null,k=parseInt(s.style("width"),10),M=parseInt(s.style("height"),10);"datetime"===x.xDataType||!1,"currency"===x.yDataType||!1;if(t.update=function(){s.transition().duration(c).call(t)},t.container=this,o(w))return t;w.forEach(function(t,n){var r=p.y();t.seriesIndex=n,t.value=r(t),t.value||t.values?isNaN(t.value)||(t.values=[{x:0,y:parseInt(t.value,10)}]):t.values=[],t.values.forEach(function(e,n){e.index=n,e.series=t,"undefined"==typeof e.value&&(e.value=r(e))}),t.value=t.value||e.sum(t.values,function(t){return t.value}),t.count=t.count||t.values.length,t.disabled=t.disabled||0===t.value});var A=w.filter(function(t,e){return!t.disabled});if(A.length||(A=[{values:[]}]),x.count=e.sum(A,function(t){return t.count}),x.total=e.sum(A,function(t){return t.value}),d.disabled=w.map(function(t){return!!t.disabled}),!x.total)return o(),t;g.chart(t).title(x.title).controlsData(m).legendData(w);var I=s.selectAll("g.sc-chart-wrap").data([A]),C=I.enter().append("g").attr("class","sc-chart-wrap sc-chart-"+y),S=s.select(".sc-chart-wrap").merge(C);C.append("defs"),C.append("g").attr("class","sc-background-wrap");var L=S.select(".sc-background-wrap");C.append("g").attr("class","sc-title-wrap"),C.append("g").attr("class","sc-"+y+"-wrap");var T=S.select(".sc-"+y+"-wrap");C.append("g").attr("class","sc-controls-wrap"),C.append("g").attr("class","sc-legend-wrap"),S.attr("transform",D.translation(n.left,n.top)),C.select(".sc-background-wrap").append("rect").attr("class","sc-background").attr("x",-n.left).attr("y",-n.top).attr("fill","#FFF"),t.render=function(){var t,e,i,o,l,u,d,f;k=parseInt(s.style("width"),10),M=parseInt(s.style("height"),10),t=r||k||960,e=a||M||400,i=t-n.left-n.right,o=e-n.top-n.bottom,l={top:0,right:0,bottom:0,left:0},u=i-l.left-l.right,d=o-l.top-l.bottom,L.select(".sc-background").attr("width",t).attr("height",e),g.width(i).height(o),s.call(g),f=g.getHeight(),l.top+=f,d=o-l.top-l.bottom,p.width(u).height(d),T.datum(A).attr("transform",D.translation(l.left,l.top)).transition().duration(c).call(p),p.setPointer(x.total)},t.render(),h.on("tooltipShow",function(t){u&&(v=b(t,l.parentNode,x))}),h.on("tooltipMove",function(t){v&&F.position(l.parentNode,v,t)}),h.on("tooltipHide",function(){u&&F.cleanup()}),h.on("changeState",function(e){"undefined"!=typeof e.disabled&&(A.forEach(function(t,n){t.disabled=e.disabled[n]}),d.disabled=e.disabled),
t.update()}),h.on("chartClick",function(){g.controls.enabled()&&g.controls.dispatch.call("closeMenu",this),g.legend.enabled()&&g.legend.dispatch.call("closeMenu",this)})}),t}var n={top:10,right:10,bottom:10,left:10},r=null,a=null,i="ltr",l=0,c=0,u=!0,d={},f={legend:{close:"Hide legend",open:"Show legend"},controls:{close:"Hide controls",open:"Show controls"},noData:"No Data Available.",noLabel:"undefined"},h=e.dispatch("chartClick","tooltipShow","tooltipHide","tooltipMove","stateChange","changeState"),p=o(),g=s(),m=[],v=null,y=function(t,e){var n=p.fmtKey()(t.point.series),r=p.getCount()(t.point.series),a=p.getValue()(t.point.y1-t.point.y0);return"<h3>"+n+"</h3><p>"+a+" on "+r+"</p>"},b=function(t,e,n){var r=y(t,n);return F.show(t.e,r,null,null,e)};return g.showTitle(!0).showControls(!1).showLegend(!0).alignLegend("center"),p.dispatch.on("elementMouseover.tooltip",function(t){h.call("tooltipShow",this,t)}),p.dispatch.on("elementMousemove.tooltip",function(t){h.call("tooltipMove",this,t)}),p.dispatch.on("elementMouseout.tooltip",function(){h.call("tooltipHide",this)}),t.dispatch=h,t.gauge=p,t.legend=g.legend,t.controls=g.controls,t.options=D.optionsFunc.bind(t),D.rebind(t,p,"id","x","y","color","fill","classes","gradient","locality"),D.rebind(t,p,"getKey","getValue","getCount","fmtKey","fmtValue","fmtCount"),D.rebind(t,p,"showLabels","showPointer","setPointer","ringWidth","labelThreshold","maxValue","minValue"),D.rebind(t,g,"showTitle","showControls","showLegend"),t.colorData=function(n){var r=arguments[0],a=arguments[1]||{},i=function(t,e){return D.defaultColor()(t,t.seriesIndex)},o=function(t,e){return"sc-series sc-series-"+t.seriesIndex};switch(r){case"graduated":i=function(t,n){return e.interpolateHsl(e.rgb(a.c1),e.rgb(a.c2))(t.seriesIndex/a.l)};break;case"class":i=function(){return"inherit"},o=function(t,e){var n=t.seriesIndex*(a.step||1)%14;return n=(n>9?"":"0")+n,"sc-series sc-series-"+t.seriesIndex+" sc-fill"+n+" sc-stroke"+n};break;case"data":i=function(t,e){return D.defaultColor()(t,t.seriesIndex)},o=function(t,e){return"sc-series sc-series-"+t.seriesIndex+(t.classes?" "+t.classes:"")}}var l=a.gradient?function(t,e){return p.gradientFill(t,t.seriesIndex)}:i;return p.color(i),p.fill(l),p.classes(o),g.legend.color(i),g.legend.classes(o),t},t.margin=function(e){if(!arguments.length)return n;for(var r in e)e.hasOwnProperty(r)&&(n[r]=e[r]);return t},t.width=function(e){return arguments.length?(r=e,t):r},t.height=function(e){return arguments.length?(a=e,t):a},t.tooltips=function(e){return arguments.length?(u=e,t):u},t.tooltipContent=function(e){return arguments.length?(y=e,t):y},t.state=function(e){return arguments.length?(d=e,t):d},t.strings=function(e){if(!arguments.length)return f;for(var n in e)e.hasOwnProperty(n)&&(f[n]=e[n]);return g.strings(f),t},t.direction=function(e){return arguments.length?(i=e,p.direction(e),g.direction(e),t):i},t.duration=function(e){return arguments.length?(c=e,p.duration(e),t):c},t.delay=function(e){return arguments.length?(l=e,p.delay(e),t):l},t}function x(){function t(t,e,n){var r=E(t,n);return F.show(t.e,r,null,null,e)}function n(l){return l.each(function(l){function s(t){var e=t&&t.length,n=(ot-a.left-a.right)/2+a.left,r=(lt-a.top-a.bottom)/2+a.top;return D.displayNoData(e,nt,h.noData,n,r)}function f(){X=P(e.event.sourceEvent),K=I.invert(X),Z=I.rotate(),c&&(F.cleanup(),c=!1),g&&clearInterval(j)}function p(){if(X){var t,n,r,a=N(e.event.transform.k);t=P(e.event.sourceEvent),n=I.invert(t),n[0]&&(r=[Z[0]+n[0]-K[0],dt.rotate[1]||ut.rotate[1]],Z=[r[0],r[1]],I.rotate(r).scale(a),Y())}}function E(){X=null,c=st}function P(t){var e=rt.getBoundingClientRect(),n=(t?t.clientX||0:0)-e.left,r=(t?t.clientY||0:0)-e.top;return[n,r]}function z(){$=i||parseInt(nt.style("width"),10)||960,J=o||parseInt(nt.style("height"),10)||400,Q=$-a.left-a.right,tt=J-a.top-a.bottom}function N(t){var e=Math.min(Math.max(t,.75),3),n=Math.min(tt,Q)/2;return e*n}function H(){return[Q/2+a.left,tt/2+a.top]}function _(t,n){function r(t,e,n,r){var a={point:e,e:t,name:x[e.properties.iso_a2]||e.properties.name,amount:V(e)};return a}L=ft._total;var a=yt.append("g").attr("class",n).selectAll("path").data(t),i=a.enter().append("path").attr("d",q).attr("class",k).style("fill",function(t,e){return t.amount=V(t),M(t,t.properties.mapcolor13||e)});U=bt.selectAll("path").merge(i),i.on("click",O).on("mouseover",function(t,n,a){if(t.properties){var i=r(e.event,t,n,a);A.call("tooltipShow",this,i)}}).on("mousemove",function(t,n,r){var a=e.event;A.call("tooltipMove",this,a)}).on("mouseout",function(){A.call("tooltipHide",this)})}function O(t){if(ct!=e.select(this)&&(B(),b[t.id])){c&&F.cleanup();var n=e.geoCentroid(t),r=C.bounds(t),a=Q/(r[1][0]-r[0][0]),i=tt/(r[1][1]-r[0][1]),o=Math.min(Q*a,tt*i)/2,l=[-n[0],-n[1]];ut={rotate:I.rotate(),scale:I.scale()},I.rotate(l).scale(o),dt={rotate:I.rotate(),scale:I.scale()};var s=R(t);s.parent=ft,ft=s,L=ft._total,ct=e.select(this),_(b[t.id],"states"),ct.style("display","none"),Y()}}function B(){ct&&(I.rotate(ut.rotate).scale(ut.scale),dt={rotate:[null,null],scale:null},ft=ft.parent,L=ft._total,ct.style("display","inline"),e.select(".states").remove(),ct=!1,Y())}function R(t){return ft._values[t.id]||ft._values[t.properties.name]||{_total:0}}function V(t){return R(t)._total||0}function G(){var t=I.rotate(),e=[10,0],n=[t[0]+e[0]/8,u];W(n)}function W(t){I.rotate(t),Y()}function Y(t){bt.selectAll("path").attr("d",q)}function q(t){return C(t)||"M0,0Z"}var X,K,Z,U,j,$,J,Q,tt,et=this,nt=e.select(this),rt=e.select("#"+r+" svg").node(),at=l?l.properties:{},it=l?l.data:null,ot=parseInt(nt.style("width"),10),lt=parseInt(nt.style("height"),10),st=c,ct=!1,ut={rotate:[d,u],scale:1,zoom:1},dt={rotate:[null,null],scale:null,zoom:null};if(n.container=this,v=v||function(t,e){return D.colorRadialGradient(t,e,0,0,"35%","35%",w(t,e),mt)},s(it))return n;var ft=it[0],ht=nt.selectAll("g.sc-chart-wrap").data([1]),pt=ht.enter().append("g").attr("class","sc-chart-wrap sc-chart-globe"),gt=nt.select(".sc-chart-wrap").merge(pt);pt.append("defs");var mt=gt.select("defs");pt.append("svg:rect").attr("class","sc-chart-background").attr("transform",D.translation(a.left,a.top));var vt=gt.select(".sc-chart-background"),yt=pt.append("g").attr("class","sc-globe"),bt=gt.select(".sc-globe");yt.append("path").datum({type:"Sphere"}).attr("class","sphere");var xt=e.select(".sphere");if(m){yt.append("path").datum(S).attr("class","graticule");var wt=e.select(".graticule")}var kt=e.zoom().on("start",f).on("zoom",p).on("end",E);bt.call(kt),xt.on("click",function(){B()}),n.update=function(){nt.transition().call(n)},n.resize=function(){var t,e;z(),t=N(I.scale()),e=H(),vt.attr("width",Q).attr("height",tt),I.scale(t).translate(e),Y()},n.render=function(){z(),I.translate(H()).rotate(ut.rotate).scale(N(ut.scale)),C.projection(I),xt.attr("d",C),m&&wt.attr("d",C),vt.attr("width",Q).attr("height",tt),Y()},n.render(),_(y,"countries"),g&&(j=setInterval(G,10)),A.on("tooltipShow",function(e){c&&(T=t(e,et.parentNode,at))}),A.on("tooltipMove",function(t){T&&F.position(et.parentNode,T,t,"s")}),A.on("tooltipHide",function(){c&&F.cleanup()}),A.on("changeState",function(t){nt.transition().call(n)})}),n}var r=Math.floor(1e4*Math.random()),a={top:0,right:0,bottom:0,left:0},i=null,o=null,l=!1,s="ltr",c=!0,u=0,d=100,f={},h={legend:{close:"Hide legend",open:"Show legend"},controls:{close:"Hide controls",open:"Show controls"},noData:"No Data Available.",noLabel:"undefined"},p=!0,g=!1,m=!0,v=null,y=[],b={},x={},w=function(t,e){return D.defaultColor()(t,e)},k=function(t,e){return"sc-country-"+e},M=w,A=e.dispatch("chartClick","tooltipShow","tooltipHide","tooltipMove","stateChange","changeState","elementClick","elementDblClick","elementMouseover","elementMouseout"),I=e.geoOrthographic().precision(.1),C=e.geoPath().projection(I),S=e.geoGraticule(),L=0,T=null,E=function(t,n){return"<p><b>"+t.name+"</b></p><p><b>Amount:</b> $"+e.format(",.0f")(t.amount)+"</p>"},P=function(t,e,n){};return n.dispatch=A,n.projection=I,n.path=C,n.graticule=S,n.options=D.optionsFunc.bind(n),n.margin=function(t){if(!arguments.length)return a;for(var e in t)t.hasOwnProperty(e)&&(a[e]=t[e]);return n},n.width=function(t){return arguments.length?(i=t,n):i},n.height=function(t){return arguments.length?(o=t,n):o},n.tooltips=function(t){return arguments.length?(c=t,n):c},n.tooltipContent=function(t){return arguments.length?(E=t,n):E},n.state=function(t){return arguments.length?(f=t,n):f},n.strings=function(t){if(!arguments.length)return h;for(var e in t)t.hasOwnProperty(e)&&(h[e]=t[e]);return n},n.showTitle=function(t){return arguments.length?(l=t,n):l},n.direction=function(t){return arguments.length?(s=t,n):s},n.id=function(t){return arguments.length?(r=t,n):r},n.color=function(t){return arguments.length?(w=t,n):w},n.fill=function(t){return arguments.length?(M=t,n):M},n.classes=function(t){return arguments.length?(k=t,n):k},n.colorData=function(t){var r=arguments[0],a=arguments[1]||{},i=function(t,e){return D.defaultColor()(t,e)},o=function(t,e){return"sc-country-"+e+(t.classes?" "+t.classes:"")};switch(r){case"graduated":i=function(t,n){return e.interpolateHsl(e.rgb(a.c1),e.rgb(a.c2))(n/a.l)};break;case"class":i=function(){return""},o=function(t,e){var n=e*(a.step||1)%14;return n=(n>9?"":"0")+n,"sc-country-"+e+" sc-fill"+n};break;case"data":i=function(t,n){var r=t.amount||0;return e.interpolateHsl(e.rgb(a.c1),e.rgb(a.c2))(r/L)}}var l=a.gradient?function(t,e){return n.gradient()(t,e)}:i;return n.color(i),n.classes(o),n.fill(l),n},n.gradient=function(t){return arguments.length?(v=t,n):v},n.showLabels=function(t){return arguments.length?(p=t,n):p},n.autoSpin=function(t){return arguments.length?(g=t,n):g},n.worldMap=function(t){return arguments.length?(y=t,n):y},n.countryMap=function(t){return arguments.length?(b=t,n):b},n.countryLabels=function(t){return arguments.length?(x=t,n):x},n.seriesClick=function(t){return arguments.length?(P=t,n):P},n}function w(){function t(a){return a.each(function(a){function o(t){var e=t&&t.length&&t.filter(function(t){return!t.disabled&&Array.isArray(t.values)&&t.values.length}).length,r=(T-n.left-n.right)/2+n.left,a=(E-n.top-n.bottom)/2+n.top;return D.displayNoData(e,y,h.noData,r,a)}function l(t){B=t.map(function(t){return t.label}),R=B.length,V=R>0}function s(t,n){var r=n.map(function(t){return e.select(t).datum()}),a=e.max(e.extent(r),function(t){return D.siDecimal(Math.abs(t))}),i=e.max(r,function(t){return D.countSigFigsAfter(e.formatPrefix(".2s",a)(t))});return"maxmin"===t&&J.axis&&(i=Math.max(J.axis.precision,i)),J[t]={decimal:a,precision:i},J[t]}var u=this,y=e.select(this),C="line",S=a?a.properties||{}:{},L=a?a.data||null:null,T=parseInt(y.style("width"),10),E=parseInt(y.style("height"),10),P=r,z=i,N="datetime"===S.xDataType||!1,H="currency"===S.yDataType||!1,_=S.groups||S.labels,O=Array.isArray(_)&&_.length>0,B=[],R=0,V=!1,G=[],W=0,Y=0,q=x.padData()?g:0,X=!1,K=[{key:"Linear",disabled:"linear"!==x.interpolate()},{key:"Basis",disabled:"basis"!==x.interpolate()},{key:"Monotone",disabled:"monotone"!==x.interpolate()},{key:"Cardinal",disabled:"cardinal"!==x.interpolate()},{key:"Line",disabled:x.isArea()()===!0},{key:"Area",disabled:x.isArea()()===!1}];if(t.update=function(){y.transition().duration(c).call(t)},t.setActiveState=function(t,e){t.active=e,t.values.forEach(function(t){t.active=e})},t.clearActive=function(e){L.forEach(function(n){t.setActiveState(n,e||"")}),delete f.active},t.cellActivate=function(e){var n,r=L[e.seriesIndex].values[e.pointIndex];r&&(n="undefined"==typeof r.active||"inactive"===r.active||""===r.active?"active":"",t.clearActive(),r.active=n)},t.seriesActivate=function(e){var n,r=e.series||L[e.seriesIndex];r&&(n="undefined"==typeof r.active||"inactive"===r.active||""===r.active?"active":"",t.clearActive("active"===n?"inactive":""),t.setActiveState(r,n),f.active=L.map(function(t){return"active"===t.active}))},t.dataSeriesActivate=function(e){var n,r=e.series||L[e.seriesIndex];r&&(n="undefined"==typeof r.active||"inactive"===r.active||""===r.active?"active":"inactive","active"===n?t.seriesActivate(e):t.clearActive())},t.container=this,o(L))return t;if(L.forEach(function(t,n){t.seriesIndex=n,t.key=t.key||h.noLabel,t.total=e.sum(t.values,function(t,e){return t.group=O?t.x-1:e,t.y}),t.disabled=t.disabled||0===t.total}),G=L.filter(function(t){return!t.disabled}).map(function(t,e){return t.seri=e,t}),W=G.length,o(G))return t;O?(_.forEach(function(t,e){var n="undefined"==typeof t.label||""===t.label?h.noLabel:N?D.isNumeric(t.label)||t.label.indexOf("GMT")!==-1?new Date(t.label):new Date(t.label+" GMT"):t.label;t.group=e,t.label=n,t.total=0,G.forEach(function(n,r){n.values.filter(function(t,n){return t.group===e}).forEach(function(e,n){t.total+=e.y})})}),l(_),Y=e.sum(_,function(t){return t.total})):(B=e.merge(G.map(function(t){return t.values})).reduce(function(t,e){return t.indexOf(e.x)===-1&&t.push(e.x),t},[]).map(function(t,e){return N?new Date(t):t}),R=Math.min(Math.ceil(innerWidth/100),B.length),Y=e.sum(G,function(t){return t.total}));var Z=75,U=null,j=null,$=null,J={axis:null,maxmin:null};N&&(U=D.getDateFormatUTC(B)),j=function(t,e,n,r){var a=V?B[e]:t,i=m(t,e,a,N,U);return"no-ellipsis"===r?i:D.stringEllipsify(i,y,Z)},$=function(t,e,n,r){var a=J[r]||s(r,n);return v(t,e,null,H,a.precision,a.decimal)},f.disabled=G.map(function(t){return!!t.disabled}),f.interpolate=x.interpolate(),f.isArea=x.isArea()(),w.chart(t).title(S.title).controlsData(K).legendData(L),X=1===e.max(G,function(t){return t.values.length});var Q=Math.pow(g,2)*Math.PI*(X?3:1);if(x.xScale(N?e.scaleTime():e.scaleLinear()).singlePoint(X).size(Q).sizeRange([Q,Q]).sizeDomain([Q,Q]),X){var tt=e.merge(G.map(function(t){return t.values.map(function(t,e){return x.x()(t,e)})})).reduce(function(t,e){return t.indexOf(e)<0&&t.push(e),t},[]).sort(function(t,e){return t-e}),et=e.extent(tt),nt=1*(N&&!B.length?864e5:1),rt=e.merge(G.map(function(t){return t.values.map(function(t,e){return x.y()(t,e)})})),at=e.extent(rt),it=1===G.length?2:Math.min((at[1]-at[0])/G.length,at[0]);x.xDomain([et[0]-nt,et[1]+nt]).yDomain([at[0]-it,at[1]+it]),k.orient("bottom").ticks(tt.length).tickValues(tt).highlightZero(!1).showMaxMin(!1),M.orient("left").ticks(X?5:null).highlightZero(!1).showMaxMin(!1)}else x.xDomain(null).yDomain(null),k.orient("bottom").tickValues(V?e.range(1,R+1):null).ticks(V?R:null).highlightZero(!1).showMaxMin(N),M.orient("left").ticks(null).highlightZero(!0).showMaxMin(!0);k.scale(x.xScale()).tickPadding(6).valueFormat(j),M.scale(x.yScale()).tickPadding(6).valueFormat($);var ot=y.selectAll("g.sc-chart-wrap").data([G]),lt=ot.enter().append("g").attr("class","sc-chart-wrap sc-chart-"+C),st=y.select(".sc-chart-wrap").merge(lt);lt.append("defs"),lt.append("g").attr("class","sc-background-wrap");var ct=st.select(".sc-background-wrap");lt.append("g").attr("class","sc-title-wrap"),lt.append("g").attr("class","sc-axis-wrap sc-axis-x");var ut=st.select(".sc-axis-wrap.sc-axis-x");lt.append("g").attr("class","sc-axis-wrap sc-axis-y");var dt=st.select(".sc-axis-wrap.sc-axis-y");lt.append("g").attr("class","sc-"+C+"-wrap");var ft=st.select(".sc-"+C+"-wrap");lt.append("g").attr("class","sc-controls-wrap"),lt.append("g").attr("class","sc-legend-wrap"),st.attr("transform",D.translation(n.left,n.top)),lt.select(".sc-background-wrap").append("rect").attr("class","sc-background").attr("x",-n.left).attr("y",-n.top).attr("fill","#FFF"),t.render=function(){function t(t){return"width"===t?f:"height"===t?h:0}function e(){b=k.margin(),v=M.margin(),d.left=Math.max(b.left,v.left),d.right=Math.max(b.right,v.right),d.top=Math.max(b.top,v.top),d.bottom=Math.max(b.bottom,v.bottom),a()}function a(){f=P-d.left-d.right,h=z-p-d.top-d.bottom,x.resetDimensions(t("width"),t("height"))}function o(){M.tickSize(q-f,0).margin(d),dt.call(M),e()}function l(){k.tickSize(q-h,0).margin(d),ut.call(k),e()}var s,u,d,f,h,p,g=0,m=0;T=parseInt(y.style("width"),10),E=parseInt(y.style("height"),10),s=r||T||960,u=i||E||400,P=s-n.left-n.right,z=u-n.top-n.bottom,d={top:0,right:0,bottom:0,left:0},f=P-d.left-d.right,h=z-d.top-d.bottom,ct.select(".sc-background").attr("width",s).attr("height",u),Z=Math.max(.2*P,75),w.width(P).height(z),y.call(w),p=w.getHeight(),d.top+=p,h=z-d.top-d.bottom,x.width(t("width")).height(t("height")),ft.datum(G).call(x);var v={top:0,right:0,bottom:0,left:0},b={top:0,right:0,bottom:0,left:0};o(),l(),o(),l(),o(),ft.transition().duration(c).call(x),d.top+=p,g=d.left,m=d.top+("bottom"===k.orient()?h:0),ut.attr("transform",D.translation(g,m)),g=d.left+("left"===M.orient()?0:f),m=d.top,dt.attr("transform",D.translation(g,m)),ft.attr("transform",D.translation(d.left,d.top))},t.render(),w.legend.dispatch.on("legendClick",function(e,n){e.disabled=!e.disabled,L.filter(function(t){return!t.disabled}).length||L.forEach(function(t){t.disabled=!1}),f.disabled=L.map(function(t){return!!t.disabled}),e.active="inactive",e.values.forEach(function(t){t.active="inactive"}),L.filter(function(t){return"active"===t.active}).length||t.clearActive(),f.active=L.map(function(t){return!!t.active}),t.update(),p.call("stateChange",this,f)}),w.controls.dispatch.on("legendClick",function(e,n){if(e.disabled){switch(K.forEach(function(t){t.disabled=!0}),e.disabled=!1,e.key){case"Basis":x.interpolate("basis");break;case"Linear":x.interpolate("linear");break;case"Monotone":x.interpolate("monotone");break;case"Cardinal":x.interpolate("cardinal");break;case"Line":x.isArea(!1);break;case"Area":x.isArea(!0)}f.interpolate=x.interpolate(),f.isArea=x.isArea(),t.update(),p.call("stateChange",this,f)}}),p.on("tooltipShow",function(t){d&&(V&&(t.group=_[t.groupIndex]),A=I(t,u.parentNode,S))}),p.on("tooltipMove",function(t){A&&F.position(u.parentNode,A,t,"s")}),p.on("tooltipHide",function(){d&&F.cleanup()}),p.on("changeState",function(e){"undefined"!=typeof e.disabled&&(L.forEach(function(t,n){t.disabled=e.disabled[n]}),f.disabled=e.disabled),"undefined"!=typeof e.interpolate&&(x.interpolate(e.interpolate),f.interpolate=e.interpolate),"undefined"!=typeof e.isArea&&(x.isArea(e.isArea),f.isArea=e.isArea),t.update()}),p.on("chartClick",function(){w.controls.enabled()&&w.controls.dispatch.call("closeMenu",this),w.legend.enabled()&&w.legend.dispatch.call("closeMenu",this)}),x.dispatch.on("elementClick",function(e){V&&e.groupIndex&&(e.group=_[e.groupIndex]),p.call("chartClick",this),x.dispatch.call("elementMouseout",this,e),b(L,e,t,B)}),y.on("click",function(){e.event.stopPropagation(),p.call("chartClick",this)})}),t}var n={top:10,right:10,bottom:10,left:10},r=null,i=null,o="ltr",l=0,c=0,d=!0,f={},h={legend:{close:"Hide legend",open:"Show legend"},controls:{close:"Hide controls",open:"Show controls"},noData:"No Data Available.",noLabel:"undefined"},p=e.dispatch("chartClick","elementClick","tooltipShow","tooltipHide","tooltipMove","stateChange","changeState"),g=3,m=function(e,n,r,a,i){var o=r||e;return a?(i=i&&0===i.indexOf("%")?i:"%x",D.dateFormat(o,i,t.locality())):o},v=function(e,n,r,a,i,o){return D.numberFormatSIFixed(e,i,a,t.locality(),o)},y=function(e,n){var r,a=n.seriesLabel||"Key",i=e.series.key,o="datetime"===n.xDataType,l=n.groupName||(o?"Date":"Group"),s=e.group||{},c=e.point.x,u=m(c,e.pointIndex,s.label,o,"%x"),d="currency"===n.yDataType,f=d?"Amount":"Count",h=e.point.y,p=D.numberFormat(h,null,d,t.locality()),g="";return g+="<p>"+a+": <b>"+i+"</b></p>",g+="<p>"+l+": <b>"+u+"</b></p>",g+="<p>"+f+": <b>"+p+"</b></p>",e.group&&Number.isFinite(e.group._height)&&(r=Math.abs(100*h/e.group._height).toFixed(1),r=D.numberFormat(r,2,!1,t.locality()),g+="<p>Percentage: <b>"+r+"%</b></p>"),g},b=function(t,e,n,r){},x=u(),w=s(),k=a(),M=a(),A=null,I=function(t,e,n){var r=y(t,n),a=t.value<0?"n":"s";return F.show(t.e,r,a,null,e)};return x.clipEdge(!0),w.showTitle(!0).showControls(!0).showLegend(!0),x.dispatch.on("elementMouseover.tooltip",function(t){p.call("tooltipShow",this,t)}),x.dispatch.on("elementMousemove.tooltip",function(t){p.call("tooltipMove",this,t)}),x.dispatch.on("elementMouseout.tooltip",function(t){p.call("tooltipHide",this,t)}),t.dispatch=p,t.lines=x,t.legend=w.legend,t.controls=w.controls,t.xAxis=k,t.xAxisLabel=k.axisLabel,t.yAxis=M,t.yAxisLabel=M.axisLabel,t.options=D.optionsFunc.bind(t),D.rebind(t,x,"id","x","y","xScale","yScale","xDomain","yDomain","forceX","forceY","clipEdge","color","fill","classes","gradient","locality"),D.rebind(t,x,"defined","isArea","interpolate","size","clipVoronoi","useVoronoi","interactive","nice"),D.rebind(t,w,"showTitle","showControls","showLegend"),D.rebind(t,k,"rotateTicks","reduceXTicks","staggerTicks","wrapTicks"),t.colorData=function(n){var r=arguments[0],a=arguments[1]||{},i=function(t){return D.defaultColor()(t,t.seriesIndex)},o=function(t){return"sc-series sc-series-"+t.seriesIndex};switch(r){case"graduated":i=function(t){return e.interpolateHsl(e.rgb(a.c1),e.rgb(a.c2))(t.seriesIndex/a.l)};break;case"class":i=function(){return"inherit"},o=function(t){var e=t.seriesIndex,n=e*(a.step||1)%14;return n=(n>9?"":"0")+n,"sc-series sc-series-"+e+" sc-fill"+n+" sc-stroke"+n};break;case"data":i=function(t){return D.defaultColor()(t,t.seriesIndex)},o=function(t){var e=t.seriesIndex;return"sc-series sc-series-"+e+(t.classes?" "+t.classes:"")}}return x.color(i),x.fill(i),x.classes(o),w.legend.color(i),w.legend.classes(o),t},t.margin=function(e){if(!arguments.length)return n;for(var r in e)e.hasOwnProperty(r)&&(n[r]=e[r]);return t},t.width=function(e){return arguments.length?(r=e,t):r},t.height=function(e){return arguments.length?(i=e,t):i},t.tooltips=function(e){return arguments.length?(d=e,t):d},t.tooltipContent=function(e){return arguments.length?(y=e,t):y},t.state=function(e){return arguments.length?(f=e,p.call("stateChange",this,f),t):f},t.strings=function(e){if(!arguments.length)return h;for(var n in e)e.hasOwnProperty(n)&&(h[n]=e[n]);return w.strings(h),t},t.direction=function(e){return arguments.length?(o=e,x.direction(e),k.direction(e),M.direction(e),w.direction(e),t):o},t.duration=function(e){return arguments.length?(c=e,x.duration(e),t):c},t.delay=function(e){return arguments.length?(l=e,x.delay(e),t):l},t.xValueFormat=function(e){return arguments.length?(m=e,t):m},t.yValueFormat=function(e){return arguments.length?(v=e,t):v},t.seriesClick=function(e){return arguments.length?(b=e,t):b},t.pointRadius=function(e){return arguments.length?(g=e,t):g},t}function k(){function t(a){return a.each(function(a){function o(t){var e=t&&t.length&&t.filter(function(t){return!t.disabled&&Array.isArray(t.values)&&t.values.length}).length,r=(O-n.left-n.right)/2+n.left,a=(B-n.top-n.bottom)/2+n.top;return D.displayNoData(e,h,p.noData,r,a)}function l(t){X=t.map(function(t){return t.label}),K=X.length,Z=K>0}function s(t,n){var r=n.map(function(t){return e.select(t).datum()}),a=e.max(e.extent(r),function(t){return D.siDecimal(Math.abs(t))}),i=e.max(r,function(t){return D.countSigFigsAfter(e.formatPrefix(".2s",a)(t))});return"maxmin"===t&&at.axis&&(i=Math.max(at.axis.precision,i)),at[t]={decimal:a,precision:i},at[t]}var d=this,h=e.select(this),M=m?"multibar":"multibar-horizontal",H=a?a.properties||{}:{},_=a?a.data||null:null,O=parseInt(h.style("width"),10),B=parseInt(h.style("height"),10),R=r,V=i,G="datetime"===H.xDataType||!1,W="currency"===H.yDataType||!1,Y=H.groups,q=Array.isArray(Y)&&Y.length>0,X=[],K=0,Z=!1,U=[],j=0,$=0,J=I.stacked()&&m?72:32,Q=[{key:"Grouped",disabled:I.stacked()},{key:"Stacked",disabled:!I.stacked()}];if(t.update=function(){h.transition().duration(c).call(t)},t.setActiveState=function(t,e){t.active=e,t.values.forEach(function(t){t.active=e})},t.clearActive=function(e){_.forEach(function(n){t.setActiveState(n,e||"")}),delete f.active},t.cellActivate=function(e){var n,r=_[e.seriesIndex].values[e.pointIndex];r&&(n="undefined"==typeof r.active||"inactive"===r.active||""===r.active?"active":"",t.clearActive(),r.active=n)},t.seriesActivate=function(e){var n,r=e.series||_[e.seriesIndex];r&&(n="undefined"==typeof r.active||"inactive"===r.active||""===r.active?"active":"",t.clearActive("active"===n?"inactive":""),t.setActiveState(r,n),f.active=_.map(function(t){return"active"===t.active}))},t.dataSeriesActivate=function(e){var n,r=e.series||_[e.seriesIndex];r&&(n="undefined"==typeof r.active||"inactive"===r.active||""===r.active?"active":"inactive","active"===n?t.seriesActivate(e):t.clearActive())},t.container=this,o(_))return t;if(_.forEach(function(t,n){t._values||(t._values=t.values.map(function(t,e){var n={x:t.x,y:t.y};return t.label&&(n.label=t.label),t.active&&(n.active=t.active),n})),t.seriesIndex=n,t.key=t.key||p.noLabel,t.total=e.sum(t._values,function(t,e){return t.y}),t.disabled=t.disabled||0===t.total}),U=_.filter(function(t){return!t.disabled}).map(function(t,e){return t.seri=e,t.values=t._values.map(function(n,r){var a={x:n.x,y:n.y,active:n.active||""};return"undefined"!=typeof n.label&&(a.label=n.label),a.groupIndex=r,a.seriesIndex=t.seriesIndex,a.seri=t.seri,a.color=t.color||"",a.y0=n.y+(e>0?_[t.seriesIndex-1]._values[r].y0:0),a}),t}),j=U.length,o(U))return t;if(q?Y.forEach(function(t,e){var n="undefined"==typeof t.label||""===t.label?p.noLabel:G?D.isNumeric(t.label)||t.label.indexOf("GMT")!==-1?new Date(t.label):new Date(t.label+" GMT"):t.label;t.group=e,t.label=n,t.total=0,t._height=0}):Y=U[0].values.map(function(t,e){return{group:e,label:G?new Date(t.x):t.x,total:0,_height:0}}),Y.forEach(function(t,e){U.forEach(function(n,r){n.values.filter(function(t,n){return t.groupIndex===e}).forEach(function(e,n){t.total+=e.y,t._height+=Math.abs(e.y)})})}),l(Y),y&&(l(Y.filter(function(t,e){return 0!==t._height})),U.forEach(function(t,e){return t.values=t.values.filter(function(t,e){return 0!==Y[e]._height}).map(function(t,e){return t}),t}),o(U)))return t;$=e.sum(Y,function(t){return t.total});var tt=75,et=null,nt=null,rt=null,at={axis:null,maxmin:null};G&&(et=D.getDateFormatUTC(X)),I.valueFormat(function(t,e){return x(t,e,null,W,0)}),nt=function(t,e,n,r){var a=X[e],i=w(t,e,a,G,et);return"no-ellipsis"===r?i:D.stringEllipsify(i,h,tt)},rt=function(t,e,n,r){var a=at[r]||s(r,n);return k(t,e,null,W,a.precision,a.decimal)},f.disabled=U.map(function(t){return!!t.disabled}),f.active=U.map(function(t){return"active"===t.active}),f.stacked=I.stacked(),C.chart(t).title(H.title).controlsData(Q).legendData(_),S.orient(m?"bottom":"left").scale(I.xScale()).valueFormat(nt).tickSize(0).tickPadding(4).highlightZero(!1).showMaxMin(!1),L.orient(m?"left":"bottom").scale(I.yScale()).valueFormat(rt).tickPadding(4).showMaxMin(!0);var it=h.selectAll("g.sc-chart-wrap").data([U]),ot=it.enter().append("g").attr("class","sc-chart-wrap sc-chart-"+M),lt=h.select(".sc-chart-wrap").merge(ot);ot.append("defs");lt.select("defs");ot.append("g").attr("class","sc-background-wrap");var st=lt.select(".sc-background-wrap");ot.append("g").attr("class","sc-title-wrap"),ot.append("g").attr("class","sc-axis-wrap sc-axis-y");var ct=lt.select(".sc-axis-wrap.sc-axis-y");ot.append("g").attr("class","sc-scroll-wrap");var ut=lt.select(".sc-scroll-wrap");ot.select(".sc-scroll-wrap").append("g").attr("class","sc-axis-wrap sc-axis-x");var dt=lt.select(".sc-axis-wrap.sc-axis-x");ot.select(".sc-scroll-wrap").append("g").attr("class","sc-bars-wrap");var ft=lt.select(".sc-bars-wrap");ot.append("g").attr("class","sc-controls-wrap"),ot.append("g").attr("class","sc-legend-wrap"),lt.attr("transform",D.translation(n.left,n.top)),v?P(lt,ot,ut,S):ot.select(".sc-background-wrap").append("rect").attr("class","sc-background").attr("x",-n.left).attr("y",-n.top).attr("fill","#FFF"),t.render=function(){function t(t){return"width"===t?m&&v?Math.max(p,F):p:"height"===t?!m&&v?Math.max(y,F):y:0}function e(){N=S.margin(),z=L.margin(),d.left=Math.max(N.left,z.left),d.right=Math.max(N.right,z.right),d.top=Math.max(N.top,z.top),d.bottom=Math.max(N.bottom,z.bottom),a()}function a(){p=R-d.left-d.right,y=V-x-d.top-d.bottom,I.resetDimensions(t("width"),t("height"))}function o(){L.ticks(y/48).tickSize(m?-p:-y,0).margin(d),ct.call(L),e()}function l(){S.tickSize(0).margin(d),dt.call(S),e()}var s,u,d,p,y,x,w=0,k=0;O=parseInt(h.style("width"),10),B=parseInt(h.style("height"),10),s=r||O||960,u=i||B||400,R=s-n.left-n.right,V=u-n.top-n.bottom,d={top:0,right:0,bottom:0,left:0},p=R-d.left-d.right,y=V-d.top-d.bottom,st.select(".sc-background").attr("width",s).attr("height",u);var M=f.stacked?J:J*j+J,A=J*(f.stacked?.25:1),F=K*M+A;tt=Math.max(m?2*J:.2*R,75),C.width(R).height(V),h.call(C),x=C.getHeight(),d.top+=x,y=V-d.top-d.bottom,I.vertical(m).baseDimension(J).disabled(_.map(function(t){return t.disabled})).width(t("width")).height(t("height")),ft.datum(U).call(I);var z={top:0,right:0,bottom:0,left:0},N={top:0,right:0,bottom:0,left:0};if(o(),l(),o(),l(),o(),ft.transition().duration(c).call(I),d.top+=x,w=m||"left"===S.orient()?0:p,k=m&&"bottom"===S.orient()?y+2:-2,dt.attr("transform",D.translation(w,k)),w=d.left+(m||"bottom"===L.orient()?0:p),k=d.top+(m||"left"===L.orient()?0:y),ct.attr("transform",D.translation(w,k)),ut.attr("transform",D.translation(d.left,d.top)),v){T=F>(m?p:y),dt.select(".sc-axislabel").attr("x",(m?p:-y)/2);var H=(m?p:y)-F,G=function(){var t;g.call("tooltipHide",this),E=P.pan(H),t=m?p-2*E:2*E-y,t/=2,dt.select(".sc-axislabel").attr("x",t)};P.enable(T).width(p).height(y).margin(d).minDimension(F).vertical(m).panHandler(G).resize(E,b),P.panHandler()()}},t.render(),C.legend.dispatch.on("legendClick",function(e,n){e.disabled=!e.disabled,_.filter(function(t){return!t.disabled}).length||_.forEach(function(t){t.disabled=!1}),f.disabled=_.map(function(t){return!!t.disabled}),e.active="inactive",e.values.forEach(function(t){t.active="inactive"}),_.filter(function(t){return"active"===t.active}).length||t.clearActive(),f.active=_.map(function(t){return!!t.active}),t.update(),g.call("stateChange",this,f)}),C.controls.dispatch.on("legendClick",function(e,n){e.disabled&&(Q.forEach(function(t){t.disabled=!0}),e.disabled=!1,I.stacked("Grouped"!==e.key),f.stacked=I.stacked(),t.update(),g.call("stateChange",this,f))}),g.on("tooltipShow",function(t){u&&(Z&&(t.group=Y[t.groupIndex]),z=N(t,d.parentNode,H))}),g.on("tooltipMove",function(t){z&&F.position(d.parentNode,z,t,m?"s":"w")}),g.on("tooltipHide",function(){u&&F.cleanup()}),g.on("changeState",function(e){"undefined"!=typeof e.disabled&&(_.forEach(function(t,n){t.disabled=e.disabled[n]}),f.disabled=e.disabled),"undefined"!=typeof e.active&&(_.forEach(function(t,n){t.active=e.active[n]?"active":"inactive",t.values.forEach(function(e){e.active=t.active})}),f.active=e.active,_.filter(function(t){return"active"===t.active}).length||t.clearActive()),"undefined"!=typeof e.stacked&&(I.stacked(e.stacked),f.stacked=e.stacked),t.update()}),g.on("chartClick",function(){C.controls.enabled()&&C.controls.dispatch.call("closeMenu",this),C.legend.enabled()&&C.legend.dispatch.call("closeMenu",this)}),I.dispatch.on("elementClick",function(e){Z&&e.groupIndex&&(e.group=Y[e.groupIndex]),g.call("chartClick",this),A(_,e,t,X)}),h.on("click",function(){e.event.stopPropagation(),g.call("chartClick",this)})}),t}var n={top:10,right:10,bottom:10,left:10},r=null,i=null,o="ltr",l=0,c=0,u=!0,f={},p={legend:{close:"Hide legend",open:"Show legend"},controls:{close:"Hide controls",open:"Show controls"},noData:"No Data Available.",noLabel:"undefined"},g=e.dispatch("chartClick","elementClick","tooltipShow","tooltipHide","tooltipMove","stateChange","changeState"),m=!0,v=!0,y=!0,b=function(t){},x=function(e,n,r,a,i){return D.numberFormatSI(e,i,a,t.locality())},w=function(e,n,r,a,i){var o=r||e;return a?(i=i&&0===i.indexOf("%")?i:"%x",D.dateFormat(o,i,t.locality())):o},k=function(e,n,r,a,i,o){return D.numberFormatSIFixed(e,i,a,t.locality(),o)},M=function(e,n){var r,a=n.seriesLabel||"Key",i=e.series.key,o="datetime"===n.xDataType,l=n.groupName||(o?"Date":"Group"),s=e.group||{},c=e.point.x,u=w(c,e.pointIndex,s.label,o,"%x"),d="currency"===n.yDataType,f=d?"Amount":"Count",h=e.point.y,p=D.numberFormat(h,null,d,t.locality()),g="";return g+="<p>"+a+": <b>"+i+"</b></p>",g+="<p>"+l+": <b>"+u+"</b></p>",
g+="<p>"+f+": <b>"+p+"</b></p>",e.group&&Number.isFinite(e.group._height)&&(r=Math.abs(100*h/e.group._height).toFixed(1),r=D.numberFormat(r,2,!1,t.locality()),g+="<p>Percentage: <b>"+r+"%</b></p>"),g},A=function(t,e,n,r){},I=d(),C=s(),S=a(),L=a(),T=!1,E=0,P=h().id(I.id()),z=null,N=function(t,e,n){var r=M(t,n),a=t.value<0?m?"n":"e":m?"s":"w";return F.show(t.e,r,a,null,e)};return C.showTitle(!0).showControls(!0).showLegend(!0),I.dispatch.on("elementMouseover.tooltip",function(t){g.call("tooltipShow",this,t)}),I.dispatch.on("elementMousemove.tooltip",function(t){g.call("tooltipMove",this,t)}),I.dispatch.on("elementMouseout.tooltip",function(t){g.call("tooltipHide",this,t)}),t.dispatch=g,t.multibar=I,t.legend=C.legend,t.controls=C.controls,t.xAxis=S,t.xAxisLabel=S.axisLabel,t.yAxis=L,t.yAxisLabel=L.axisLabel,t.options=D.optionsFunc.bind(t),D.rebind(t,I,"id","x","y","xScale","yScale","xDomain","yDomain","forceX","forceY","clipEdge","color","fill","classes","gradient","locality"),D.rebind(t,I,"stacked","showValues","valueFormat","nice","textureFill"),D.rebind(t,C,"showTitle","showControls","showLegend"),D.rebind(t,S,"rotateTicks","reduceXTicks","staggerTicks","wrapTicks"),t.colorData=function(n){var r=arguments[0],a=arguments[1]||{},i=function(t){return D.defaultColor()(t,t.seriesIndex)},o=function(t){return"sc-series sc-series-"+t.seriesIndex};switch(r){case"graduated":i=function(t){return e.interpolateHsl(e.rgb(a.c1),e.rgb(a.c2))(t.seriesIndex/a.l)};break;case"class":i=function(){return"inherit"},o=function(t){var e=t.seriesIndex,n=e*(a.step||1)%14;return n=(n>9?"":"0")+n,"sc-series sc-series-"+e+" sc-fill"+n+" sc-stroke"+n};break;case"data":i=function(t){return D.defaultColor()(t,t.seriesIndex)},o=function(t){return"sc-series sc-series-"+t.seriesIndex+(t.classes?" "+t.classes:"")}}var l=a.gradient?function(t){var e={orientation:a.orientation||(m?"vertical":"horizontal"),position:a.position||"middle"};return I.gradientFill(t,t.seriesIndex,e)}:i;return I.color(i),I.fill(l),I.classes(o),C.legend.color(i),C.legend.classes(o),t},t.margin=function(e){if(!arguments.length)return n;for(var r in e)e.hasOwnProperty(r)&&(n[r]=e[r]);return t},t.width=function(e){return arguments.length?(r=e,t):r},t.height=function(e){return arguments.length?(i=e,t):i},t.tooltips=function(e){return arguments.length?(u=e,t):u},t.tooltipContent=function(e){return arguments.length?(M=e,t):M},t.state=function(e){return arguments.length?(f=e,g.call("stateChange",this,f),t):f},t.strings=function(e){if(!arguments.length)return p;for(var n in e)e.hasOwnProperty(n)&&(p[n]=e[n]);return C.strings(p),t},t.direction=function(e){return arguments.length?(o=e,I.direction(e),S.direction(e),L.direction(e),C.direction(e),t):o},t.duration=function(e){return arguments.length?(c=e,I.duration(e),t):c},t.delay=function(e){return arguments.length?(l=e,I.delay(e),t):l},t.xValueFormat=function(e){return arguments.length?(w=e,t):w},t.yValueFormat=function(e){return arguments.length?(k=e,t):k},t.seriesClick=function(e){return arguments.length?(A=e,t):A},t.vertical=function(e){return arguments.length?(m=e,t):m},t.allowScroll=function(e){return arguments.length?(v=e,t):v},t.hideEmptyGroups=function(e){return arguments.length?(y=e,t):y},t.overflowHandler=function(e){return arguments.length?(b=D.functor(e),t):b},t}function M(){function t(a){return a.each(function(a){function l(t){var e=t&&t.length&&t.filter(function(t){return t.values&&t.values.length}).length,r=(H-n.left-n.right)/2+n.left,a=(_-n.top-n.bottom)/2+n.top;return D.displayNoData(e,p,v.noData,r,a)}var u,d,h=this,p=e.select(this),g="pareto",x=a?a.properties||{}:{},N=a?a.data||null:null,H=parseInt(p.style("width"),10),_=parseInt(p.style("height"),10),V=Math.pow(6,2)*Math.PI,G="datetime"===x.xDataType||!1,W="currency"===x.yDataType||!1,Y=I.stacked()?72:32,q=function(t,e,n,r){var a=j&&Array.isArray(j)?j[e]||t:t,i=k(t,e,a,G),o=Math.max(2*Y,75);return r?i:D.stringEllipsify(i,p,o)},X=function(t,e,n,r){return M(t,e,null,W)};if(t.update=function(){p.transition().call(t)},t.container=this,l(N))return t;t.dataSeriesActivate=function(e){var n=e.series;n.active=n.active&&"inactive"!==n.active?"inactive":"active",n.values.map(function(t){t.active=n.active}),"active"===n.active&&N.filter(function(t){return"active"!==t.active}).map(function(t){return t.active="inactive",t.values.map(function(t){t.active="inactive"}),t}),N.filter(function(t){return"active"===t.active}).length||N.map(function(t){return t.active="",t.values.map(function(t){t.active=""}),p.selectAll(".sc-series").classed("sc-inactive",!1),t}),p.call(t)},N.forEach(function(t,e){t._values||(t._values=t.values.map(function(t,e){return{x:Array.isArray(t)?t[0]:t.x,y:Array.isArray(t)?t[1]:t.y}}))});var K=N.filter(function(t){return!t.type||"bar"===t.type}).map(function(t,e){return t.seriesIndex=e,t.values=t._values.map(function(n,r){return{group:r,seriesIndex:t.seriesIndex,color:"undefined"!=typeof t.color?t.color:"",x:I.x()(n,r),y:I.y()(n,r),y0:n.y+(e>0?N[t.seriesIndex-1].values[r].y0:0),active:"undefined"!=typeof t.active?t.active:""}}),t}).filter(function(t){return!t.disabled}).map(function(t,e){return t.seri=e,t.values.forEach(function(e,n){e.seri=t.seri}),t});K=K.length?K:[{values:[]}];var Z=N.filter(function(t){return"line"===t.type}).map(function(t,e){return t.seriesIndex=e,I.stacked()?(t.values.forEach(function(t){t.y=0}),K.map(function(e){e.values.map(function(e,n){t.values[n].y+=I.y()(e,n)})}),t.values.forEach(function(e,n){n>0&&(e.y+=t.values[n-1].y)})):t.values=t._values.map(function(e,n){return{seriesIndex:t.seriesIndex,color:"undefined"!=typeof t.color?t.color:"",x:S.x()(e,n)+.25*(t.seriesIndex-n),y:S.y()(e,n)}}),t}).filter(function(t){return!t.disabled}).map(function(t,e){return t.seri=e,t.values.forEach(function(e,n){e.seri=t.seri}),t});Z=Z.length?Z:[{values:[]}];var U=x.groupData,j=U.map(function(t){return[].concat(t.l)[0]||v.noLabel}),$=x.quota||0,J=x.quotaLabel||"",Q=x.targetQuota||0,tt=x.targetQuotaLabel||"",et=N.filter(function(t){return!t.type||"bar"===t.type}),nt=N.filter(function(t){return"line"===t.type});nt.push({key:J,type:"dash",color:"#444",seriesIndex:nt.length,values:{seriesIndex:nt.length,x:0,y:0}}),Q>0&&nt.push({key:tt,type:"dash",color:"#777",seriesIndex:nt.length,values:{seriesIndex:nt.length+1,x:0,y:0}});var rt=(N.filter(function(t){return!t.disabled}).map(function(t){return t._values.map(function(t,e){return y(t,e)})}),N.map(function(t){return t._values.map(function(t,e){return b(t,e)})}));o=o&&x.title&&x.title.length,u=I.xScale(),d=I.yScale(),L.orient("bottom").scale(u).valueFormat(q).tickSize(0).tickPadding(4).highlightZero(!1).showMaxMin(!1),T.orient("left").scale(d).valueFormat(X).tickPadding(7).showMaxMin(!0),t.render=function(){function a(){M.left=Math.max(yt,mt.left,vt.left),M.right=Math.max(mt.right,vt.right),M.top=Math.max(mt.top,vt.top)+Y,M.bottom=Math.max(mt.bottom,vt.bottom),l()}function l(){F=b-M.left-M.right,O=k-M.top-M.bottom,I.resetDimensions(F,O)}H=parseInt(p.style("width"),10),_=parseInt(p.style("height"),10);var m,y,b,k,M,F,O;m=r||H||960,y=i||_||400,b=m-n.left-n.right,k=y-n.top-n.bottom,M={top:0,right:0,bottom:0,left:0},O=k-M.top-M.bottom,F=b-M.left-M.right;var R=0,G=0,W=0,Y=0,q={width:0,height:0},X=p.selectAll("g.sc-chart-wrap").data([N]),U=X.enter().append("g").attr("class","sc-chart-wrap sc-chart-"+g),j=p.select(".sc-chart-wrap").merge(U);U.append("defs"),U.append("g").attr("class","sc-background-wrap");j.select(".sc-background-wrap");U.append("g").attr("class","sc-title-wrap");var at=j.select(".sc-title-wrap");U.append("g").attr("class","sc-axis-wrap sc-axis-x");var it=j.select(".sc-axis-wrap.sc-axis-x");U.append("g").attr("class","sc-axis-wrap sc-axis-y");var ot=j.select(".sc-axis-wrap.sc-axis-y");U.append("g").attr("class","sc-bars-wrap");var lt=j.select(".sc-bars-wrap");U.append("g").attr("class","sc-quota-wrap");var st=j.select(".sc-quota-wrap");U.append("g").attr("class","sc-lines-wrap1");var ct=j.select(".sc-lines-wrap1");U.append("g").attr("class","sc-lines-wrap2");var ut=j.select(".sc-lines-wrap2");U.append("g").attr("class","sc-legend-wrap sc-bar-legend");var dt=j.select(".sc-legend-wrap.sc-bar-legend");U.append("g").attr("class","sc-legend-wrap sc-line-legend");var ft=j.select(".sc-legend-wrap.sc-line-legend");j.attr("transform",D.translation(n.left,n.top)),U.select(".sc-background-wrap").append("rect").attr("x",-n.left).attr("y",-n.top).attr("width",m).attr("height",y).attr("fill","#FFF"),at.select(".sc-title").remove(),o&&(at.append("text").attr("class","sc-title").attr("x","rtl"===c?b:0).attr("y",0).attr("dy",".75em").attr("text-anchor","start").attr("stroke","none").attr("fill","black").text(x.title),q=D.getTextBBox(at.select(".sc-title")),Y+=q.height),s&&(E.id("barlegend_"+t.id()).strings(v.barlegend).align("left").height(k-M.top),dt.datum(et).call(E),R=E.calcMaxWidth(),P.id("linelegend_"+t.id()).strings(v.linelegend).align("right").height(k-M.top),ft.datum(nt).call(P),G=P.calcMaxWidth(),W=b/(R+G),E.arrange(Math.floor(W*R)),P.arrange(Math.floor(W*G)),dt.attr("transform","translate("+("rtl"===c?b-E.width():0)+","+M.top+")"),ft.attr("transform","translate("+("rtl"===c?0:b-P.width())+","+M.top+")")),Y+=Math.max(E.height(),P.height())+4,O=k-Y-M.top-M.bottom;var ht=Math.max(e.max(e.merge(rt)),$,Q||0),pt=[0,10*Math.ceil(.1*ht)];I.width(F).height(O).forceY(pt).id(t.id()),lt.datum(K).call(I);var gt=u(1)+u.bandwidth()/(I.stacked()||1===Z.length?2:4);C.margin({top:0,right:gt,bottom:0,left:gt}).width(F).height(O).forceY(pt).useVoronoi(!1).id("outline_"+t.id()),S.margin({top:0,right:gt,bottom:0,left:gt}).width(F).height(O).forceY(pt).useVoronoi(!1).size(V).sizeRange([V,V]).sizeDomain([V,V]).id("foreground_"+t.id()),ct.datum(Z).call(C),ut.datum(Z).call(S),it.call(L),ot.style("opacity",K.length?1:0).call(T);var mt=L.margin(),vt=T.margin(),yt=0,bt=14;st.selectAll("line").remove(),ot.selectAll("text.sc-quota-value").remove(),ot.selectAll("text.sc-target-quota-value").remove(),Q>0&&(st.append("line").attr("class","sc-quota-target").attr("x1",0).attr("y1",0).attr("x2",F).attr("y2",0).attr("transform","translate(0,"+d(Q)+")").style("stroke-dasharray","8, 8"),st.append("line").datum({key:tt,val:Q}).attr("class","sc-quota-target sc-quota-background").attr("x1",0).attr("y1",0).attr("x2",F).attr("y2",0).attr("transform","translate(0,"+d(Q)+")"),ot.append("text").text(A(Q,2,!0)).attr("class","sc-target-quota-value").attr("dy",".36em").attr("dx","0").attr("text-anchor","rtl"===c?"start":"end").attr("transform","translate("+(0-T.tickPadding())+","+d(Q)+")"),yt=Math.round(j.select("text.sc-target-quota-value").node().getBoundingClientRect().width+T.tickPadding())),$>0&&(st.append("line").attr("class","sc-quota-line").attr("x1",0).attr("y1",0).attr("x2",F).attr("y2",0).attr("transform","translate(0,"+d($)+")").style("stroke-dasharray","8, 8"),st.append("line").datum({key:J,val:$}).attr("class","sc-quota-line sc-quota-background").attr("x1",0).attr("y1",0).attr("x2",F).attr("y2",0).attr("transform","translate(0,"+d($)+")"),ot.append("text").text(A($,2,!0)).attr("class","sc-quota-value").attr("dy",".36em").attr("dx","0").attr("text-anchor","rtl"===c?"start":"end").attr("transform","translate("+-T.tickPadding()+","+d($)+")"),yt=Math.max(yt,Math.round(j.select("text.sc-quota-value").node().getBoundingClientRect().width+T.tickPadding()))),a(),I.width(F).height(O),lt.call(I),it.call(L),ot.call(T),gt=u(1)+u.bandwidth()/(I.stacked()?2:2*Z.length),mt=L.margin(),vt=T.margin(),a();var xt=D.translation(M.left,M.top);I.width(F).height(O),lt.attr("transform",xt).call(I),C.margin({top:0,right:gt,bottom:0,left:gt}).width(F).height(O),S.margin({top:0,right:gt,bottom:0,left:gt}).width(F).height(O),ct.attr("transform",xt).call(C),ut.attr("transform",xt).call(S),st.attr("transform",xt).selectAll("line").attr("x2",F),it.attr("transform","translate("+M.left+","+("bottom"===L.orient()?O+M.top:M.top)+")").call(L),T.ticks(Math.ceil(O/48)).tickSize(-F,0),ot.attr("transform","translate("+("left"===T.orient()?M.left:M.left+F)+","+M.top+")").call(T),Q>0&&(st.selectAll("line.sc-quota-target").attr("x2",F).attr("transform","translate(0,"+d(Q)+")"),ot.select("text.sc-target-quota-value").attr("transform","translate("+(0-T.tickPadding())+","+d(Q)+")"),bt=Math.round(parseInt(j.select("text.sc-target-quota-value").node().getBoundingClientRect().height,10)/1.15),ot.selectAll("g.tick, g.sc-axisMaxMin").each(function(t,n){Math.abs(d(t)-d(Q))<=bt&&e.select(this).style("opacity",0)})),$>0&&(st.selectAll("line.sc-quota-line").attr("x2",F).attr("transform","translate(0,"+d($)+")"),ot.select("text.sc-quota-value").attr("transform","translate("+(0-T.tickPadding())+","+d($)+")"),bt=Math.round(parseInt(j.select("text.sc-quota-value").node().getBoundingClientRect().height,10)/1.15),ot.selectAll("g.tick, g.sc-axisMaxMin").each(function(t,n){Math.abs(d(t)-d($))<=bt&&e.select(this).style("opacity",0)}),Q>0&&Math.abs(d($)-d(Q))<=bt&&ot.select(".sc-target-quota-value").style("opacity",0)),st.selectAll("line.sc-quota-background").on("mouseover",function(t){if(f){var n={val:t.val,key:t.key,e:e.event};z=B(n,h.parentNode)}}).on("mousemove",function(){var t=e.event;w.call("tooltipMove",this,t)}).on("mouseout",function(){w.call("tooltipHide",this)})},t.render(),E.dispatch.on("legendClick",function(e,n){var r=e.seriesIndex;e.disabled=!e.disabled,t.stacked()||N.filter(function(t){return t.seriesIndex===r&&"line"===t.type}).map(function(t){return t.disabled=!t.disabled,t}),N.filter(function(t){return!t.disabled&&"bar"===t.type}).length||N.map(function(t){return t.disabled=!1,t}),p.call(t)}),w.on("tooltipShow",function(t){f&&(z=O(t,h.parentNode,U))}),w.on("tooltipMove",function(t){z&&F.position(h.parentNode,z,t,"s")}),w.on("tooltipHide",function(){f&&F.cleanup()}),w.on("changeState",function(e){"undefined"!=typeof e.disabled&&(N.forEach(function(t,n){t.disabled=e.disabled[n]}),m.disabled=e.disabled),"undefined"!=typeof e.stacked&&(I.stacked(e.stacked),m.stacked=e.stacked),p.transition().call(t)}),w.on("chartClick",function(){E.enabled()&&E.dispatch.call("closeMenu",this),P.enabled()&&P.dispatch.call("closeMenu",this)}),I.dispatch.on("elementClick",function(e){w.call("chartClick",this),R(N,e,t,p)})}),t}var n={top:10,right:10,bottom:10,left:10},r=null,i=null,o=!1,s=!0,c="ltr",f=!0,h=!1,p=0,g=0,m={},v={barlegend:{close:"Hide bar legend",open:"Show bar legend"},linelegend:{close:"Hide line legend",open:"Show line legend"},controls:{close:"Hide controls",open:"Show controls"},noData:"No Data Available.",noLabel:"undefined"},y=function(t){return t.x},b=function(t){return t.y},x=D.buildLocality(),w=e.dispatch("chartClick","tooltipShow","tooltipHide","tooltipMove","stateChange","changeState"),k=function(e,n,r,a){return a?D.dateFormat(r,"%x",t.locality()):r},M=function(e,n,r,a){var i=2;return D.numberFormatSI(e,i,a,t.locality())},A=M,I=d().stacked(!0).clipEdge(!1).withLine(!0).nice(!1),C=u().color(function(t,e){return"#FFF"}).fill(function(t,e){return"#FFF"}).useVoronoi(!1).nice(!1),S=u().useVoronoi(!1).color("data").nice(!1),L=a(),T=a(),E=l().align("left").position("middle"),P=l().align("right").position("middle"),z=null,N=function(t,e,n,r,a){return"<p><b>"+t+"</b></p><p><b>"+n+"</b></p><p><b>"+e+"%</b></p>"},H=function(t,e,n,r,a){return"<p><p>"+t+": <b>"+n+"</b></p>"},_=function(t,e,n,r,a){return"<p>"+r.key+": <b>"+n+"</b></p>"},O=function(e,n,r){var a=e.series.key,i=(100*e.point.y/r[e.pointIndex].t).toFixed(1),o=S.y()(e.point,e.pointIndex),l="bar"===e.series.type?N(a,i,o,e,t):H(a,i,o,e,t);return F.show(e.e,l,"s",null,n)},B=function(e,n){var r=_(e.key,0,e.val,e,t);return F.show(e.e,r,"s",null,n)},R=function(t,e,n,r){};return S.dispatch.on("elementMouseover.tooltip",function(t){w.call("tooltipShow",this,t)}),S.dispatch.on("elementMousemove.tooltip",function(t){w.call("tooltipMove",this,t)}),S.dispatch.on("elementMouseout.tooltip",function(){w.call("tooltipHide",this)}),I.dispatch.on("elementMouseover.tooltip",function(t){w.call("tooltipShow",this,t)}),I.dispatch.on("elementMousemove.tooltip",function(t){w.call("tooltipMove",this,t)}),I.dispatch.on("elementMouseout.tooltip",function(){w.call("tooltipHide",this)}),t.dispatch=w,t.linesBackground=C,t.lines=S,t.multibar=I,t.barLegend=E,t.lineLegend=P,t.xAxis=L,t.xAxisLabel=L.axisLabel,t.yAxis=T,t.yAxisLabel=T.axisLabel,t.options=D.optionsFunc.bind(t),D.rebind(t,I,"id","xScale","yScale","xDomain","yDomain","forceY","color","fill","classes","gradient"),D.rebind(t,I,"stacked","showValues","valueFormat","nice","textureFill"),D.rebind(t,L,"rotateTicks","staggerTicks","wrapTicks","reduceXTicks"),t.colorData=function(n){var r=arguments[0],a=arguments[1]||{},i=function(t){return D.defaultColor()(t,t.seriesIndex)},o=function(t,e){return"sc-series sc-series-"+t.seriesIndex},l=function(t,n){var r=a.lineColor?a.lineColor:{c1:"#1A8221",c2:"#62B464",l:1};return t.color||e.interpolateHsl(e.rgb(r.c1),e.rgb(r.c2))(t.seriesIndex/2)},s=function(t,e){return"sc-series sc-series-"+t.seriesIndex};switch(r){case"graduated":i=function(t){return e.interpolateHsl(e.rgb(a.barColor.c1),e.rgb(a.barColor.c2))(t.seriesIndex/a.barColor.l)};break;case"class":i=function(){return"inherit"},o=function(t){var e=t.seriesIndex,n=e*(a.step||1)%14;return n=(n>9?"":"0")+n,"sc-series sc-series-"+e+" sc-fill"+n},s=function(t){var e=t.seriesIndex,n=e*(a.step||1)%14;return n=(n>9?"":"0")+n,"sc-series sc-series-"+e+" sc-fill"+n+" sc-stroke"+n};break;case"data":i=function(t){return t.classes?"inherit":t.color||D.defaultColor()(t,t.seriesIndex)},o=function(t){return"sc-series sc-series-"+t.seriesIndex+(t.classes?" "+t.classes:"")},s=function(t){return"sc-series sc-series-"+t.seriesIndex+(t.classes?" "+t.classes:"")}}var c=a.gradient?function(t){var e={orientation:a.orientation||"vertical",position:a.position||"middle"};return I.gradientFill(t,t.seriesIndex,e)}:i;return I.color(i),I.fill(c),I.classes(o),S.color(l),S.fill(l),S.classes(s),E.color(i),E.classes(o),P.color(l),P.classes(s),t},t.x=function(e){return arguments.length?(y=e,S.x(e),I.x(e),t):y},t.y=function(e){return arguments.length?(b=e,S.y(e),I.y(e),t):b},t.margin=function(e){if(!arguments.length)return n;for(var r in e)e.hasOwnProperty(r)&&(n[r]=e[r]);return t},t.width=function(e){return arguments.length?(r=e,t):r},t.height=function(e){return arguments.length?(i=e,t):i},t.showTitle=function(e){return arguments.length?(o=e,t):o},t.showLegend=function(e){return arguments.length?(s=e,t):s},t.tooltipBar=function(e){return arguments.length?(N=e,t):N},t.tooltipLine=function(e){return arguments.length?(H=e,t):H},t.tooltipQuota=function(e){return arguments.length?(_=e,t):_},t.tooltips=function(e){return arguments.length?(f=e,t):f},t.clipEdge=function(e){return arguments.length?(h=e,I.clipEdge(e),C.clipEdge(e),S.clipEdge(e),t):h},t.state=function(e){return arguments.length?(m=e,t):m},t.strings=function(e){if(!arguments.length)return v;for(var n in e)e.hasOwnProperty(n)&&(v[n]=e[n]);return E.strings(v.barlegend),P.strings(v.linelegend),t},t.direction=function(e){return arguments.length?(c=e,I.direction(e),L.direction(e),T.direction(e),E.direction(e),P.direction(e),t):c},t.duration=function(e){return arguments.length?(g=e,I.duration(e),C.duration(e),S.duration(e),t):g},t.delay=function(e){return arguments.length?(p=e,I.delay(e),C.delay(e),S.delay(e),t):p},t.seriesClick=function(e){return arguments.length?(R=e,t):R},t.colorFill=function(e){return t},t.xValueFormat=function(e){return arguments.length?(k=e,t):k},t.yValueFormat=function(e){return arguments.length?(M=e,t):M},t.quotaValueFormat=function(e){return arguments.length?(A=e,t):A},t.locality=function(e){return arguments.length?(x=D.buildLocality(e),I.locality(e),C.locality(e),t):x},t}function A(){function t(i){return i.each(function(i){function o(t){var e=t&&t.length,r=(A-n.left-n.right)/2+n.left,a=(I-n.top-n.bottom)/2+n.top;return D.displayNoData(e,f,h.noData,r,a)}var s=this,f=e.select(this),b="pie",k=i?i.properties||{}:{},M=i?i.data||null:null,A=parseInt(f.style("width"),10),I=parseInt(f.style("height"),10);"datetime"===k.xDataType||!1,"currency"===k.yDataType||!1;if(t.update=function(){f.transition().duration(l).call(t)},t.container=this,o(M))return t;t.setActiveState=function(t,e){t.active=e},t.clearActive=function(e){M.forEach(function(n){t.setActiveState(n,e||"")}),delete u.active},t.seriesActivate=function(e){var n,r=e.series||M[e.seriesIndex];r&&(d?(n="undefined"==typeof r.active||"inactive"===r.active||""===r.active?"active":"",t.clearActive("active"===n?"inactive":""),t.setActiveState(r,n),u.active=M.map(function(t){return"active"===t.active})):t.dataSeriesActivate({series:r}))},t.dataSeriesActivate=function(e){var n=e.series;n.active=n.active&&"inactive"!==n.active?"inactive":"active","active"===n.active&&M.filter(function(t){return"active"!==t.active}).forEach(function(t){return t.active="inactive",t}),M.filter(function(t){return"active"===t.active}).length||t.clearActive()},M.forEach(function(t,n){t.seriesIndex=n,t.values||(t.value?isNaN(t.value)||(t.values=[{x:0,y:parseInt(t.value,10)}]):t.values=[]),t.values.forEach(function(e,r){e.index=n,e.series=t,"undefined"==typeof e.value&&(e.value=e.y)}),t.key=t.key||h.noLabel,t.value=t.value||e.sum(t.values,function(t){return t.value}),t.count=t.count||t.values.length,t.disabled=t.disabled||0===t.value});var C=M.filter(function(t){return!t.disabled});if(C.length||(C=[{values:[]}]),k.count=e.sum(C,function(t){return t.count}),k.total=e.sum(C,function(t){return t.value}),u.disabled=M.map(function(t){return!!t.disabled}),!k.total)return o(),t;m.chart(t).title(k.title).controlsData(v).legendData(M);var S=f.selectAll("g.sc-chart-wrap").data([C]),L=S.enter().append("g").attr("class","sc-chart-wrap sc-chart-"+b),T=f.select(".sc-chart-wrap").merge(L);L.append("defs");T.select("defs");L.append("g").attr("class","sc-background-wrap");var E=T.select(".sc-background-wrap");L.append("g").attr("class","sc-title-wrap"),L.append("g").attr("class","sc-"+b+"-wrap");var P=T.select(".sc-"+b+"-wrap");L.append("g").attr("class","sc-controls-wrap"),L.append("g").attr("class","sc-legend-wrap"),T.attr("transform",D.translation(n.left,n.top)),L.select(".sc-background-wrap").append("rect").attr("class","sc-background").attr("x",-n.left).attr("y",-n.top).attr("fill","#FFF"),t.render=function(){var t,e,i,o,s,c,u,d;A=parseInt(f.style("width"),10),I=parseInt(f.style("height"),10),t=r||A||960,e=a||I||400,i=t-n.left-n.right,o=e-n.top-n.bottom,s={top:0,right:0,bottom:0,left:0},c=i-s.left-s.right,u=o-s.top-s.bottom,E.select(".sc-background").attr("width",t).attr("height",e),m.width(i).height(o),f.call(m),d=m.getHeight(),s.top+=d,u=o-s.top-s.bottom,g.width(c).height(u),P.datum(C).attr("transform",D.translation(s.left,s.top)).transition().duration(l).call(g)},t.render(),m.legend.dispatch.on("legendClick",function(e,n){e.disabled=!e.disabled,e.active=!1,M.filter(function(t){return!t.disabled}).length||M.forEach(function(t){t.disabled=!1}),M.filter(function(t){return"active"===t.active}).length||M.forEach(function(t){t.active=""}),u.disabled=M.map(function(t){return!!t.disabled}),p.call("stateChange",this,u),t.update()}),p.on("tooltipShow",function(t){c&&(y=x(t,s.parentNode,k))}),p.on("tooltipMove",function(t){y&&F.position(s.parentNode,y,t)}),p.on("tooltipHide",function(){c&&F.cleanup()}),p.on("changeState",function(e){"undefined"!=typeof e.disabled&&(C.forEach(function(t,n){t.disabled=e.disabled[n]}),u.disabled=e.disabled),t.update()}),p.on("chartClick",function(){m.controls.enabled()&&m.controls.dispatch.call("closeMenu",this),m.legend.enabled()&&m.legend.dispatch.call("closeMenu",this)}),g.dispatch.on("elementClick",function(e){p.call("chartClick",this),w(M,e,t)})}),t}var n={top:10,right:10,bottom:10,left:10},r=null,a=null,i="ltr",o=0,l=0,c=!0,u={},d=!0,h={legend:{close:"Hide legend",open:"Show legend"},controls:{close:"Hide controls",open:"Show controls"},noData:"No Data Available.",noLabel:"undefined"},p=e.dispatch("chartClick","elementClick","tooltipShow","tooltipHide","tooltipMove","stateChange","changeState"),g=f(),m=s(),v=[],y=null,b=function(e,n){var r=g.fmtKey()(e),a=n.seriesLabel||"Key",i=g.getValue()(e),o=n.total?(100*i/n.total).toFixed(1):100,l="currency"===n.yDataType,s=D.numberFormat(i,2,l,t.locality()),c=D.numberFormat(o,2,!1,t.locality());return"<p>"+a+": <b>"+r+"</b></p><p>"+(l?"Amount":"Count")+": <b>"+s+"</b></p><p>Percent: <b>"+c+"%</b></p>"},x=function(t,e,n){var r=b(t,n);return F.show(t.e,r,null,null,e)},w=function(t,e,n){};return m.showTitle(!0).showControls(!1).showLegend(!0).alignLegend("center"),g.dispatch.on("elementMouseover.tooltip",function(t){p.call("tooltipShow",this,t)}),g.dispatch.on("elementMousemove.tooltip",function(t){p.call("tooltipMove",this,t)}),g.dispatch.on("elementMouseout.tooltip",function(){p.call("tooltipHide",this)}),t.dispatch=p,t.pie=g,t.legend=m.legend,t.controls=m.controls,t.options=D.optionsFunc.bind(t),D.rebind(t,g,"id","color","fill","classes","gradient","locality","textureFill"),D.rebind(t,g,"getKey","getValue","getCount","fmtKey","fmtValue","fmtCount"),D.rebind(t,g,"showLabels","showLeaders","donutLabelsOutside","pieLabelsOutside","labelThreshold"),D.rebind(t,g,"arcDegrees","rotateDegrees","minRadius","maxRadius","fixedRadius","startAngle","endAngle","donut","hole","holeFormat","donutRatio"),D.rebind(t,m,"showTitle","showControls","showLegend"),t.colorData=function(n){var r=arguments[0],a=arguments[1]||{},i=function(t,e){return D.defaultColor()(t,t.seriesIndex)},o=function(t,e){return"sc-series sc-series-"+t.seriesIndex};switch(r){case"graduated":i=function(t,n){return e.interpolateHsl(e.rgb(a.c1),e.rgb(a.c2))(t.seriesIndex/a.l)};break;case"class":i=function(){return"inherit"},o=function(t,e){var n=t.seriesIndex*(a.step||1)%14;return n=(n>9?"":"0")+n,"sc-series sc-series-"+t.seriesIndex+" sc-fill"+n+" sc-stroke"+n};break;case"data":i=function(t,e){return D.defaultColor()(t,t.seriesIndex)},o=function(t,e){return"sc-series sc-series-"+t.seriesIndex+(t.classes?" "+t.classes:"")}}var l=a.gradient?function(t,e){return g.gradientFill(t,t.seriesIndex)}:i;return g.color(i),g.fill(l),g.classes(o),m.legend.color(i),m.legend.classes(o),t},t.margin=function(e){if(!arguments.length)return n;for(var r in e)e.hasOwnProperty(r)&&(n[r]=e[r]);return t},t.width=function(e){return arguments.length?(r=e,t):r},t.height=function(e){return arguments.length?(a=e,t):a},t.tooltips=function(e){return arguments.length?(c=e,t):c},t.tooltipContent=function(e){return arguments.length?(b=e,t):b},t.state=function(e){return arguments.length?(u=e,t):u},t.strings=function(e){if(!arguments.length)return h;for(var n in e)e.hasOwnProperty(n)&&(h[n]=e[n]);return m.strings(h),t},t.direction=function(e){return arguments.length?(i=e,g.direction(e),m.direction(e),t):i},t.duration=function(e){return arguments.length?(l=e,g.duration(e),t):l},t.delay=function(e){return arguments.length?(o=e,g.delay(e),t):o},t.seriesClick=function(e){return arguments.length?(w=e,t):w},t}function I(){function t(r){return r.each(function(r){function a(t){N=e.hierarchy(t,function(t){return t.children}),B(N),H=N.descendants(),H.forEach(function(t){y(t,2*t.depth*(p?s.width:s.height))}),_=H.slice(1)}function c(t){b(t,w(t)),x(t,k(t)),t.children&&t.children.length&&t.children.forEach(c)}function m(t,e){var n=k(t)-(p?0:s.height-3*i),r=w(t)-(p?s.width-2*i:0),a=k(e),o=w(e),l=p?(r+o)/2:r,c=p?n:(n+a)/2,u=p?(r+o)/2:o,d=p?a:(n+a)/2;return"M"+r+","+n+"C"+l+","+c+" "+u+","+d+" "+o+","+a}function v(t){t.children?(t._children=t.children,t.children=null):(t.children=t._children,t._children=null)}function S(e){v(e.data),t.update(e)}function L(t){var e="node-"+I(t);return e}function T(t){var e="link-"+(t.parent?I(t.parent):0)+"-"+I(t);return e}var E=e.select(this),P=r,z=e.transition("tree").duration(o).ease(e.easeLinear),N=null,H=null,_=null,O=null,B=e.tree().size([null,null]).nodeSize([p?s.height:s.width,1]).separation(function(t,e){return t.parent==e.parent,1}),R={width:parseInt(E.style("width"),10)-n.left-n.right,height:parseInt(E.style("height"),10)-n.top-n.bottom},V=E.selectAll("g.sc-chart-wrap").data([1]),G=V.enter().append("g").attr("class","sc-chart-wrap sc-chart-tree"),W=E.select(".sc-chart-wrap").merge(G),Y=G.append("defs"),q=W.select("defs").merge(Y),X=D.dropShadow("node_back_"+g,q,{blur:2});Y.append("clipPath").attr("id","sc-edge-clip-"+g).append("rect");var K=q.select("#sc-edge-clip-"+g+" rect");K.attr("width",R.width).attr("height",R.height).attr("x",n.left).attr("y",n.top),W.attr("clip-path",F?"url(#sc-edge-clip-"+g+")":""),G.append("rect").attr("class","sc-chart-background").attr("width",R.width).attr("height",R.height).attr("transform",D.translation(n.left,n.top)).style("fill","transparent");var Z=W.select(".sc-chart-background"),U=G.append("g").attr("class","sc-tree-wrap"),j=W.select(".sc-tree-wrap");U.append("g").attr("class","sc-wrap sc-tree");var $=W.select(".sc-wrap.sc-tree");t.setZoom=function(){O=e.zoom().scaleExtent([l.min,l.max]).on("zoom",function(){j.attr("transform","translate("+e.event.transform.x+","+e.event.transform.y+")scale("+e.event.transform.k+")"),d(e.event.transform.k)})},t.unsetZoom=function(t){O.on("zoom",null)},t.resetZoom=function(){W.call(O.transform,e.zoomIdentity)},t.orientation=function(e){p="horizontal"===e||!p,B.nodeSize([p?s.height:s.width,1]),t.update(N)},t.showall=function(){function e(t){t._children&&t._children.length&&(t.children=t._children,t._children=null),t.children&&t.children.length&&t.children.forEach(e)}P=r,e(P),t.update(N)},t.zoomStep=function(t){var n=e.zoomTransform(W.node()),r=n.k+t;return this.zoomLevel(r)},t.zoomLevel=function(t){var n=e.zoomTransform(W.node()),r=Math.min(Math.max(t,l.min),l.max),a=n.k,i=[n.x,n.y],o=Z.node().getBoundingClientRect(),s=[o.width,o.height],c=[(s[0]-s[0]*r)/2,(s[1]-s[1]*r)/2],u=[r*(i[0]-(s[0]-s[0]*a)/2)/a,r*(i[1]-(s[1]-s[1]*a)/2)/a],d=[c[0]+u[0],c[1]+u[1]],f=e.zoomIdentity.translate(d[0],d[1]).scale(r);return W.call(O.transform,f),r},t.zoomScale=function(){var t=e.zoomTransform(W.node());return t.k},t.filter=function(e){function n(t){I(t)===e?(P=t,a=!0):!a&&t.children&&t.children.forEach(n)}var a=!1;n(r),t.update(N)},t.update=function(e){function n(t){if(I(e)===I(N))return m(N,N);var n={x:M(e),y:A(e)};return m(n,n)}function r(t){return m(t,t.parent)}function l(){return m(d,d)}var d={x:0,y:0};a(P);var g,v=(p?i-s.width:s.width/-2)+"px",y=(p?(i-s.height)/2:2*i-s.height)+"px",b=$.selectAll("g.sc-card").data(H,I);g=b.enter().insert("g").attr("class","sc-card").attr("id",L).attr("opacity",function(t){return I(e)===I(t)?1:0}).attr("transform",function(t){return I(e)===I(N)?"translate("+w(N)+","+k(N)+")":"translate("+(p?A(e):M(e))+","+(p?M(e):A(e))+")"}),g.each(function(t){var e,n;q.select("#"+C(t)).empty()&&(e=q.append("svg").attr("class","sc-foreign-object").attr("id",C(t)).attr("version","1.1").attr("xmlns","http://www.w3.org/2000/svg").attr("xmlns:xlink","http://www.w3.org/1999/xlink").attr("x",v).attr("y",y).attr("width",s.width+"px").attr("height",s.height+"px").attr("viewBox","0 0 "+s.width+" "+s.height).attr("xml:space","preserve"),n=e.append("g").attr("class","sc-tree-node-content").attr("transform","translate("+i+","+i+")"),u(n,t,s.width-2*i,s.height-3*i))}),g.append("use").attr("xlink:href",function(t){return"#"+C(t)}).attr("filter",X).on("click",h);var x;x=$.selectAll("g.sc-card").merge(g),x.transition(z).duration(o).attr("opacity",1).attr("transform",function(t){return I(e)===I(t)&&(d={x:p?k(t):w(t),y:p?w(t):k(t)}),"translate("+w(t)+","+k(t)+")"}).on("end",f);var D;D=b.exit().transition(z).duration(o).attr("opacity",0).attr("transform",function(t){return"translate("+M(e)+","+A(e)+")"}).remove(),D.selectAll(".sc-expcoll").style("stroke-opacity",1e-6),q.selectAll(".sc-foreign-object").attr("x",v).attr("y",y);var F;F=g.append("g").attr("class","sc-expcoll").style("opacity",1e-6).on("click",S),F.append("circle").attr("class","sc-circ-back").attr("r",i),F.append("line").attr("class","sc-line-vert").attr("x1",0).attr("y1",.5-i).attr("x2",0).attr("y2",i-.5).style("stroke","#bbb"),F.append("line").attr("class","sc-line-hrzn").attr("x1",.5-i).attr("y1",0).attr("x2",i-.5).attr("y2",0).style("stroke","#fff");
var E;E=$.selectAll("g.sc-expcoll").merge(F),E.style("opacity",function(t){return t.data.children&&t.data.children.length||t.data._children&&t.data._children.length?1:0}),E.select(".sc-circ-back").style("fill",function(t){return t.data._children&&t.data._children.length?"#777":t.data.children?"#bbb":"none"}),E.select(".sc-line-vert").style("stroke",function(t){return t.data._children&&t.data._children.length?"#fff":"#bbb"});var O,B=$.selectAll("path.link").data(_,T),R=B.enter().insert("path","g").attr("d",n).attr("class","link").attr("id",T).attr("opacity",0);O=$.selectAll("path.link").merge(R),O.transition(z).duration(o).attr("d",r).attr("opacity",1),B.exit().transition(z).duration(o).attr("d",l).attr("opacity",0).remove(),c(N),t.resize(I(e)===I(N))},t.render=function(){t.resize(!0)},t.resize=function(r){r="undefined"==typeof r||r,t.resetZoom(),R={width:parseInt(E.style("width"),10)-n.left-n.right,height:parseInt(E.style("height"),10)-n.top-n.bottom};var a=[Math.abs(e.min(H,w))+Math.abs(e.max(H,w))+s.width,Math.abs(e.min(H,k))+Math.abs(e.max(H,k))+s.height],i=R.width/a[0],l=R.height/a[1],c=e.min([i,l]),u=[Math.abs(e.min(H,w))+(i<l?0:(R.width/c-a[0])/2),Math.abs(e.min(H,k))+(i<l?(R.height/c-a[1])/2:0)],d=[s.width/(p?1:2),s.height/(p?2:1)],f=[(u[0]+d[0])*c+n.left/(p?2:1),(u[1]+d[1])*c+n.top/(p?1:2)];K.attr("width",R.width).attr("height",R.height),Z.attr("width",R.width).attr("height",R.height),$.transition(z).duration(r?0:o).attr("transform","translate("+f+")scale("+c+")")},t.setZoom(),W.call(O),a(P),c(N),t.update(N)}),t}var n={top:10,right:10,bottom:10,left:10},r=null,a=null,i=6,o=0,l={min:.25,max:2},s={width:100,height:50},c="../img/",u=function(t){return'<div class="sc-tree-node"></div>'},d=function(t){},f=function(t){},h=function(t){},p=!1,g=Math.floor(1e4*Math.random()),m=function(t,e){return D.defaultColor()(t,e)},v=function(t,e){return m(t,e)},y=function(t,e){t.y=e},b=function(t,e){t.data.x0=e},x=function(t,e){t.data.y0=e},w=function(t){return p?t.y:t.x},k=function(t){return p?t.x:t.y},M=function(t){return p?t.data.y0:t.data.x0},A=function(t){return p?t.data.x0:t.data.y0},I=function(t){return t.id||t.data.id},C=function(t){return"card-"+I(t)},S=!1,F=!0,L=!0,T=e.dispatch("chartClick","elementClick","elementDblClick","elementMouseover","elementMouseout");return t.dispatch=T,t.options=D.optionsFunc.bind(t),t.id=function(e){return arguments.length?(g=e,t):g},t.margin=function(e){return arguments.length?(n=e,t):n},t.width=function(e){return arguments.length?(r=e,t):r},t.height=function(e){return arguments.length?(a=e,t):a},t.x=function(e){return arguments.length?(w=e,t):w},t.y=function(e){return arguments.length?(k=D.functor(e),t):k},t.showLabels=function(e){return arguments.length?(L=e,t):L},t.color=function(e){return arguments.length?(m=e,t):m},t.fill=function(e){return arguments.length?(v=e,t):v},t.useClass=function(e){return arguments.length?(S=e,t):S},t.radius=function(e){return arguments.length?(i=e,t):i},t.duration=function(e){return arguments.length?(o=e,t):o},t.zoomExtents=function(e){return arguments.length?(l=e,t):l},t.zoomCallback=function(e){return arguments.length?(d=e,t):d},t.nodeSize=function(e){return arguments.length?(s=e,t):s},t.nodeImgPath=function(e){return arguments.length?(c=e,t):c},t.nodeRenderer=function(e){return arguments.length?(u=e,t):u},t.nodeCallback=function(e){return arguments.length?(f=e,t):f},t.nodeClick=function(e){return arguments.length?(h=e,t):h},t.horizontal=function(e){return arguments.length?(p=e,t):p},t.getId=function(e){return arguments.length?(I=e,t):I},t.getCardId=function(e){return arguments.length?(C=e,t):C},t}function C(){function t(i){return i.each(function(i){function o(t){var e=t&&t.length&&t.filter(function(t){return t&&t.children&&t.children.length}).length,r=(k-n.left-n.right)/2+n.left,a=(M-n.top-n.bottom)/2+n.top;return D.displayNoData(e,u,f.noData,r,a)}var s=this,u=e.select(this),d="treemap",p={},g=[i],k=parseInt(u.style("width"),10),M=parseInt(u.style("height"),10);if(t.update=function(){u.transition().duration(l).call(t)},t.setActiveState=function(t,e){t.active=e},t.clearActive=function(e){var n=e||g;n.children&&n.children.forEach(function(e){t.setActiveState(e,"")})},t.cellActivate=function(e){var n,r=e.d;r&&(n="undefined"==typeof r.active||"inactive"===r.active||""===r.active?"active":"",t.clearActive(r.parent),r.active=n,t.render())},t.container=this,o(g))return t;var A=g.filter(function(t){return!t.disabled});if(!A.length)return o(),t;y.chart(t).title(p.title).controlsData(b).legendData(g);var I=u.selectAll("g.sc-chart-wrap").data([A]),C=I.enter().append("g").attr("class","sc-chart-wrap sc-chart-"+d),S=u.select(".sc-chart-wrap").merge(C);C.append("defs"),C.append("g").attr("class","sc-background-wrap");var L=S.select(".sc-background-wrap");C.append("g").attr("class","sc-title-wrap"),C.append("g").attr("class","sc-"+d+"-wrap");var T=S.select(".sc-"+d+"-wrap");C.append("g").attr("class","sc-controls-wrap"),C.append("g").attr("class","sc-legend-wrap"),S.attr("transform",D.translation(n.left,n.top)),C.select(".sc-background-wrap").append("rect").attr("class","sc-background").attr("x",-n.left).attr("y",-n.top).attr("fill","#FFF"),t.render=function(){var t,e,i,o,s,c,d,f;k=parseInt(u.style("width"),10),M=parseInt(u.style("height"),10),t=r||k||960,e=a||M||400,i=t-n.left-n.right,o=e-n.top-n.bottom,s={top:0,right:0,bottom:0,left:0},c=i-s.left-s.right,d=o-s.top-s.bottom,L.select(".sc-background").attr("width",t).attr("height",e),y.width(i).height(o),u.call(y),f=y.getHeight(),d=o-s.top-s.bottom,v.width(c).height(d),T.datum(A).attr("transform",D.translation(s.left,s.top)).transition().duration(l).call(v)},t.render(),y.legend.dispatch.on("legendClick",function(e,n){e.disabled=!e.disabled,g.filter(function(t){return!t.disabled}).length||g.forEach(function(t){t.disabled=!1}),t.update()}),h.on("tooltipShow",function(t){c&&(x=w(t,s.parentNode))}),h.on("tooltipMove",function(t){x&&F.position(s.parentNode,x,t)}),h.on("tooltipHide",function(){c&&F.cleanup()}),v.dispatch.on("chartClick",function(e){e.children&&t.clearActive(e)}),v.dispatch.on("elementClick",function(e){m(g,e,t)})}),t}var n={top:10,right:10,bottom:10,left:10},r=null,a=null,i="ltr",o=0,l=0,c=!0,u="default",d=e.scaleOrdinal(e.schemeCategory20).range().map(D.identity),f={legend:{close:"Hide legend",open:"Show legend"},controls:{close:"Hide controls",open:"Show controls"},noData:"No Data Available.",noLabel:"undefined"},h=e.dispatch("chartClick","elementClick","tooltipShow","tooltipHide","tooltipMove","elementMousemove"),p=function(t,e){var n="<h3>"+t.data.name+"</h3><p>"+D.numberFormatSI(t.value)+"</p>";return n},m=function(t,e,n){},v=g(),y=s(),b=[],x=null,w=function(t,e,n){var r=p(t.point,n);return F.show(t.e,r,null,null,e)};return y.showTitle(!0).showControls(!1).showLegend(!1),v.dispatch.on("elementMouseover.tooltip",function(t){h.call("tooltipShow",this,t)}),v.dispatch.on("elementMousemove.tooltip",function(t){h.call("tooltipMove",this,t)}),v.dispatch.on("elementMouseout.tooltip",function(){h.call("tooltipHide",this)}),t.dispatch=h,t.treemap=v,t.legend=y.legend,t.options=D.optionsFunc.bind(t),D.rebind(t,v,"id","color","fill","classes","gradient"),D.rebind(t,v,"leafClick","getValue","getKey","textureFill"),D.rebind(t,y,"showTitle","showControls","showLegend"),t.colorData=function(n){if(!arguments.length)return u;var r=arguments[0],a=arguments[1]||{},i=function(t,e){var n="data"===r&&t.color?{color:t.color}:{};return D.getColor(d)(n,e)},o=function(t,e){return"sc-child"};switch(r){case"graduated":i=function(t,n,r){return e.interpolateHsl(e.rgb(a.c1),e.rgb(a.c2))(n/r)};break;case"class":i=function(){return"inherit"},o=function(t,e){var n=e*(a.step||1)%14;return n=(n>9?"":"0")+n,"sc-child "+(t.className||"sc-fill"+n)}}var l=a.gradient?function(t,e){var n={orientation:a.orientation||"horizontal",position:a.position||"base"};return v.gradientFill(t,e,n)}:i;return v.color(i),v.fill(l),v.classes(o),y.legend.color(i),y.legend.classes(o),u=arguments[0],t},t.margin=function(e){if(!arguments.length)return n;for(var r in e)e.hasOwnProperty(r)&&(n[r]=e[r]);return t},t.width=function(e){return arguments.length?(r=e,t):r},t.height=function(e){return arguments.length?(a=e,t):a},t.tooltips=function(e){return arguments.length?(c=e,t):c},t.tooltipContent=function(e){return arguments.length?(p=e,t):p},t.strings=function(e){if(!arguments.length)return f;for(var n in e)e.hasOwnProperty(n)&&(f[n]=e[n]);return y.strings(f),t},t.direction=function(e){return arguments.length?(i=e,v.direction(e),y.direction(e),t):i},t.duration=function(e){return arguments.length?(l=e,v.duration(e),t):l},t.delay=function(e){return arguments.length?(o=e,v.delay(e),t):o},t.seriesClick=function(e){return arguments.length?(m=e,t):m},t}e="default"in e?e.default:e;var S="0.6.12",D={};D.identity=function(t){return t},D.functor=function(t){return"function"==typeof t?t:function(){return t}},D.isFunction=function(t){var e={};return t&&"[object Function]"==e.toString.call(t)},D.rebind=function(t,e){for(var r,a=1,i=arguments.length;++a<i;)t[r=arguments[a]]=n(t,e,e[r]);return t},D.optionsFunc=function(t){return t?(e.map(t).each(function(t,e){var n=this[e],r=D.toNative(t);D.isFunction(n)&&(Array.isArray(r)?n.apply(r):n(r))}.bind(this)),this):this},D.windowSize=function(){var t={width:640,height:480};return document.body&&document.body.offsetWidth&&(t.width=document.body.offsetWidth,t.height=document.body.offsetHeight),"CSS1Compat"===document.compatMode&&document.documentElement&&document.documentElement.offsetWidth&&(t.width=document.documentElement.offsetWidth,t.height=document.documentElement.offsetHeight),window.innerWidth&&window.innerHeight&&(t.width=window.innerWidth,t.height=window.innerHeight),t},D.windowResize=function(t){window.attachEvent?window.attachEvent("onresize",t):window.addEventListener&&window.addEventListener("resize",t,!0)},D.windowUnResize=function(t){window.detachEvent?window.detachEvent("onresize",t):window.removeEventListener&&window.removeEventListener("resize",t,!0)},D.resizeOnPrint=function(t){if(window.matchMedia){var e=window.matchMedia("print");e.addListener(function(e){e.matches&&t()})}else window.attachEvent?window.attachEvent("onbeforeprint",t):window.onbeforeprint=t},D.unResizeOnPrint=function(t){if(window.matchMedia){var e=window.matchMedia("print");e.removeListener(function(e){e.matches&&t()})}else window.detachEvent?window.detachEvent("onbeforeprint",t):window.onbeforeprint=null},D.getColor=function(t){return arguments.length?Array.isArray(t)?function(e,n){return e.color||t[n%t.length]}:"[object String]"===Object.prototype.toString.call(t)?function(e){return e.color||"#"+t.replace("#","")}:t:D.defaultColor()},D.defaultColor=function(){var t=e.scaleOrdinal(e.schemeCategory20).range();return function(e,n){return e.color||t[n%t.length]}},D.getTextContrast=function(t,n,r){var a=t,i=e.lab(a),o=i.l,l=o>60?i.darker(4+(o-75)/25).l:i.brighter(4+(18-o)/25).l,s=e.lab(l,0,0),c=s.toString();return r&&r(i,s),c},D.customTheme=function(t,n,r){var a;return n=n||function(t){return t.key},r=r||e.scaleOrdinal(e.schemeCategory20).range(),a=r.length,function(e,i){var o=n(e);return a||(a=r.length),"undefined"!=typeof t[o]?"function"==typeof t[o]?t[o]():t[o]:r[--a]}},D.colorLinearGradient=function(t,n,r,a,i){var o="lg_gradient_"+n,l=i.select("#"+o);return l.empty()&&("middle"===r.position?D.createLinearGradient(o,r,i,[{offset:"0%","stop-color":e.rgb(a).darker().toString(),"stop-opacity":1},{offset:"20%","stop-color":e.rgb(a).toString(),"stop-opacity":1},{offset:"50%","stop-color":e.rgb(a).brighter().toString(),"stop-opacity":1},{offset:"80%","stop-color":e.rgb(a).toString(),"stop-opacity":1},{offset:"100%","stop-color":e.rgb(a).darker().toString(),"stop-opacity":1}]):D.createLinearGradient(o,r,i,[{offset:"0%","stop-color":e.rgb(a).darker().toString(),"stop-opacity":1},{offset:"50%","stop-color":e.rgb(a).toString(),"stop-opacity":1},{offset:"100%","stop-color":e.rgb(a).brighter().toString(),"stop-opacity":1}])),"url(#"+o+")"},D.createLinearGradient=function(t,e,n,r){var a,i,o="horizontal"===e.orientation?"0%":"100%",l="horizontal"===e.orientation?"100%":"0%",s=n.append("linearGradient");s.attr("id",t).attr("x1","0%").attr("y1","0%").attr("x2",o).attr("y2",l).attr("spreadMethod","pad");for(var c=0;c<r.length;c+=1){a=r[c],i=s.append("stop");for(var u in a)a.hasOwnProperty(u)&&i.attr(u,a[u])}},D.colorRadialGradient=function(t,n,r,a,i){var o="rg_gradient_"+n,l=i.select("#"+o);return l.empty()&&D.createRadialGradient(o,r,i,[{offset:r.s,"stop-color":e.rgb(a).brighter().toString(),"stop-opacity":1},{offset:"100%","stop-color":e.rgb(a).darker().toString(),"stop-opacity":1}]),"url(#"+o+")"},D.createRadialGradient=function(t,e,n,r){var a,i,o;o=n.append("radialGradient").attr("id",t).attr("r",e.r).attr("cx",e.x).attr("cy",e.y).attr("gradientUnits",e.u).attr("spreadMethod","pad");for(var l=0;l<r.length;l+=1){a=r[l],i=o.append("stop");for(var s in a)a.hasOwnProperty(s)&&i.attr(s,a[s])}},D.roundedRectangle=function(t,e,n,r,a){var i="M"+t+","+e+"h"+(n-2*a)+"a"+a+","+a+" 0 0 1 "+a+","+a+"v"+(r-2-2*a)+"a"+a+","+a+" 0 0 1 "+-a+","+a+"h"+(2*a-n)+"a"+-a+","+a+" 0 0 1 "+-a+","+-a+"v"+(-r+2*a+2)+"a"+a+","+a+" 0 0 1 "+a+","+-a+"z";return i},D.dropShadow=function(t,e,n){var r,a,i=n||{},o=i.height||"130%",l=i.offset||2,s=i.blur||1;return e.select("#"+t).empty()&&(r=e.append("filter").attr("id",t).attr("height",o),r.append("feOffset").attr("in","SourceGraphic").attr("result","offsetBlur").attr("dx",l).attr("dy",l),r.append("feColorMatrix").attr("in","offsetBlur").attr("result","matrixOut").attr("type","matrix").attr("values","1 0 0 0 0  0 1 0 0 0  0 0 1 0 0  0 0 0 1 0"),r.append("feGaussianBlur").attr("in","matrixOut").attr("result","blurOut").attr("stdDeviation",s),a=r.append("feMerge"),a.append("feMergeNode"),a.append("feMergeNode").attr("in","SourceGraphic")),"url(#"+t+")"},D.createTexture=function(t,e,n,r){var a="#sc-diagonalHatch-"+e,i="#sc-textureMask-"+e;return t.append("pattern").attr("id","sc-diagonalHatch-"+e).attr("patternUnits","userSpaceOnUse").attr("width",8).attr("height",8).append("path").attr("d","M-1,1 l2,-2 M0,8 l8,-8 M7,9 l1,-1").attr("class","texture-line").attr("stroke","#fff").attr("stroke-linecap","square"),t.append("mask").attr("id","sc-textureMask-"+e).attr("x",0).attr("y",0).attr("width","100%").attr("height","100%").append("rect").attr("x",n||0).attr("y",r||-1).attr("width","100%").attr("height","100%").attr("fill","url("+a+")"),i},D.stringSetLengths=function(t,e,n,r,a){var i=[],o=e.select(".tmp-text-strings").select("text");return o.empty()&&(o=e.append("g").attr("class","tmp-text-strings").append("text")),o.classed(r,!0),o.style("display","inline"),t.forEach(function(t,e){o.text(n(t,e)),i.push(o.node().getBoundingClientRect().width)}),o.text("").attr("class","tmp-text-strings").style("display","none"),i},D.stringSetThickness=function(t,e,n,r,a){var i=[],o=e.select(".tmp-text-strings").select("text");return o.empty()&&(o=e.append("g").attr("class","tmp-text-strings").append("text")),o.classed(r,!0),o.style("display","inline"),t.forEach(function(t,e){o.text(n(t,e)),i.push(o.node().getBoundingClientRect().height)}),o.text("").attr("class","tmp-text-strings").style("display","none"),i},D.maxStringSetLength=function(t,n,r,a){var i=D.stringSetLengths(t,n,r,a);return e.max(i)},D.stringEllipsify=function(t,e,n){var r=e.select(".tmp-text-strings").select("text"),a=t,i=0,o=0,l=0;for(r.empty()&&(r=e.append("g").attr("class","tmp-text-strings").append("text")),r.style("display","inline"),r.text("..."),o=r.node().getBoundingClientRect().width,r.text(a),i=r.node().getBoundingClientRect().width,l=i;i>n&&i>30;)a=a.slice(0,-1),r.text(a),i=r.node().getBoundingClientRect().width+o;return r.text(""),a+(l>n?"...":"")},D.getTextBBox=function(t,e){var n=t.node().getBoundingClientRect(),r={width:e?n.width:parseInt(n.width,10),height:e?n.height:parseInt(n.height,10),top:e?n.top:parseInt(n.top,10),left:e?n.left:parseInt(n.left,10)};return r},D.strip=function(t){return t.replace(/(\s|&)/g,"")},D.isRTLChar=function(t){var e="---",n=new RegExp("["+e+"]");return n.test(t)},D.NaNtoZero=function(t){return D.isNumeric(t)?t:0},D.polarToCartesian=function(t,e,n,r){var a=D.angleToRadians(r),i=t+n*Math.cos(a),o=e+n*Math.sin(a);return[i,o]},D.angleToRadians=function(t){return t*Math.PI/180},D.angleToDegrees=function(t){return 180*t/Math.PI},D.getAbsoluteXY=function(t){var e=document.documentElement,n=t.getBoundingClientRect(),r=e.scrollLeft+document.body.scrollLeft,a=e.scrollTop+document.body.scrollTop,i=n.left+r,o=n.top+a;return{left:i,top:o}},D.translation=function(t,e){return"translate("+t+","+e+")"},D.isNumeric=function(t){return!isNaN(t)&&Number.isFinite(t)},D.toNative=function(t){var e=D.isNumeric(parseFloat(t))?parseFloat(t):"true"===t||"false"!==t&&t;return e},D.toBoolean=function(t){var e=D.isNumeric(parseFloat(t))?!!parseFloat(t):"true"===t||"false"!==t&&t;return e},D.round=function(t,e){var n=Math.pow(10,e);return Math.round(t*n)/n},D.countSigFigsAfter=function(t){return Math.floor(t)!==parseFloat(t)?parseFloat(t).toString().split(".").pop().length||0:0},D.countSigFigsBefore=function(t){return Math.floor(t).toString().replace(/0+$/g,"").length},D.siDecimal=function(t){return Math.pow(10,Math.floor(Math.log10(t)))},D.siValue=function(t){if(D.isNumeric(t))return D.siDecimal(t);var e={y:1e-24,yocto:1e-24,z:1e-21,zepto:1e-21,a:1e-18,atto:1e-18,f:1e-15,femto:1e-15,p:1e-12,pico:1e-12,n:1e-9,nano:1e-9,"":1e-6,micro:1e-6,m:.001,milli:.001,k:1e3,kilo:1e3,M:1e6,mega:1e6,G:1e9,giga:1e9,T:1e12,tera:1e12,P:1e15,peta:1e15,E:1e18,exa:1e18,Z:1e21,zetta:1e21,Y:1e24,yotta:1e24};return e[t]||0},D.numberFormat=function(t,n,r,a){var i,o,l;return r="boolean"==typeof r&&r,!D.isNumeric(t)||0===t&&!r?t.toString():(n=D.isNumeric(n)?n:r?2:0,l=D.countSigFigsAfter(t),n=l&&r?n:Math.min(n,l),i="undefined"==typeof a?e.format:e.formatLocale(a).format,o=r?"$,":",",o+=l?"."+n+"f":"",i(o)(t))},D.numberFormatFixed=function(t,n,r,a){var i,o;return D.isNumeric(t)?(r="boolean"==typeof r&&r,n=D.isNumeric(n)?n:r?2:0,i="undefined"==typeof a?e.format:e.formatLocale(a).format,o=r?"$,":",",o+="."+n+"f",i(o)(t)):t.toString()},D.numberFormatSI=function(t,n,r,a){var i,o,l;if(!D.isNumeric(t))return t;if(r="boolean"==typeof r&&r,n=Number.isFinite(n)?n:0,i="undefined"==typeof a?e.format:e.formatLocale(a).format,l=D.countSigFigsAfter(t),o=r?"$,":",",r&&l&&t<1e3)t=D.round(t,n),l=D.countSigFigsAfter(t),n=Math.min(l,n),1===n&&(n=2),o+="."+n+"f";else if(Math.abs(t)<1)o+=0===+t.toFixed(n)?".1s":"."+Math.min(n,l)+"f";else{if(!(Math.abs(t)<1e3)){if(i="undefined"==typeof a?e.formatPrefix:e.formatLocale(a).formatPrefix,0!==n){var s=i("."+n+"s",t)(t),c=s.split(".").pop().replace(/[^\d]+$/,"").match(/0+$/g);Array.isArray(c)&&(n-=c.pop().length)}return o+="."+n+"s",i(o,t)(t)}t=D.round(t,n)}return i(o)(t)},D.numberFormatSIFixed=function(t,n,r,a,i){var o,l;return D.isNumeric(t)?(r="boolean"==typeof r&&r,n=D.isNumeric(n)?n:r?2:0,o="undefined"==typeof a?e.formatPrefix:e.formatLocale(a).formatPrefix,i=D.siValue(i),l=r?"$,":",",l+="."+n+"s",o(l,i)(t)):t.toString()},D.daysInMonth=function(t,e){return new Date(e,t+1,0).getDate()},D.isValidDate=function(t){return!!t&&(t instanceof Date&&!isNaN(t.valueOf()))},D.parseDatetime=function(t){var e;return D.isNumeric(Math.floor(t))&&4===t.toString().length?e=new Date(Math.floor(t)+"-1-1 GMT"):parseInt(t,10).toString()===t||parseInt(t,10)===t?e=new Date(parseInt(t,10)):(e=new Date(t),"Z"===t.toString().substr(-1)||t.toString().indexOf("GMT")!==-1||t.toString().match(/\d\d\d\d-\d\d-\d\dT/)||e.setUTCMilliseconds(e.getUTCMilliseconds()-6e4*e.getTimezoneOffset())),D.isValidDate(e)||(e=t),e},D.getDateFormat=function(t,n){var r=["multi","%x, %I:%M:%S.%L %p","%x, %I:%M:%S %p","%x, %I:%M %p","%x, %I %p","%x","%b %d","%B %Y","%Y"],a=t.length?e.min(t,function(t){n===!0&&t.setUTCMilliseconds(t.getUTCMilliseconds()+6e4*t.getTimezoneOffset());var r,a=new Date(t);return r=+e.timeSecond(t)<+a?1:+e.timeMinute(t)<+a?2:+e.timeHour(t)<+a?3:+e.timeDay(t)<+a?4:+e.timeMonth(t)<+a?5:+e.timeYear(t)<+a?7:8}):8;return r[a]},D.getDateFormatUTC=function(t){var n=["multi","%x, %I:%M:%S.%L %p","%x, %I:%M:%S %p","%x, %I:%M %p","%x, %I %p","%x","%b %d","%B %Y","%Y"],r=t.length?e.min(t,function(t){var n,r=new Date(t);return n=+e.utcSecond(t)<+r?1:+e.utcMinute(t)<+r?2:+e.utcHour(t)<+r?3:+e.utcDay(t)<+r?4:+e.utcMonth(t)<+r?5:+e.utcYear(t)<+r?7:8}):8;return n[r]},D.multiFormat=function(t,e){return e===!1?D.getDateFormat([t]):D.getDateFormatUTC([t])},D.dateFormat=function(t,n,r){var a,i,o,l=(t.toString(),D.parseDatetime(t));return D.isValidDate(l)?(r&&r.hasOwnProperty("utcFormat")?(i=r.utcFormat,o=n?n.indexOf("%")!==-1?n:D.multiFormat(l):"%Y"):(a=D.buildLocality(r),i=e.timeFormatLocale(a).utcFormat,o=n?n.indexOf("%")!==-1?n:a[n]||D.multiFormat(l):"%Y"),i(o)(l)):t},D.buildLocality=function(t,e){var n,r=t||{},a=!!e,i=function(t){return t.join("|").split("|").map(function(t){return t?isNaN(t)?t:+t:""})},o={decimal:".",thousands:",",grouping:[3],currency:["$",""],periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],date:"%b %-d, %Y",time:"%-I:%M:%S %p",dateTime:"%B %-d, %Y at %X GMT%Z",full:"%A, %c",long:"%c",medium:"%x, %X",short:"%-m/%-d/%y, %-I:%M %p",yMMMEd:"%a, %x",yMEd:"%a, %-m/%-d/%Y",yMMMMd:"%B %-d, %Y",yMMMd:"%x",yMd:"%-m/%-d/%Y",yMMMM:"%B %Y",yMMM:"%b %Y",MMMd:"%b %-d",MMMM:"%B",MMM:"%b",y:"%Y"};for(var l in r)t.hasOwnProperty(l)&&(n=r[l],o[l]=a&&Array.isArray(n)?i(n):n);return o},D.displayNoData=function(t,e,n,r,a){var i=t?[]:[n],o=e.selectAll(".sc-no-data").data(i),l=o.enter().append("text").attr("class","sc-no-data").attr("dy","-.7em").style("text-anchor","middle"),s=e.selectAll(".sc-no-data").merge(l);return o.exit().remove(),!!i.length&&(s.attr("x",r).attr("y",a).text(D.identity),e.selectAll(".sc-chart-wrap").remove(),!0)};var F={};F.show=function(t,e,n,r,a,i){var o=document.createElement("div"),l=document.createElement("div"),s=document.createElement("div");return n=n||"s",r=r||5,l.className="tooltip-inner",s.className="tooltip-arrow",l.innerHTML=e,o.style.left=0,o.style.top=-1e3,o.style.opacity=0,o.className="tooltip xy-tooltip in",o.appendChild(l),o.appendChild(s),a.appendChild(o),F.position(a,o,t,n,r),o.style.opacity=1,o},F.cleanup=function(){for(var t=document.getElementsByClassName("tooltip"),e=[],n=t.length;n>0;)n-=1,t[n].className.indexOf("xy-tooltip")!==-1&&(e.push(t[n]),t[n].style.transitionDelay="0 !important",t[n].style.opacity=0,t[n].className="sctooltip-pending-removal out");setTimeout(function(){for(var t;e.length;)t=e.pop(),t.parentNode.removeChild(t)},500)},F.position=function(t,e,n,r,a){function i(){var t=f[0]-h/2;return t<v&&(t=v),t+h>g&&(t=g-h),t}function o(){var t=f[1]-p/2;return t<y&&(t=y),t+p>y+m&&(t=y-p),t}function l(t){var n=f[0]-h/2-t-5,r=e.getElementsByClassName("tooltip-arrow")[0];r.style.marginLeft=n+"px"}function s(t){var n=f[1]-p/2-t-5,r=e.getElementsByClassName("tooltip-arrow")[0];r.style.marginTop=n+"px"}r=r||"s",a=a||5;var c,u,d=t.getBoundingClientRect(),f=[n.clientX-d.left,n.clientY-d.top],h=parseInt(e.offsetWidth,10),p=parseInt(e.offsetHeight,10),g=t.clientWidth,m=t.clientHeight,v=t.scrollLeft,y=t.scrollTop,b=e.className.replace(/ top| right| bottom| left/g,"");switch(r){case"e":u=o(),c=f[0]-h-a,s(u),c<v?(c=f[0]+a,b+=" right"):b+=" left";break;case"w":u=o(),c=f[0]+a,s(u),c+h>g?(c=f[0]-h-a,b+=" left"):b+=" right";break;case"n":c=i(),u=f[1]+a,l(c),u+p>y+m?(u=f[1]-p-a,b+=" top"):b+=" bottom";break;case"s":c=i(),u=f[1]-p-a,l(c),y>u?(u=f[1]+a,b+=" bottom"):b+=" top"}e.style.left=c+"px",e.style.top=u+"px",e.className=b};var L={area:r,axis:a,funnel:i,gauge:o,headers:s,line:u,menu:l,multibar:d,pie:f,scatter:c,scroller:h,table:p,treemap:g},T={areaChart:m,bubbleChart:v,funnelChart:y,gaugeChart:b,globeChart:x,lineChart:w,multibarChart:k,paretoChart:M,pieChart:A,treeChart:I,treemapChart:C},E=function(t,n,r){function a(t){return(t.hasOwnProperty("label")?t.label:String(t))||g}function i(t,e){var n={group:e+1,label:a(t)};return t.values&&(n.total=I(t.values)),n}function o(t){return t.key||a(t)}function l(t){return t&&t.filter(function(t){return t.values&&t.values.length}).length>0}function s(t,e){var n=["multibar","line","area","pie","funnel","gauge"];return n.indexOf(t)!==-1&&l(e)}function c(t){return Array.isArray(t)&&t.length&&Array.isArray(t[0])}function u(t){return 1===e.max(t,function(t){return t.values.length})}var d,f=[],h=t.properties?Array.isArray(t.properties)?t.properties[0]:t.properties:{},p=0,g="Undefined",m=!0,v=!1,y=!1,b=[],x=h.groups||t.label||h.labels||h.label||[],w=[],k="datetime"===h.xDataType||!1,M="ordinal"===h.xDataType||!1,A="numeric"===h.xDataType||!1,I=function(t){return t?t.reduce(function(t,e){return parseFloat(t)+e},0):0};if(v=c(t.values),v?(b=h.keys||t.values.splice(0,1)[0].splice(1),x=[],d=e.transpose(t.values.map(function(t,e){var n=t.splice(0,1)[0];return M&&x.push(i(n,e)),t.map(function(t,r){return k||A?[n,t]:M?[e+1,t]:void 0})})),f=b.map(function(t,e){return{key:t,values:d[e]}})):f=t.data,m=s(n,f)){v=c(f[0].values),y=u(f);var C=v?function(t){return t[0]}:function(t){return t.x},S=v?function(t){return t[1]}:function(t){return t.y},D=v?function(t,e){return{x:F(t[0],e),y:L(t[1],e)}}:function(t,e){return t.x=F(t.x,e),t.y=L(t.y,e),t},F=k?function(t,e,n){var r=4===t.toString().length?"1/1/"+t.toString():t;r.indexOf("GMT")===-1&&(r+=" GMT");var a=new Date(r);return a.toUTCString()}:M?function(t,e){return e+1}:A?function(t,e){return parseFloat(t)}:function(t){return t},L=function(t){return parseFloat(t)};switch(n){case"multibar":"basic"===r?1===f.length?(f=f.map(function(t,e){return t.key=o(t)||"Series "+e,t.values=t.values.map(function(t,e){return D(t,e)}),t}),h.seriesLength=f[0].values.length):(f=[{key:h.key||"Series 0",values:f.reduce(function(t,e,n){return e?v?t.values.map(function(t,n){return{x:F(C(t),n),y:L(S(t),n)+S(e.values[n])}}):t.values.map(function(t,n){return t.x=F(C(t),n),t.y=L(S(t),n)+S(e.values[n]),t}):t})}],h.seriesLength=f[0].values.length):y?(f=f.map(function(t,e){return{key:o(t),values:f.map(function(t,n){var r=t.values[0];return e===n?v?{x:F(C(r),n),y:L(S(r),n)}:(r.x=F(C(r),n),r.y=L(S(r),n),r):{x:F(C(r),n),y:0}})}}),h.seriesLength=f.length):(f=f.map(function(t,e){return t.key=o(t),t.values=t.values.map(function(t,e){return D(t,e)}),t}),h.seriesLength=f.length);break;case"pie":f=f.map(function(t,e){var n={key:o(t),disabled:t.disabled||!1,value:I(t.values)};return void 0!==t.color&&(n.color=t.color),void 0!==t.classes&&(n.classes=t.classes),n}),h.seriesLength=f.length;break;case"funnel":f=f.reverse().map(function(t,n){return{key:o(t),disabled:t.disabled||!1,values:[{series:n,x:0,y:e.sum(t.values,function(t){return S(t)}),y0:0}]}}),h.seriesLength=f.length;break;case"area":case"line":f.forEach(function(t,n){t.seriesIndex=n,t.key=o(t),t.values=v?t.values.map(function(t,e){return{x:F(t[0],n,e),y:parseFloat(t[1])}}):t.values.map(function(t,e){return t.x=F(t.x,n,e),t.y=parseFloat(t.y),t}),t.total=e.sum(t.values,function(t){return t.y}),t.total||(t.disabled=!0)}),h.seriesLength=f.length;break;case"gauge":p=t.values.shift().gvalue;var T=0;f=f.map(function(t,e){var n={key:a(t),y:parseFloat(t.values[0])+T};return T+=parseFloat(t.values[0]),n}),w=[{group:1,label:"Sum",total:p}],h.seriesLength=w.length}x.length&&(h.groups=x.map(i))}else switch(n){case"bubble":if(!t.data){var E={"Negotiation/Review":"Negotiat./Review","Perception Analysis":"Percept. Analysis","Proposal/Price Quote":"Proposal/Quote","Id. Decision Makers":"Id. Deciders"};f={data:t.records.map(function(t){return{id:t.id,x:t.date_closed,y:Math.round(parseInt(t.likely_case,10)/parseFloat(t.base_rate)),shape:"circle",account_name:t.account_name,assigned_user_name:t.assigned_user_name,sales_stage:t.sales_stage,sales_stage_short:E[t.sales_stage]||t.sales_stage,probability:parseInt(t.probability,10),base_amount:parseInt(t.likely_case,10),currency_symbol:"$"}}),properties:{title:"Bubble Chart Data",yDataType:"string",xDataType:"datetime",seriesLength:t.records.length}}}}return{properties:h,data:f}},P=!1,z="scr";t.development=P,t.build=z,t.version=S,t.utility=D,t.utils=D,t.tooltip=F,t.models=L,t.charts=T,t.transform=E,Object.defineProperty(t,"__esModule",{value:!0})});
